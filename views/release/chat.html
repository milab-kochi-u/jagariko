<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>group page</title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap-theme.min.css" >
    <![endif]-->
    <!--<script src="/release/angular.min.js"></script>-->

    <script src="/release/angular.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/tmp/jquery-2.2.4.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="/bootstrap/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <!--
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular-animate.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular-touch.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.3.3/ui-bootstrap.min.js"></script>
    -->

    <script type="text/javascript" src="/release/angular-route.min.js"></script>
    <script src="/release/ui-bootstrap-tpls-2.2.0.min.js"></script>

    <script src="/_debate/d3/d3.js"></script>


    <style>



        .balloon {
            background-color:#fff;
            border:1px solid #000;
            border-radius:5px;
            position:relative;
        }

        .__balloon:before {
            border:10px solid transparent;
            border-left-color:#fff;
            border-right-width:0;
            right:-9px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
            z-index:1;
        }

        .__balloon:after {
            border:10px solid transparent;
            border-left-color:#000;
            border-right-width:0;
            right:-10px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
        }



        ._balloon:before {
            border:10px solid transparent;
            border-right-color:#fff;
            border-left-width:0;
            left:-9px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
            z-index:1;
        }

        ._balloon:after {
            border:10px solid transparent;
            border-right-color:#000;
            border-left-width:0;
            left:-10px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
        }

        .bs-wizard {margin-top: 40px;}

        /*Form Wizard*/
        .bs-wizard {border-bottom: solid 1px #e0e0e0; padding: 0 0 10px 0;}
        .bs-wizard > .bs-wizard-step {padding: 0; position: relative;}
        .bs-wizard > .bs-wizard-step + .bs-wizard-step {}
        .bs-wizard > .bs-wizard-step .bs-wizard-stepnum {color: #595959; font-size: 16px; margin-bottom: 5px;}
        .bs-wizard > .bs-wizard-step .bs-wizard-info {color: #999; font-size: 14px;}
        .bs-wizard > .bs-wizard-step > .bs-wizard-dot {position: absolute; width: 30px; height: 30px; display: block; background: #fbe8aa; top: 45px; left: 50%; margin-top: -15px; margin-left: -15px; border-radius: 50%;}
        .bs-wizard > .bs-wizard-step > .bs-wizard-dot:after {content: ' '; width: 14px; height: 14px; background: #fbbd19; border-radius: 50px; position: absolute; top: 8px; left: 8px; }
        .bs-wizard > .bs-wizard-step > .progress {position: relative; border-radius: 0px; height: 8px; box-shadow: none; margin: 20px 0;}
        .bs-wizard > .bs-wizard-step > .progress > .progress-bar {width:0px; box-shadow: none; background: #fbe8aa;}
        .bs-wizard > .bs-wizard-step.complete > .progress > .progress-bar {width:100%;}
        .bs-wizard > .bs-wizard-step.active > .progress > .progress-bar {width:50%;}
        .bs-wizard > .bs-wizard-step:first-child.active > .progress > .progress-bar {width:0%;}
        .bs-wizard > .bs-wizard-step:last-child.active > .progress > .progress-bar {width: 100%;}
        .bs-wizard > .bs-wizard-step.disabled > .bs-wizard-dot {background-color: #f5f5f5;}
        .bs-wizard > .bs-wizard-step.disabled > .bs-wizard-dot:after {opacity: 0;}
        .bs-wizard > .bs-wizard-step:first-child  > .progress {left: 50%; width: 50%;}
        .bs-wizard > .bs-wizard-step:last-child  > .progress {width: 50%;}
        .bs-wizard > .bs-wizard-step.disabled a.bs-wizard-dot{ pointer-events: none; }
        /*END Form Wizard*/


    </style>
</head>
<body ng-app="myApp" ng-init="LAN='JP'">

<div  class="container" ng-controller="myController" >
    <wait-debate ng-if="statusController.waitDebate"></wait-debate>
    <start-debate ng-if="statusController.startDebate"></start-debate>
    <analysis-debate ng-if="statusController.analysisDebate"></analysis-debate>
    <check-debate ng-if="statusController.checkDebate"></check-debate>
    <appeal-debate ng-if="statusController.appealDebate"></appeal-debate>
    <state-debate ng-if="statusController.stateDebate"></state-debate>
    <bunseki-debate ng-if="statusController.bunsekiDebate"></bunseki-debate>
    <kentou-debate ng-if="statusController.kentouDebate"></kentou-debate>
    <lookup-debate ng-if="statusController.lookupDebate"></lookup-debate>
    <noberu-debate ng-if="statusController.noberuDebate"></noberu-debate>
    <finish-debate ng-if="statusController.finishDebate"></finish-debate>

    <!-- no analysis function -->

    <!--noAnalysisStart-->
    <!--noAnalysisFuncAppealAndState-->
    <!--noAnalysisFuncLookupAndNoberu-->

    <no-analysis-start-debate ng-if="statusController.noAnalysisStartDebate"></no-analysis-start-debate>
    <no-analysis-func-appeal-and-state-debate ng-if="statusController.noAnalysisFuncAppealAndStateDebate"></no-analysis-func-appeal-and-state-debate>
    <no-analysis-finish-debate ng-if="statusController.noAnalysisFinishDebate"></no-analysis-finish-debate>


</div>
</body>

<script>

    var myApp = angular.module("myApp",['ui.bootstrap']);

    myApp.factory('coreSocket', function($rootScope) {
        //var socket = io.connect();
        var socket = io(window.location.host + "/release").connect()
        return {
            on: function(eventName, callback) {
                socket.on(eventName, function() {
                    var args = arguments;
                    $rootScope.$apply(function() {
                        callback.apply(socket, args);
                    });
                });
            },
            emit: function(eventName, data, callback) {
                socket.emit(eventName, data, function() {
                    var args = arguments;
                    $rootScope.$apply(function() {
                        if (callback) {
                            callback.apply(socket, args);
                        }
                    });
                });
            }
        };
    });

    myApp.factory("myPost",function($http){
        return{
            postData:function(url,data){
                return $http.post(url,data).success(function(res){
                    return res;
                })
            }
        }
    })

    myApp.factory("getDebateStatementMapInformation",function(myPost,$q){
        return{
            getDebateStatementMapInformation:function(){
                var deferred = $q.defer();
                myPost.postData("/release/getDebateStatementMapInformation").then(function(_res){
                    console.log("getDebateStatementMapInformation")
                    console.log(_res)
                    if(_res.data){
                        deferred.resolve({err:0,msg:"data acquired",res:_res});
                    }else{
                        deferred.reject({err:1,msg:"data not acquired",res:_res});
                    }
                })
                return deferred.promise;
            }
        }
    })

    myApp.factory("getDebateAnalysisMapInformation",function(myPost,$q) {
        return{
            getDebateAnalysisMapInformation:function(){

                var deferred = $q.defer();

                myPost.postData("/release/getDebateAnalysisMapInformation").then(function(_res){
                    console.log("getDebateAnalysisMapInformation")
                    console.log(_res)
                    if(_res.data){
                        deferred.resolve({err:0,msg:"data acquired",res:_res});
                    }else{
                        deferred.reject({err:1,msg:"data not acquired",res:_res});
                    }

                })
                return deferred.promise;
            }
        }
    })

    myApp.controller("myController",function($scope,myPost,coreSocket,$q,$rootScope){

        function init(){

            initData($scope)

            var promise = getDebateInformation()

            //promise.then(function(msg){
                //checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            //})

            //进入房间
            var promise = getUserInformation()
            promise.then(function(msg){
                coreSocket.emit("enterRoom",{username:$scope.username})
            })

        }

        init()

        //$scope.$watch("debateInfo.status",checkStatus)

        coreSocket.on("enterRoom",function(_res){
            var promise = getDebateInformation()

            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })

        })


        coreSocket.on('refreshOnline', function (msg) {
            //alert(sysMsg)
            var onlineInfo = msg.onlineInfo
            console.log(11111111111)
            console.log(onlineInfo)

            var pro = $scope.debateInfo.pro
            var con = $scope.debateInfo.con
            var proOnline = false
            var conOnline = false

            for(var i=0;i<onlineInfo.length;i++){
                    if(onlineInfo[i].username == pro) proOnline = true
                    if(onlineInfo[i].username == con) conOnline = true
            }

            $scope.proOnline = proOnline
            $scope.conOnline = conOnline

        });

        coreSocket.on("receiveStatement",function(_res){
            console.log("receive statement....")
            console.log(_res)
            var promise = getDebateInformation()

            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })
        })


        coreSocket.on("receiveAnalysis",function(_res){
            console.log("receive result of analysis result")
            var promise = getDebateInformation()

            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })

        })

        coreSocket.on("receiveUpdateAnalysis",function(_res){

            $scope.currentAnalysis = _res.everyAnalysisData
            $rootScope.$broadcast('reDrawMap');
        })



        coreSocket.on("confirmAnalysisResultFinish",function(_res){
            console.log("result of analysis has been approved")
            var promise = getDebateInformation()

            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })
        })



        coreSocket.on("refuseAnalysisResultFinish",function(_res){
            console.log("result of analysis has been approved")
            var promise = getDebateInformation()

            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })
        })




        coreSocket.on("selectDissentFinish",function(msg){
            var promise = getDebateInformation()


            promise.then(function(_msg){


                if($scope.debateInfo.status == "appeal"){
                    console.log("con select dissent and prepare to do state")
                    $scope.debateInfo.status = "state"
                    $scope.debateInfo.preStatus = "appeal"
                }else if($scope.debateInfo.status == "lookup"){
                    console.log("pro select dissent and prepare to do state")
                    $scope.debateInfo.status = "noberu"
                    $scope.debateInfo.preStatus = "lookup"
                }else{

                }

                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
                console.log($scope.dissentData)
                $scope.dissentData = msg.dissentData
                $scope.statementStatus = msg.statementStatus
                $scope.statementData = msg.statementData


            })

        })



        coreSocket.on("sendCyousi",function(msg){
            var cyousiVal = msg.cyousiVal
            var position = msg.position

            if(position == 1){
                $scope.proCyousi = cyousiVal
            }else{
                $scope.conCyousi = cyousiVal
            }

        })









        function getDebateInformation(){

            var deferred = $q.defer();

            myPost.postData("/release/getDebateInformation").then(function(_res){
                if(_res.data.err == 1){
                    window.location = "/release/login"
                }

                if(_res.data){
                    $scope.debateInfo.title = _res.data.title
                    $scope.debateInfo.pro = _res.data.pro
                    $scope.debateInfo.con = _res.data.con
                    $scope.debateInfo.finish = _res.data.finish
                    $scope.debateInfo.setting = _res.data.setting
                    $scope.debateInfo.group = _res.data.group
                    $scope.debateInfo.proPrepare = _res.data.proPrepare
                    $scope.debateInfo.conPrepare = _res.data.conPrepare
                    $scope.debateInfo.position = _res.data.position
                    $scope.debateInfo.status = _res.data.status
                    $scope.debateInfo.preStatus = _res.data.preStatus
                    $scope.debateInfo.config = _res.data.config
                    $scope.debateInfo.username = _res.data.username
                    $scope.debateInfo.LAN = _res.data.LAN
                    $scope.debateInfo.path = _res.data.path

                    $scope.everyStatementData = _res.data.everyStatement
                    $scope.debateInfo.analysisFunc = _res.data.analysisFunc
                    $scope.debateInfo.mapFunc = _res.data.mapFunc

                    if($scope.debateInfo.analysisFunc == 1){
                        //如果有分析功能的话那么处理分析数据的框架
                        if($scope.everyStatementData) {
                            generateAnalysisResult($scope.everyStatementData)
                        }
                    }


                    $scope.requestStatementMessage = _res.data.requestStatementMessage
                    $scope.refuseAnalysisResultReason = _res.data.refuseAnalysisResultReason
                    $scope.everyAnalysisData = _res.data.everyAnalysisData


                    //如果该状态不是分析状态,那么就拿实际的分析数据,否则就拿空的分析数据供填写使用
                    if($scope.debateInfo.status != 'analysis' && $scope.debateInfo.status != 'bunseki'){
                        if(_res.data.everyAnalysisData){
                            $scope.analysisData = _res.data.everyAnalysisData.analysisData
                            $scope.analysisDissentExplainData = _res.data.everyAnalysisData.analysisDissentExplainData

                        }
                    }


                    //这里如果是分析状态但是是属于被回退的分析状态,那么还是拿实际的分析结果数据供preview使用
                    if(($scope.debateInfo.status == 'analysis' && $scope.debateInfo.preStatus == 'check') || ($scope.debateInfo.status == 'bunseki' && $scope.debateInfo.preStatus == 'kentou')){
                        if(_res.data.everyAnalysisData){
                            $scope.analysisData = _res.data.everyAnalysisData.analysisData
                            $scope.analysisDissentExplainData = _res.data.everyAnalysisData.analysisDissentExplainData
                        }
                    }

                    $scope.debateInfo.order =  _res.data.order
                    $scope.debateInfo.preFinish =  _res.data.preFinish
                    $scope.debateInfo.proRate = parseInt(_res.data.proRate)
                    $scope.debateInfo.conRate = parseInt(_res.data.conRate)


                    deferred.resolve({err:0,msg:"data acquired"});
                }else{
                    deferred.reject({err:1,msg:"data not acquired"});
                }

            })


            return deferred.promise;
        }


        function generateAnalysisResult(everyStatementData){

            $scope.analysisData = {txt:everyStatementData.statementData,analysisResult:[
                {claim:"",support:[
                    {evidence:"",warrant:"",wrandom:Math.round(Math.random()*100000),erandom:Math.round(Math.random()*100000)},
                ],random:Math.round(Math.random()*100000)},
            ],indexToStatement:everyStatementData.statementDataRandom}


            $scope.analysisDissentExplainData = []
            for(var i=0;i<everyStatementData.dissentExplain.length;i++){
                $scope.analysisDissentExplainData.push({txt:everyStatementData.dissentExplain[i].reply,analysisResult:[
                    {claim:"",support:[
                        {evidence:"",warrant:"",wrandom:Math.round(Math.random()*100000),erandom:Math.round(Math.random()*100000)},
                    ],
                      random:Math.round(Math.random()*100000)
                    }
                    ],
                    indexToAnalysis:everyStatementData.dissentExplain[i].indexToAnalysis,
                    indexToStatement:everyStatementData.dissentExplain[i].random,
                })
            }



            console.log("analysisData")
            console.log($scope.analysisData)
            console.log("analysisDissentExplainData")
            console.log($scope.analysisDissentExplainData)
        }

        function getUserInformation(){

            var deferred = $q.defer();
            myPost.postData("/release/getUserInformation").then(function(_res){

                if(_res.data){
                    console.log(_res)
                    $scope.username = _res.data.data.username
                    $scope.debateInvolve = _res.data.data.debateInvolve
                    $scope.group = _res.data.data.group
                    $scope.num = _res.data.data.num
                    $scope.rNum = _res.data.data.rNum
                    $scope.status = _res.data.data.rNum
                    $scope.LAN = _res.data.data.LAN
                    deferred.resolve({err:0,msg:"data acquired"});
                }else{
                    deferred.reject({err:1,msg:"data not acquired"});
                }

            })

            return deferred.promise;
        }


        function checkStatus(status,preStatus){
                if($scope.debateInfo.analysisFunc == 1){
                    changeStatusWithAnalysisFunc(status,preStatus)
                }else{
                    changeStatusWithOutAnalysisFunc(status,preStatus)
                }
        }


        function changeStatusWithAnalysisFunc(status,preStatus){
            if(status == "start" && !preStatus){
                changeStatusController(["startDebate"])
            }

            if(status == "analysis" && preStatus == "start"){
                changeStatusController(["analysisDebate"])
            }


            if(status == "analysis" && preStatus == "check"){
                changeStatusController(["analysisDebate"])
            }

            if(status == "check" && preStatus == "analysis"){
                changeStatusController(["checkDebate"])
            }

            if(status == "appeal" && preStatus == "check"){
                changeStatusController(["appealDebate"])
            }

            if(status == "state" && preStatus == "appeal"){
                changeStatusController(["stateDebate"])
            }

            // status "state" will not inserted into database


            if(status == "bunseki" && preStatus == "appeal"){
                changeStatusController(["bunsekiDebate"])
            }



            if(status == "bunseki" && preStatus == "kentou"){
                changeStatusController(["bunsekiDebate"])
            }

            if(status == "kentou" && preStatus == "bunseki"){
                changeStatusController(["kentouDebate"])
            }

            if(status == "lookup" && preStatus == "kentou"){
                changeStatusController(["lookupDebate"])
            }

            if(status == "noberu" && preStatus == "lookup"){
                changeStatusController(["noberuDebate"])
            }

            if(status == "analysis" && preStatus == "lookup"){
                changeStatusController(["analysisDebate"])
            }


            if(status == "finish"){
                changeStatusController(["finishDebate"])
            }
        }


        function changeStatusWithOutAnalysisFunc(status,preStatus){
            if(status == "noAnalysisStart"){
                changeStatusController(["noAnalysisStartDebate"])
            }

            if(preStatus == "noAnalysisStart" && status == "noAnalysisFuncAppealAndState"){
                changeStatusController(["noAnalysisFuncAppealAndStateDebate"])
            }

            if(status == "noAnalysisfinish"){
                changeStatusController(["noAnalysisFinishDebate"])
            }

        }


        function changeStatusController(arr){
            for(var i in $scope.statusController){
                $scope.statusController[i] = false
            }

            for(var i in arr){
                $scope.statusController[arr[i]] = true
            }

            console.log("now the showing flat is ....")
            console.log(arr)
            console.log("---------------------------")
        }
    });


    myApp.directive("myNavy",function(){
        return {
            scope:false,
            templateUrl:"/angularJSTemplate/navy.html"
        }
    })



    myApp.directive("prepareOfPro",function(){
        return{
            scope:false,
            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/pro/prepare.html"
        }
    })

    myApp.directive("topArticle",function(){
        return{
            scope:false,
            link:function(scope,element){
                scope.topArticleChangeTabVal = 0
                scope.topArticleChangeTab = function(n){
                    scope.topArticleChangeTabVal = n
                }

                scope.$on('topArticleChangeTab',function(event, data){
                    scope.topArticleChangeTabVal = data.topArticleChangeTabVal
                });

                scope.selectedOrNot = function(n){
                    return parseInt(n)==scope.topArticleChangeTabVal?"active":""
                }
            },
            templateUrl:"/angularJSTemplate/public/topArticle.html"
        }
    })


    // process directive
    myApp.directive("waitDebate",function(coreSocket){
        return{
            scope:false,
            link:function(scope,element){
                scope.prepare = function(){
                    coreSocket.emit("prepare",{})
                }
            },
            templateUrl:"/angularJSTemplate/process/waitDebate.html"
        }
    })



    myApp.directive("startDebate",function(coreSocket){
        return{
            scope:false,

            link:function(scope,element){
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                }
            },
            templateUrl:"/angularJSTemplate/process/startDebate.html"
        }
    })


    myApp.directive("analysisDebate",function(){
        return{
            scope:false,

            link:function(scope,element){
                //有两个状态process指令用到了这个inputformArea的指令,一个是analysisDebate另外一个是bunsekiDebate
                if(scope.debateInfo.preStatus == 'check' || scope.debateInfo.preStatus == 'kentou'){
                    scope.analysisObject = {target:"preview",i:0}
                }else{
                    if(scope.debateInfo.preFinish){
                        //如果是属于准结束阶段,那么这个时候只有分析異議説明的份儿
                        scope.analysisObject = {target:"dissentExplain",i:0}
                    }else{
                        //如果不是准结束的阶段,那么这个时候要分析立論
                        scope.analysisObject = {target:"construct",i:0}
                    }
                }
            },
            templateUrl:"/angularJSTemplate/process/analysisDebate.html"
        }
    })



    myApp.directive("checkDebate",function($rootScope){
        return{
            scope:false,

            link:function(scope,element){
                scope.conceptStatus = "check"
            },
            templateUrl:"/angularJSTemplate/process/checkDebate.html"
        }
    })



    myApp.directive("appealDebate",function(){
        return{
            scope:false,

            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/process/appealDebate.html"
        }
    })


    myApp.directive("stateDebate",function(coreSocket){
        return{
            scope:false,

            link:function(scope,element){
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                }
            },
            templateUrl:"/angularJSTemplate/process/stateDebate.html"
        }
    })



    myApp.directive("bunsekiDebate",function(){
        return{
            scope:false,
            link:function(scope){
                //有两个状态process指令用到了这个inputformArea的指令,一个是analysisDebate另外一个是bunsekiDebate
                if(scope.debateInfo.preStatus == 'check' || scope.debateInfo.preStatus == 'kentou'){
                    scope.analysisObject = {target:"preview",i:0}
                }else{
                    scope.analysisObject = {target:"construct",i:0}
                }
            },
            templateUrl:"/angularJSTemplate/process/bunsekiDebate.html"
        }
    })


    myApp.directive("kentouDebate",function($rootScope){
        return{
            scope:false,
            link:function(scope,element){
                scope.conceptStatus = "kentou"

            },
            templateUrl:"/angularJSTemplate/process/kentouDebate.html"
        }
    })

    myApp.directive("lookupDebate",function(){
        return{
            scope:false,

            link:function(scope,element){
                    //如果是最后一轮的话那么这里只能反論,不能立論


            },
            templateUrl:"/angularJSTemplate/process/lookupDebate.html"
        }
    })

    myApp.directive("noberuDebate",function(coreSocket){
        return{
            scope:false,
            link:function(scope,element){
                    if(scope.debateInfo.order == scope.totalNum-1){
                        //说明现在这个阶段不能立論了,因为快要结束了
                        scope.lastStatement = 1
                    }

                    scope.submit = function(){
                        coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                    }
            },
            templateUrl:"/angularJSTemplate/process/noberuDebate.html"
        }
    })

    myApp.directive("finishDebate",function(myPost){
        return{
            scope:false,
            link:function(scope,element){

                scope.conceptStatus = "judgeMent"

                if(scope.debateInfo.position == 1){
                    if(scope.debateInfo.proRate){
                       scope.rateable = 0
                    }else{
                       scope.rateable = 1
                    }
                }

                if(scope.debateInfo.position == 2){
                    if(scope.debateInfo.conRate){
                        scope.rateable = 0
                    }else{
                        scope.rateable = 1
                    }

                }


                scope.determines = function(n){
                    // 0 win
                    // 1 draw
                    // 2 lost


                    myPost.postData("/release/rate",{rate:n}).then(function(_res){
                        if(_res.data.err == 0){
                            scope.isReadonly = true;
                            scope.rateable = false
                            scope.debateInfo.proRate = _res.data.data.proRate
                            scope.debateInfo.conRate = _res.data.data.conRate
                        }
                    })


                }

            },
            templateUrl:"/angularJSTemplate/process/finishDebate.html"
        }
    })

    // end of process directive




    myApp.directive("statementResultForNoAnalysis",function(){
        return {
            scope:false,
            link:function(scope,element){

            },

            templateUrl:"/angularJSTemplate/public/statementResultForNoAnalysis.html"

        }
    })


    myApp.directive("statementResult2",function($compile){
        return{
            scope:false,
            link:function(scope,element){
                var TOP //最先画的方块距离顶端的距离
                var LEFT //最先画的方块距离左边的距离
                var RIGHT
                var DISSENTWIDTH //异议方块的长度
                var DISSENTHEIGHT //异议方块的高度
                var DISSENTX //异议方块的X坐标

                var EXPLAINWIDTH
                var EXPLAINHEIGHT
                var EXPLAINX //解释方块的横坐标

                var DISSENTANDEXPLAINSPACE//异议方块距离右边的赛解释说明方块的横向距离

                var DISSENTANDLINESPACEY //异议方块距离下面虚线的纵向距离
                var DOTTEDLINEX1,DOTTEDLINEX2,DOTTEDLINEX3,DOTTEDLINEX4
                var DOTTEDLINEANDCONSTRUCTSPACE //虚线距离下面方块的纵向距离

                var CONSTRUCTWIDTH //结论方块的长度
                var CONSTRUCTHEIGHT //结论方块的高度
                var CONSTRUCTX  //X坐标
                var LASTY //升降机

                var svg = d3.select(element.find("svg")[0])

                define()
                draw()
                function define() {
                    var _width = document.getElementById("_statementResultMapSVG").offsetWidth
                    TOP = 15
                    LEFT = _width*0.05
                    RIGHT = LEFT
                    DISSENTWIDTH = (_width - LEFT - RIGHT)/3
                    DISSENTHEIGHT = DISSENTWIDTH*0.7
                    DISSENTX = LEFT

                    DISSENTANDEXPLAINSPACE = (_width - LEFT - RIGHT)*0.25

                    EXPLAINWIDTH = DISSENTWIDTH
                    EXPLAINHEIGHT = EXPLAINWIDTH*0.7
                    EXPLAINX = DISSENTX + DISSENTWIDTH + DISSENTANDEXPLAINSPACE

                    DISSENTANDLINESPACEY = 40
                    DOTTEDLINEX1 = LEFT + 10
                    DOTTEDLINEX2 = DOTTEDLINEX1 + (_width - LEFT - RIGHT)/3
                    DOTTEDLINEX4 = _width - RIGHT - 10
                    DOTTEDLINEX3 = DOTTEDLINEX4 - (_width - LEFT - RIGHT)/3
                    DOTTEDLINEANDCONSTRUCTSPACE = 40
                    CONSTRUCTWIDTH = (_width - LEFT - RIGHT)*0.8
                    CONSTRUCTHEIGHT = CONSTRUCTWIDTH * 0.6
                    CONSTRUCTX = LEFT
                    LASTY = TOP  //升降机初始位置
                }


                function clearDraw(){
                    svg.selectAll(".draw").remove()
                    LASTY = TOP  //升降机回归到初始位置
                }

                function draw(){
                    appendRect(scope.statementData)
                }

                function appendStatementRect(txt,x,y,font){
                    var text = svg.insert("text")
                    text.text(txt)
                    text.attr("x",x)
                            .attr("y",y)
                            .attr("font-size",font)
                            .attr("fill","#8a6d3b")
                            .attr("class","draw")
                }

                function drawDottedLine(x1,y1,x2,y2){
                    var line = svg.insert("line")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#000")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                            .attr("stroke-dasharray","4,10")
                }

                function appendStatementRect(text){
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",CONSTRUCTWIDTH)
                    foreignObject.attr("height",CONSTRUCTHEIGHT)

                    foreignObject.attr("x",CONSTRUCTX)
                    foreignObject.attr("y",LASTY)
                    foreignObject.attr("class","draw")

                    var _div = foreignObject.append('xhtml:div')
                    var div = _div.append("div")
                    div.attr("class","alert alert-warning  row")
                    div.attr("role","alert")
                    div.attr("style","height: "+ CONSTRUCTHEIGHT*0.6 +"px; overflow: auto;margin-bottom:1px")


                    var p = div.append("p")
                    p.html(text)


                }


            },
            templateUrl:"/angularJSTemplate/public/_statementResult.html"
        }
    })

    myApp.directive("statementResult",function($compile) {
        return {
            scope: false,
            link: function (scope,element) {


                var TOP = 15   //最先画的方块距离顶端的距离
                var LEFT = 80   //最先画的方块距离左边的距离
                var DISSENTWIDTH = 250 //异议方块的长度
                var DISSENTHEIGHT = 260//异议方块的高度
                var DISSENTANDEXPLAINSPACE = 250 //异议方块距离右边的赛解释说明方块的横向距离
                var DISSENTSPACEY = 80 //异议方块之间间隔的距离
                var EXPLAINWIDTH = 460
                var EXPLAINHEIGHT = 260
                var DISSENTANDLINESPACEY = 90 //异议方块距离下面虚线的纵向距离
                var DOTTEDLINEX = 40//虚线的左边位移
                var DOTTEDWIDTH = 360 //虚线的长度
                var DOTTEDSPACEWIDTH = 300 //虚线间隔的长度
                var DOTTEDLINEANDCONSTRUCTSPACE = 50 //虚线距离下面方块的纵向距离
                var CONSTRUCTX = LEFT //结论方块距离左侧的位移
                var CONSTRUCTWIDTH = 960 //结论方块的长度
                var CONSTRUCTHEIGHT = 260 //结论方块的高度

                var LASTX = 0
                var LASTY = 0
                var svg

                var svg = d3.select(element.find("svg")[0])
                clearDraw()
                draw()

                scope.$on('drawStatementResult',function(event, data){
                    clearDraw()
                    draw()
                });


                function draw(){
                    LASTX = LEFT
                    LASTY = TOP
                    for(var i = 0;i<scope.dissentData.length;i++){
                        if(i>0) LASTY += DISSENTSPACEY
                        appendRect(scope.dissentData[i].txt,1,LASTX,LASTY,DISSENTWIDTH,DISSENTHEIGHT,"dissent"+i)
                        if(scope.dissentData[i].reply){


                            drawArrow(LASTX+DISSENTWIDTH,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE,LASTY+DISSENTHEIGHT/2,LASTY+DISSENTHEIGHT/2)


                            if(scope.LAN == 'JP'){
                                drawText("この異議の説明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                            }else{
                                drawText("这里是对质疑的说明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                            }





                            appendRect(scope.dissentData[i].reply,0,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE+5,LASTY,EXPLAINWIDTH,EXPLAINHEIGHT,"explain"+i)
                        }else{
                            drawPointer(LASTX+DISSENTWIDTH,LASTY+DISSENTHEIGHT/4,200,200)
                        }

                        LASTY += DISSENTHEIGHT
                    }


                    LASTY += DISSENTANDLINESPACEY



                    //如果为非准结束阶段,那么是允许立論的,否则不允许立論

                    if(scope.lastStatement != 1){


                        drawDottedLine(DOTTEDLINEX,LASTY,DOTTEDLINEX+DOTTEDWIDTH,LASTY)

                        if(scope.LAN == 'JP'){
                            drawText("ここから立論の部分",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                        }else{
                            drawText("以下是原始阐述说明",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                        }

                        drawDottedLine(DOTTEDLINEX+DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY,DOTTEDLINEX+2*DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY)

                        appendRect(scope.statementData,0,CONSTRUCTX,LASTY+DOTTEDLINEANDCONSTRUCTSPACE,CONSTRUCTWIDTH,CONSTRUCTHEIGHT,"constructClaim")
                        if(scope.statementData){
                            d3.select("#constructClaim").style("display","block")
                        }else{
                            d3.select("#constructClaim").style("display","none")
                        }
                    }


                }


                function clearDraw(){
                    svg.selectAll(".draw").remove()
                    LASTX = 0
                    LASTY = 0
                }

                function drawDottedLine(x1,y1,x2,y2){
                    var line = svg.insert("line")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#000")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                            .attr("stroke-dasharray","4,10")
                }

                function drawPointer(x,y,width,height){
                    var foreignObject = svg.append("foreignObject")
                            .attr("width",width)
                            .attr("height",height)
                            .attr("x",x)
                            .attr("y",y)
                            .attr("class","draw")

                    var div = foreignObject.append('xhtml:div')
                    var image = div.append("img")

                    image.attr("src", "/leftPointer.png")
                            .attr("width", "100")
                            .attr("height", "100");

                    if(scope.LAN == 'JP'){
                        drawText("左の異議を説明してください",x+100,y+100/2,20)
                    }else{
                        drawText("请对左侧您选择的质疑做阐述说明",x+100,y+100/2,20)
                    }

                }

                function drawArrow(x1,x2,y1,y2){
                    var line = svg.insert("line",":first-child")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#9acfea")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                            .attr("marker-end","url(#arrow)")
                }

                function drawText(txt,x,y,font){
                    var text = svg.insert("text")
                    text.text(txt)
                    text.attr("x",x)
                            .attr("y",y)
                            .attr("font-size",font)
                            .attr("fill","#8a6d3b")
                            .attr("class","draw")
                }

                function appendRect(txt,dissent,x,y,w,h,id){
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",w)
                    foreignObject.attr("height",h)

                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)
                    foreignObject.attr("id",id)
                    foreignObject.attr("class","draw")


                    var _div = foreignObject.append('xhtml:div')
                    var div = _div.append("div")
                    div.attr("class","alert alert-warning  row")
                    div.attr("role","alert")
                    div.attr("style","height: "+ h*0.6 +"px; overflow: auto;margin-bottom:1px")


                    var p = div.append("p")
                    p.html(txt)



                    if(id != 'constructClaim' && dissent == 1){
                        //如果是左边的被质疑的模块
                        var div = _div.append("div")
                        var button = _div.append("button")
                        if(scope.LAN == 'JP'){
                            button.html("異議あり")
                        }else{
                            button.html("被质疑")
                        }

                        button.attr("type","button")
                        button.attr("class","btn btn-danger pull-right")
                    }


                    if(id != 'constructClaim' && dissent == 0){
                        //如果是右侧异议解释模块
                        var div = _div.append("div")
                        div.attr("class","row")
                        var divId = "btn"+Math.round(Math.random()*10000)
                        div.attr("id",divId)

                        var num = parseInt(/explain(\d)/.exec(id)[1])

                        if(scope.LAN == 'JP'){
                            var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">編集</button>'
                        }else{
                            var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">修改</button>'
                        }


                        angular.element(document.getElementById(divId)).append($compile(html)(scope));
                    }


                    if(id == 'constructClaim'){
                        //如果是原始阐述的部分的话
                        var div = _div.append("div")
                        div.attr("class","row")
                        var divId = "btn"+Math.round(Math.random()*10000)
                        div.attr("id",divId)


                        if(scope.LAN == 'JP'){
                            var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">編集</button>'
                        }else{
                            var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">修改</button>'
                        }


                        angular.element(document.getElementById(divId)).append($compile(html)(scope));
                    }

                }
            },
            templateUrl:"/angularJSTemplate/public/statementResult.html"
        }
    })

    myApp.directive("analysisResult2",function(coreSocket,$compile){
      return{
          scope:false,
          link:function(scope,element){
               scope.$on("drawAnalysisResult",function(){
                   startDraw()
               })


              var TOP  //顶端的边距
              var LEFT  //左边距
              var RIGHT //右边距

              var RECTWIDTH   //模块的宽度
              var RECTHEIGHT  //模块的高度
              var CLAIMX  //claim模块的横坐标
              var WARRANTX //warrant模块的横坐标
              var EVIDENCEX //element模块的横坐标
              var CLIAMANDWARRANTXINTERVAL
              var WARRANTANDEVIDENCEXINTERVAL
              var LASTY //升降机

              var DOTTEDLINEX1,DOTTEDLINEX2,DOTTEDLINEX3,DOTTEDLINEX4 //虚线的四个点的横坐标
              var DOTTEDLINEWIDTH  //虚线的长度
              var TITLEX  //标题的起始x坐标
              var TITLEXLEFT  //标题距离左边虚线的边距
              var TITLEFONTSIZE  //标题的字体大小
              var TITLEANDRECTINTERVALY //标题和模块的垂直距离

              var CLAIMANDSUPPORTINTERVALY  //claim和支持它的support的垂直距离
              var SUPPORTANDSUPPORTINTERVALY //同一个模块啊近邻的suppor和support之间的垂直距离
              var MOKUAIANDMOKUAIINTERVALY //模块和模块之间的垂直距离


              var DISSENTTXTWIDTH
              var DISSENTTXTHEIGHT
              var DISSENTTXTX
              var DISSENTTXTANDDISSENTEXPLAININTERVALY  //异议的文字和下面解释内容的垂直距离


              var NEXTBUTTONWIDTH
              var NEXTBUTTONHEIGHT
              var NEXTBUTTONX

              var svg


              startDraw()
              function startDraw(){
                  define()
                  draw()
              }

              function clearDraw(){
                  svg.selectAll(".draw").remove()
              }


              function define(){
                  var _width = document.getElementById("analysisResult").offsetWidth
                  TOP = 10
                  LEFT = _width*0.05
                  RIGHT = LEFT
                  RECTWIDTH = (_width - LEFT - RIGHT)/3
                  RECTHEIGHT = RECTWIDTH*0.6
                  CLIAMANDWARRANTXINTERVAL = _width/8
                  WARRANTANDEVIDENCEXINTERVAL = _width/8
                  CLAIMX = _width/12
                  WARRANTX = CLAIMX + CLIAMANDWARRANTXINTERVAL
                  EVIDENCEX = WARRANTX + RECTWIDTH + WARRANTANDEVIDENCEXINTERVAL

                  DOTTEDLINEWIDTH = (_width - LEFT - RIGHT)/3
                  DOTTEDLINEX1 = LEFT
                  DOTTEDLINEX2 = DOTTEDLINEX1 + DOTTEDLINEWIDTH
                  DOTTEDLINEX4 = _width - RIGHT
                  DOTTEDLINEX3 = DOTTEDLINEX4 - DOTTEDLINEWIDTH
                  TITLEXLEFT = 10
                  TITLEX = DOTTEDLINEX2 + TITLEXLEFT
                  TITLEFONTSIZE = 16

                  LASTY = TOP //开始的时候把升降机调整到最顶端的边距位置

                  TITLEANDRECTINTERVALY = 60

                  CLAIMANDSUPPORTINTERVALY = 40
                  SUPPORTANDSUPPORTINTERVALY = 10
                  MOKUAIANDMOKUAIINTERVALY = 30

                  DISSENTTXTX = (_width - LEFT - RIGHT)/16
                  DISSENTTXTWIDTH = _width*0.8
                  DISSENTTXTHEIGHT = DISSENTTXTWIDTH * 0.3
                  DISSENTTXTANDDISSENTEXPLAININTERVALY = 30

                  NEXTBUTTONWIDTH = _width*0.8
                  NEXTBUTTONHEIGHT = NEXTBUTTONWIDTH*0.2
                  NEXTBUTTONX = (_width - LEFT - RIGHT)*0.167454

                  svg = d3.select(element.find("svg")[0])
                  svg.attr("width","1200px")
                  svg.attr("height","6000px")


                  scope.addDissentArr = {}
              }

              function draw(){
                  clearDraw()
                  if(scope.debateInfo.preFinish){
                      //如果是准结束阶段,那么只有異議説明可以分析
                  }else{
                      painTitle("construct")
                      if(scope.analysisData){
                          paintFromData("construct",scope.analysisData.analysisResult,0,"")
                      }

                  }

                  if(scope.analysisDissentExplainData){
                      for(var i=0;i<scope.analysisDissentExplainData.length;i++){
                          if(!scope.analysisDissentExplainData[i].analysisResult[0].claim) return
                          painTitle("dissentExplain")
                          paintFromData("dissentExplain",scope.analysisDissentExplainData[i].analysisResult,i,scope.analysisDissentExplainData[i].txt)
                      }
                  }



                  //如果是在表明异议的阶段的话则在最下方画一个下一步的按钮,点击后进入下一阶段
                  if((scope.debateInfo.status == 'appeal' && scope.debateInfo.position == 2) || (scope.debateInfo.status == 'lookup' && scope.debateInfo.position == 1)){
                      addNextButton(LASTY)
                  }
              }


              function paintFromData(category,data,dissentExplainI,dissentTxt){
                  var mainArrowStart
                  var mainArrowEnd = []
                  if(dissentTxt){
                      //如果category == dissentExplain 那么说明这里需要显示是对哪条质疑的解释
                      appendDissentTxt(dissentTxt,DISSENTTXTX,LASTY)
                  }
                  for(var i=0;i<data.length;i++){
                      if(!data[i].claim) return;
                      mainArrowStart = appendClaim(data[i].claim,[category,i,0,"claim",dissentExplainI])
                      dealWithLastY("claim",data,i,0)

                      for(var j=0;j<data[i].support.length;j++){

                          if(data[i].support[j].warrant){
                              appendWarrant(data[i].support[j].warrant,[category,i,j,"warrant",dissentExplainI])
                              dealWithLastY("warrant",data,i,j)
                          }

                          //再画evidence

                          if(data[i].support[j].evidence){
                              mainArrowEnd.push(appendEvidence(data[i].support[j].evidence,[category,i,j,"evidence",dissentExplainI]))
                              dealWithLastY("evidence",data,i,j)
                          }

                      }

                  }

                  if(mainArrowEnd.length>0){
                      drawMainArrow(mainArrowStart,mainArrowEnd)
                  }

              }

              function appendClaim(text,conf){
                  appendRect(text,CLAIMX,LASTY,"claim",conf)
                  return {x:CLAIMX+CLIAMANDWARRANTXINTERVAL/2,y:LASTY+RECTHEIGHT}
              }

              function appendWarrant(text,conf){
                  appendRect(text,WARRANTX,LASTY,"warrant",conf)
                  return {x:WARRANTX,y:LASTY+RECTHEIGHT/2}
              }

              function appendEvidence(text,conf){
                  appendRect(text,EVIDENCEX,LASTY,"evidence",conf)
                  return {x:EVIDENCEX,y:LASTY+RECTHEIGHT/2}
              }

              function dealWithLastY(type,data,i,j){
                  if(type == "claim"){
                        if(data[i].support[j].evidence){
                            //如果这个claim下面的evidence存在的话
                            LASTY += CLAIMANDSUPPORTINTERVALY + RECTHEIGHT
                        }
                  }

                  if(type == "warrant"){
                      if(!data[i].support[j].evidence){
                          //如果对应的warrant不存在的话,那么看看有没有下一个evidence
                          LASTY += MOKUAIANDMOKUAIINTERVALY + RECTHEIGHT
                      }
                  }

                  if(type == "evidence"){
                      if(data[i].support[j+1]){
                          //画完了warrant,如果下一个support存在的话
                            LASTY += SUPPORTANDSUPPORTINTERVALY + RECTHEIGHT

                      }else{
                          //如果下一个support不存在的话不管如何升降机往下
                            LASTY += MOKUAIANDMOKUAIINTERVALY + RECTHEIGHT
                      }
                  }

              }


              function appendRect(text,x,y,type,conf){
                  var foreignObject = svg.append("foreignObject")
                  foreignObject.attr("width",RECTWIDTH)
                  foreignObject.attr("height",RECTHEIGHT)
                  foreignObject.attr("class","draw")
                  foreignObject.attr("x",x)
                  foreignObject.attr("y",y)

                  var div = foreignObject.append('xhtml:div')
                  div.style("width",RECTWIDTH+"px")
                  div.style("height",RECTHEIGHT+"px")

                  var panel = div.append("div")
                  panel.attr("borderd",0)
                  panel.attr("class","panel panel-default")
                  panel.style("height","100%")

                  var head = panel.append("div")
                  head.attr("class","panel-heading")
                  var spanTitle = head.append("span")

                  if(type == "claim"){
                      spanTitle.text("主張")
                  }

                  if(type == "warrant"){
                      spanTitle.text("論拠")
                  }

                  if(type == "evidence"){
                      spanTitle.text("根拠")
                  }


                  if(scope.debateInfo.status != 'appeal' && scope.debateInfo.status != 'lookup' && scope.debateInfo.status != 'kentou' && scope.debateInfo.status != 'check'){
                      var edit = head.append("span")
                      edit.attr("class","pull-right")
                      var divId = "btn"+Math.round(Math.random()*10000)
                      edit.attr("id",divId)


                      if(scope.LAN == 'JP'){
                          var html = '<a class="pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">編集</a>'
                      }else{
                          var html = '<a class="pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">修改</a>'
                      }


                      angular.element(document.getElementById(divId)).append($compile(html)(scope));
                  }




                  var body = panel.append("div")
                  body.attr("class","panel-body")
                  body.style("height","63%")
                  body.style("overflow","auto")
                  body.text(text)

                  dealWithClick(panel,conf,text)
              }


              function dealWithClick(foreignObject,conf,text){

                  if(conf[3] == "claim"){
                        return;
                  }
                  if((scope.debateInfo.status == 'appeal' && scope.debateInfo.position == 2) || (scope.debateInfo.status == 'lookup' && scope.debateInfo.position == 1)){
                      foreignObject.on("click",function(){

                          var borderd = (parseInt(foreignObject.attr("borderd"))+1) % 2
                          foreignObject.attr("borderd",borderd)
                          if(borderd == 1){
                              this.style.border = "4px solid yellow"
                              addDissentArr(conf,text)
                          }else{
                              this.style.border = ""
                              removeDissentArr(conf)
                          }
                      })
                  }

              }




              function toNextStep(){

                  scope.dissentData = []

                  scope.statementData = ""

                  if(angular.equals(scope.addDissentArr, {})){
                      //如果没有选择质疑的选项那么直接进入下一步的立論的部分
                      scope.statementStatus = {name:"claim",i:0}

                      if((scope.debateInfo.order == scope.totalNum-1) && (scope.debateInfo.status == 'lookup')){
                          //说明现在这个阶段不能立論了,因为快要结束了
                          //而且在这里没有质疑那么直接提交空的異議説明和空的立論
                          scope.lastStatement = 1
                          coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                      }else{

                      }
                  }else{

                      scope.statementStatus = {name:"dissent",i:0}
                  }



                  for(var i in scope.addDissentArr){
                      if(scope.addDissentArr[i].res == 0) continue;

                      var category = scope.addDissentArr[i].category
                      var _i = scope.addDissentArr[i].i
                      var _j = scope.addDissentArr[i].j
                      var type = scope.addDissentArr[i].type
                      var txt = scope.addDissentArr[i].txt
                      var indexToAnalysis = scope.addDissentArr[i].indexToAnalysis
                      var indexToStatement = scope.addDissentArr[i].indexToStatement
                      scope.dissentData.push({category:category,type:type,txt:txt,reply:"",i:_i,j:_j,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement})
                      scope.statementStatus = {name:"dissent",i:0}

                  }

                  coreSocket.emit("selectDissent",{dissentData:scope.dissentData,statementStatus:scope.statementStatus,statementData:scope.statementData})

              }


              function addDissentArr(conf,text){
                  // get index

                  var _category = conf[0]
                  var _i = conf[1]
                  var _j = conf[2]
                  var _type =  conf[3]
                  var indexToAnalysis,indexToStatement //statement's index <--> analysis random(_index) <----> statements' random(__index) statement中異議説明连analysis中的random,然后再通过analysis中的index找到最初对哪个statement质疑的
                  var dissentExplainI = conf[4]





                  if(_category == "construct"){
                      indexToStatement = scope.analysisData.indexToStatement
                      if(_type == "claim"){
                          indexToAnalysis = scope.analysisData.analysisResult[_i].random
                      }else if(_type == "warrant"){
                          indexToAnalysis = scope.analysisData.analysisResult[_i].support[_j].wrandom
                      }else if(_type == "evidence"){
                          indexToAnalysis = scope.analysisData.analysisResult[_i].support[_j].erandom
                      }else{
                          alert("error0")
                      }


                  }else if(_category == "dissentExplain"){

                      indexToStatement = scope.analysisDissentExplainData[dissentExplainI].indexToStatement
                      if(_type == "claim"){
                          indexToAnalysis = scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].random
                      }else if(_type == "warrant"){
                          indexToAnalysis = scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].wrandom
                      }else if(_type == "evidence"){
                          indexToAnalysis = scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].erandom
                      }else{
                          alert("error1")
                      }

                  }else{
                      alert("error2")
                  }

                  scope.addDissentArr[conf.join("")] = {res:1,category:conf[0],i:conf[1],j:conf[2],type:conf[3],txt:text,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement}
              }

              function removeDissentArr(conf){
                  scope.addDissentArr[conf.join("")] = {res:0}
              }


              function appendDissentTxt(txt,x,y){
                  var foreignObject = svg.append("foreignObject")
                  foreignObject.attr("width",DISSENTTXTWIDTH)
                  foreignObject.attr("height",DISSENTTXTHEIGHT)
                  foreignObject.attr("class","draw")
                  foreignObject.attr("x",x)
                  foreignObject.attr("y",y)
                  var div = foreignObject.append('xhtml:div')
                  div.style("width",DISSENTTXTWIDTH+"px")
                  div.style("height",DISSENTTXTHEIGHT+"px")


                  var panel = div.append("div")
                  panel.attr("class","panel panel-default")
                  panel.style("height","100%")

                  var head = panel.append("div")
                  head.attr("class","panel-heading")
                  head.text("いかの内容に対する異議説明")

                  var body = panel.append("div")
                  body.attr("class","panel-body")
                  body.style("height","63%")
                  body.style("overflow","auto")
                  body.text(txt)

                  //调整升降机
                  LASTY += DISSENTTXTANDDISSENTEXPLAININTERVALY + DISSENTTXTHEIGHT

              }

              function painTitle(type){
                  //左边部分的虚线
                  drawDottedLine(DOTTEDLINEX1,DOTTEDLINEX2,LASTY)

                  if(type == "construct"){
                          drawText("立論の分析結果",TITLEX,LASTY+TITLEFONTSIZE/2,TITLEFONTSIZE)
                  }else{
                          drawText("異議説明文の分析結果",TITLEX,LASTY+TITLEFONTSIZE/2,TITLEFONTSIZE)
                  }

                  //右边部分的虚线
                  drawDottedLine(DOTTEDLINEX3,DOTTEDLINEX4,LASTY)

                  LASTY += TITLEANDRECTINTERVALY
              }

              function drawDottedLine(x1,x2,y){
                  var line = svg.insert("line")
                          .attr("x1",x1)
                          .attr("y1",y)
                          .attr("x2",x2)
                          .attr("y2",y)
                          .attr("stroke","#000")
                          .attr("stroke-width",3)
                          .attr("class","arrow draw")
                          .attr("stroke-dasharray","4,10")
              }


              function drawText(txt,x,y,font){
                  var text = svg.insert("text")
                  text.text(txt)
                  text.attr("x",x)
                          .attr("y",y)
                          .attr("font-size",font)
                          .attr("fill","#8a6d3b")
                          .attr("class","draw")
              }


              function drawMainArrow(start,end){
                  var len = end.length
                  drawArrow(start.x,start.x,start.y,end[len-1].y)

                  for(var i=0;i<end.length;i++){
                      drawArrow(start.x,end[i].x,end[i].y,end[i].y)
                  }

              }

              function drawArrow(x1,x2,y1,y2){
                  var line = svg.insert("line",":first-child")
                          .attr("x1",x1)
                          .attr("y1",y1)
                          .attr("x2",x2)
                          .attr("y2",y2)
                          .attr("stroke","#9acfea")
                          .attr("stroke-width",3)
                          .attr("class","arrow draw")
              }

              function addNextButton(y){
                  // will work when we need to add dissent on to the map
                  var foreignObject = svg.append("foreignObject")

                  foreignObject.attr("x",NEXTBUTTONX)
                  foreignObject.attr("y",y)
                  foreignObject.attr("width",NEXTBUTTONWIDTH)
                  foreignObject.attr("height",NEXTBUTTONHEIGHT)

                  var _div = foreignObject.append('xhtml:div')

                  var button = _div.append("button")
                      button.html("次へ")

                  button.attr("type","button")
                  button.attr("class","btn btn-default btn-lg pull-right")
                  button.style("width",NEXTBUTTONWIDTH+"px")
                  button.style("height",NEXTBUTTONHEIGHT+"px")
                  button.on("click",function(){
                      console.log(scope.addDissentArr)
                      toNextStep()
                  })

              }

          },
          templateUrl:"/angularJSTemplate/public/analysisResult2.html"
      }
    })

    myApp.directive("analysisResult",function(coreSocket,$compile){
        return {
            scope:false,
            link:function($scope,$element){
                var RECTWIDTH = 450
                var RECTHEIGHT = 150
                var OFFSETLEFT = 80
                var OFFSETTOP = 100


                var SPACECWH = 80   //interval between claim and warrant vertical
                var SPACECCH = 100    //interval between claim and claim vertical
                var SPACEWWH = 60  //interval between warrant and warrant vertical


                var SPACECWW = 100   // interval between claim and warrant level
                var SPACEWEW = 50   // interval between evidence and warrant level
                var MAINLINEOFFSETLEFT = OFFSETLEFT + 40
                var LASTY = 0
                var LASTX = 0


                var DOTTEDLINEMARGINTOP = 50
                var DOTTEDLINEMARGINBOTTOM = 10
                var DOTTEDLINELENGTH = 350
                var DOTTEDLINESPACE = 350
                var DOTTEDLINEMARGINLEFT = 30

                //var svg = d3.select("#mainSVG").append("svg")
                var svg = d3.select($element.find("svg")[0])
                svg.attr("width","1200px")
                svg.attr("height","6000px")
                //svg.attr("id","mainSVG"+Math.round(Math.random()*1000))
                $scope.addDissentArr = {}



                function init(){
                    clearDraw()
                    draw()
                }


                $scope.$on('click',function(event, data){
                    clearDraw()
                    draw()
                });



                $scope.$on('analysisInit',function(event, data){
                    init()
                });

                function clearDraw(){
                    svg.selectAll(".draw").remove()
                    LASTX = 0
                    LASTY = 0
                }

                init()

                function draw(){
                    LASTY += OFFSETTOP
                    LASTX += OFFSETLEFT

                    if($scope.debateInfo.preFinish){
                        //如果是准结束阶段,那么只有異議説明可以分析

                    }else{
                        painTitle("construct",LASTX,LASTY)
                        if($scope.analysisData){
                            paintFromData("construct",$scope.analysisData.analysisResult,0)
                        }

                    }


                    if($scope.analysisDissentExplainData){
                        for(var i=0;i<$scope.analysisDissentExplainData.length;i++){
                            if(!$scope.analysisDissentExplainData[i].analysisResult[0].claim) return
                            painTitle("dissentExplain",LASTX,LASTY)
                            paintFromData("dissentExplain",$scope.analysisDissentExplainData[i].analysisResult,i)
                        }
                    }


                }


                function paintFromData(category,data,dissentExplainI){
                    var startY = LASTY
                    for(var i=0;i<data.length;i++){
                        if(!data[i].claim) return;
                        appendRect(data[i].claim,data[i].cDissent,LASTX,LASTY,[category,i,0,"claim",dissentExplainI])

                        if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){
                            appendHint(LASTX,LASTX)
                        }

                        for(var j=0;j<data[i].support.length;j++){

                            //先画warrant
                            if(data[i].support[j].warrant || data[i].support[j].evidence){

                                if(j==0){
                                    LASTY += (SPACECWH+RECTHEIGHT)
                                }else{
                                    LASTY += (SPACEWWH+RECTHEIGHT)
                                }


                            }

                            LASTX += (SPACECWW)

                            if(data[i].support[j].warrant){
                                appendRect(data[i].support[j].warrant,data[i].support[j].wDissent,LASTX,LASTY,[category,i,j,"warrant",dissentExplainI])
                            }



                            //再画evidence

                            LASTX += (RECTWIDTH + SPACEWEW)
                            if(data[i].support[j].evidence){
                                appendRect(data[i].support[j].evidence,data[i].support[j].eDissent,LASTX,LASTY,[category,i,j,"evidence",dissentExplainI])
                                drawArrow(MAINLINEOFFSETLEFT,LASTX,LASTY+RECTHEIGHT/2,LASTY+RECTHEIGHT/2)
                            }

                            LASTX -= (RECTWIDTH + SPACEWEW + SPACECWW)

                        }

                        LASTY += (SPACECCH + RECTHEIGHT)
                    }


                    drawMainArrow(startY,LASTY)
                }


                function painTitle(type,x,y){

                    drawDottedLine(LASTX+DOTTEDLINEMARGINLEFT-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP,LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP)

                    if(type == "construct"){
                        if($scope.LAN == 'JP'){
                            drawText("立論の分析結果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }else{
                            drawText("原始阐述说明的分析结果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }

                    }else{

                        if($scope.LAN == 'JP'){
                            drawText("異議説明文の分析結果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }else{
                            drawText("质疑解释说明的分析结果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }

                    }

                    drawDottedLine(LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH+DOTTEDLINESPACE-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP,LASTX+DOTTEDLINEMARGINLEFT+2*DOTTEDLINELENGTH+DOTTEDLINESPACE-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP)


                }

                function drawMainArrow(y1,y2){
                    var mainLine = svg.insert("line",":first-child")
                            .attr("x1",MAINLINEOFFSETLEFT)
                            .attr("y1",y1)
                            .attr("x2",MAINLINEOFFSETLEFT)
                            .attr("y2",y2+RECTHEIGHT-((SPACECCH + RECTHEIGHT))-RECTHEIGHT/2)
                            .attr("stroke","#9acfea")
                            .attr("stroke-width",5)
                            .attr("class","arrow draw")
                }

                function drawArrow(x1,x2,y1,y2){
                    var line = svg.insert("line",":first-child")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#9acfea")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                }

                function appendHint(x,y){
                    /*
                    var circle = svg.append("circle")
                    var circleR = 10
                    circle.attr("cy",y + RECTHEIGHT/2 - 2*circleR)
                    circle.attr("cx",x + 1.4*RECTWIDTH)
                    circle.style("fill","blue")
                    circle.attr("r",circleR)
                    */

                    var foreignObject = svg.append("foreignObject")
                    var hintWidth = 360
                    var hintHeight = 120
                    foreignObject.attr("width",hintWidth)
                    foreignObject.attr("height",hintHeight)

                    foreignObject.attr("y",y )
                    foreignObject.attr("x",x + 1.4*RECTWIDTH)
                    var _div = foreignObject.append('xhtml:div')
                    var image = _div.append("img")
                    image.attr("src", "/leftPointer.png")
                            .attr("width", "100")
                            .attr("height", "100");
                    foreignObject.transition().duration(1000).ease(d3.easeBounce).attr("x", x + 1.02*RECTWIDTH).attr("fill", "red");

                    var text = _div.append("span")
                    if($scope.LAN == 'JP'){
                        text.text("異議がある部分を選んでください")
                    }else{
                        text.text("点击选择您想要质疑的那一项")
                    }


                    text.style("color","rgb(138, 109, 59)")
                    text.style("font-size","16px")
                }

                function appendRect(txt,dissent,x,y,conf){

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH)
                    foreignObject.attr("height",RECTHEIGHT)
                    foreignObject.attr("class","draw")

                    if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){


                        var bordered = foreignObject.attr("bordered") || 1

                            foreignObject.on("click",function(){


                                if(conf[3] == "claim"){
                                    //规定主张不能被质疑
                                    return false;
                                }

                                if(bordered %2 == 1){
                                    this.style.border = "4px solid yellow"
                                    var div = _div.append("div")
                                    var button = _div.append("button")

                                    if($scope.LAN == 'JP'){
                                        button.html("異議あり")
                                    }else{
                                        button.html("被质疑")
                                    }
                                    button.attr("type","button")
                                    button.attr("class","btn btn-danger pull-right")
                                    button.attr("id",conf.join(""))


                                    // get index


                                    var _category = conf[0]
                                    var _i = conf[1]
                                    var _j = conf[2]
                                    var _type =  conf[3]
                                    var indexToAnalysis,indexToStatement //statement's index <--> analysis random(_index) <----> statements' random(__index) statement中異議説明连analysis中的random,然后再通过analysis中的index找到最初对哪个statement质疑的
                                    var dissentExplainI = conf[4]





                                    if(_category == "construct"){
                                        indexToStatement = $scope.analysisData.indexToStatement
                                        if(_type == "claim"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].random
                                        }else if(_type == "warrant"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].support[_j].wrandom
                                        }else if(_type == "evidence"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].support[_j].erandom
                                        }else{
                                            alert("error0")
                                        }


                                    }else if(_category == "dissentExplain"){

                                        indexToStatement = $scope.analysisDissentExplainData[dissentExplainI].indexToStatement
                                        if(_type == "claim"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].random
                                        }else if(_type == "warrant"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].wrandom
                                        }else if(_type == "evidence"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].erandom
                                        }else{
                                            alert("error1")
                                        }

                                    }else{
                                        alert("error2")
                                    }

                                    $scope.addDissentArr[conf.join("")] = {res:1,category:conf[0],i:conf[1],j:conf[2],type:conf[3],txt:txt,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement}

                                }else{
                                    this.style.border = ""
                                    d3.select("#"+conf.join("")).remove()
                                    $scope.addDissentArr[conf.join("")] = {res:0}
                                }

                                foreignObject.attr("bordered",++bordered)
                            })

                        }


                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)



                    var _div = foreignObject.append('xhtml:div')
                    var div = _div.append("div")
                    div.attr("class","alert alert-info draw")
                    div.attr("role","alert")
                    div.attr("style","height: 100px; overflow: auto;margin-bottom:1px")

                    var p = div.append("p")

                    var liebie
                    if($scope.LAN == "JP"){
                        if(conf[3] == "claim"){
                            liebie = "主張"
                        }else if(conf[3] == "evidence"){
                            liebie = "根拠"
                        }else{
                            liebie = "論拠"
                        }
                    }


                    if($scope.LAN == "CN"){
                        if(conf[3] == "claim"){
                            liebie = "主张"
                        }else if(conf[3] == "evidence"){
                            liebie = "证据"
                        }else{
                            liebie = "理由"
                        }
                    }


                    p.html(liebie+":"+txt)


                    //如果是在表明异议的阶段的话则不提供修改功能
                    //如果是在检查阶段则不提供修改功能
                    if($scope.debateInfo.status != 'appeal' && $scope.debateInfo.status != 'lookup' && $scope.debateInfo.status != 'kentou' && $scope.debateInfo.status != 'check'){
                        var div = _div.append("div")

                        //-----------------------------------------------
                        var divId = "btn"+Math.round(Math.random()*10000)
                        div.attr("id",divId)


                        if($scope.LAN == 'JP'){
                            var html = '<button class="btn btn-default pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">編集</button>'
                        }else{
                            var html = '<button class="btn btn-default pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">修改</button>'
                        }


                        angular.element(document.getElementById(divId)).append($compile(html)($scope));
                    }


                }


                function drawDottedLine(x1,y1,x2,y2){
                    var line = svg.insert("line")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#000")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                            .attr("stroke-dasharray","4,10")
                }


                function drawText(txt,x,y,font){
                    var text = svg.insert("text")
                    text.text(txt)
                    text.attr("x",x)
                            .attr("y",y)
                            .attr("font-size",font)
                            .attr("fill","#8a6d3b")
                            .attr("class","draw")
                }


                //如果是在表明异议的阶段的话则在最下方画一个下一步的按钮,点击后进入下一阶段
                if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){
                    addNextButton(LASTX,LASTY)
                }


                function addNextButton(x,y){
                    // will work when we need to add dissent on to the map
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH*1.2)
                    foreignObject.attr("height",RECTHEIGHT)

                    foreignObject.attr("x",x+RECTWIDTH)
                    foreignObject.attr("y",y-RECTHEIGHT)

                    if($scope.LAN == 'JP'){
                        drawText("次は立論と異議の説明文です....",x+RECTWIDTH+OFFSETLEFT+30,y-0.6*RECTHEIGHT,16)
                    }else{
                        drawText("接下来进入质疑解释说明和原始阐述说明阶段....",x+RECTWIDTH+OFFSETLEFT+30,y-0.6*RECTHEIGHT,16)
                    }

                    var _div = foreignObject.append('xhtml:div')

                    var button = _div.append("button")
                    if($scope.LAN == 'JP'){
                        button.html("次へ")
                    }else{
                        button.html("下一步")
                    }


                    button.attr("type","button")
                    button.attr("class","btn btn-default btn-lg pull-right")
                    button.style("margin-top","30px")
                    button.on("click",function(){
                        console.log("confirm dissent arr")
                        console.log($scope.addDissentArr)
                        toNextStep()
                    })

                    var image = _div.append("img")

                    image.attr("src", "/rightPointer.png")
                            .attr("width", "100")
                            .attr("height", "100");

                }




                function toNextStep(){

                    $scope.dissentData = []

                    $scope.statementData = ""

                    if(angular.equals($scope.addDissentArr, {})){
                        //如果没有选择质疑的选项那么直接进入下一步的立論的部分
                        $scope.statementStatus = {name:"claim",i:0}

                        if(($scope.debateInfo.order == $scope.totalNum-1) && ($scope.debateInfo.status == 'lookup')){
                            //说明现在这个阶段不能立論了,因为快要结束了
                            //而且在这里没有质疑那么直接提交空的異議説明和空的立論
                            $scope.lastStatement = 1
                            coreSocket.emit("giveStatement",{dissentData:$scope.dissentData,statementData:$scope.statementData})
                        }else{

                        }
                    }else{

                        $scope.statementStatus = {name:"dissent",i:0}
                    }



                    for(var i in $scope.addDissentArr){
                        if($scope.addDissentArr[i].res == 0) continue;

                        var category = $scope.addDissentArr[i].category
                        var _i = $scope.addDissentArr[i].i
                        var _j = $scope.addDissentArr[i].j
                        var type = $scope.addDissentArr[i].type
                        var txt = $scope.addDissentArr[i].txt
                        var indexToAnalysis = $scope.addDissentArr[i].indexToAnalysis
                        var indexToStatement = $scope.addDissentArr[i].indexToStatement
                        $scope.dissentData.push({category:category,type:type,txt:txt,reply:"",i:_i,j:_j,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement})
                        $scope.statementStatus = {name:"dissent",i:0}

                    }

                    coreSocket.emit("selectDissent",{dissentData:$scope.dissentData,statementStatus:$scope.statementStatus,statementData:$scope.statementData})

                }


                $scope.edit = function(category,i,j,type,dissentExplainI){
                    if(category == "construct"){
                        $scope.inputStatus.i = i
                        $scope.inputStatus.j = j
                        $scope.inputStatus.name = type
                        $scope.analysisObject.target = category

                    }else if(category == "dissentExplain"){
                        $scope.analysisObject.i = parseInt(dissentExplainI)
                        $scope.analysisObject.target = category
                        $scope.inputStatus.i = i
                        $scope.inputStatus.j = j
                        $scope.inputStatus.name = type
                    }else{

                    }

                    checkIfOriginalDataExists()
                    //让textarea显示相应的内容
                }


                function checkIfOriginalDataExists(){
                    var status = $scope.inputStatus.name
                    var target = $scope.analysisObject.target
                    if(target == "construct"){
                        var data = $scope.analysisData.analysisResult
                    }else{
                        var data = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult
                    }
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if(status == "claim"){
                        $scope._contents = data[i].claim
                    }else if(status == "evidence"){
                        $scope._contents = data[i].support[j].evidence
                    }else if(status == "warrant"){
                        $scope._contents = data[i].support[j].warrant
                    }else{

                    }

                }



            },

            templateUrl:"/angularJSTemplate/public/analysisResult.html"
        }
    })

// no analysis function process

    myApp.directive("noAnalysisStartDebate",function(coreSocket){
        return {
            scope:false,
            link:function(scope,element){
                if(scope.debateInfo.order > 0){
                    //非第一次,有东西可以反驳
                    scope.statementStatus = {name:"rebuttal",i:0}
                }else{
                    //第一次只能陈述没有什么可以反驳的
                    scope.statementStatus = {name:"claim",i:0}
                }
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{rebuttalData:scope.rebuttalData,statementData:scope.statementData})
                    scope.statementStatus.name = "wait"
                }

                scope.selectRebuttal = function(random,txt,type){


                    if(scope.debateInfo.position == 0){
                        //旁观者无触发
                        return;
                    }

                    if(scope.statementStatus.name == 'rebuttal' || scope.statementStatus.name == 'claim'){
                            if(scope.debateInfo.position == 2) return //等待方点击后不会触发选择效果
                    }else{
                        return;
                    }

                    var elements = document.getElementsByClassName("rebuttalElement")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.border = ""
                    }

                    var elements = document.getElementsByClassName("gk")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.display = "none"
                    }

                    var borderStyle = "3px solid yellow"
                    if(document.getElementById("rebuttal"+random).style.border == borderStyle){
                        document.getElementById("rebuttal"+random).style.border = ""
                        document.getElementById("gk"+random).style.display = "none"
                    }else{
                        document.getElementById("rebuttal"+random).style.border = borderStyle
                        document.getElementById("gk"+random).style.display = "block"
                    }

                    //你选择了哪段内容进行反驳
                    scope.selectedRandom = random
                    scope.selectedTxt = txt


                    scope.rebuttalData[scope.statementStatus.i].indexToStatement = scope.selectedRandom  //反驳 data



                    if(type == "claim"){
                        scope.rebuttalData[scope.statementStatus.i].level = 1 //第几反駁 反正也是从0加到1
                        scope.selectedLevel = 1
                    }else if(type == "rebuttal"){
                        scope.rebuttalData[scope.statementStatus.i].level = scope.debateInfo.order + 1
                        scope.selectedLevel = scope.debateInfo.order + 1 //选择的内容属于第几级
                    }else{
                        alert("t901")
                    }

                }

                scope.modoru = function(){
                    var elements = document.getElementsByClassName("rebuttalElement")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.border = ""
                    }


                    var elements = document.getElementsByClassName("gk")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.display = "none"
                    }

                    scope.selectedRandom = ""
                    scope.selectedTxt = ""
                }

            },
            templateUrl:"/angularJSTemplate/process/noAnalysisStartDebate.html"
        }
    })

    myApp.directive("noAnalysisFuncAppealAndStateDebate",function(coreSocket){
        return {
            scope:false,
            link:function(scope,element){
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{rebuttalData:scope.rebuttalData,statementData:scope.statementData})
                    scope.statementStatus.name = "wait"
                }

                scope.selectRebuttal = function(random,txt,type){


                    if(scope.debateInfo.position == 0){
                        //旁观者无触发
                        return;
                    }

                    if(scope.statementStatus.name == 'rebuttal' || scope.statementStatus.name == 'claim'){
                            if(scope.debateInfo.position == 1) return; //等待方点击后不会触发选择效果
                    }else{
                        return;
                    }


                    var elements = document.getElementsByClassName("rebuttalElement")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.border = ""
                    }


                    var elements = document.getElementsByClassName("gk")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.display = "none"
                    }


                    var borderStyle = "3px solid yellow"
                    if(document.getElementById("rebuttal"+random).style.border == borderStyle){
                        document.getElementById("rebuttal"+random).style.border = ""
                        document.getElementById("gk"+random).style.display = "none"
                    }else{
                        document.getElementById("rebuttal"+random).style.border = borderStyle
                        document.getElementById("gk"+random).style.display = "block"
                    }

                    //你选择了哪段内容进行反驳
                    scope.selectedRandom = random
                    scope.selectedTxt = txt

                    scope.rebuttalData[scope.statementStatus.i].indexToStatement = scope.selectedRandom  //反驳 data
                    if(type == "claim"){
                        scope.rebuttalData[scope.statementStatus.i].level = 1 //第几反駁 反正也是从0加到1
                        scope.selectedLevel = 1
                    }else if(type == "rebuttal"){
                        scope.rebuttalData[scope.statementStatus.i].level = scope.debateInfo.order + 1
                        scope.selectedLevel = scope.debateInfo.order + 1//选择的内容属于第几级
                    }else{
                        alert("t902")
                    }
                }

                scope.modoru = function(){
                    var elements = document.getElementsByClassName("rebuttalElement")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.border = ""
                    }


                    var elements = document.getElementsByClassName("gk")
                    for(var i=0;i<elements.length;i++){
                        elements[i].style.display = "none"
                    }

                    scope.selectedRandom = ""
                    scope.selectedTxt = ""
                }
            },
            templateUrl:"/angularJSTemplate/process/noAnalysisFuncAppealAndStateDebate.html"
        }
    })


    myApp.directive("noAnalysisFinishDebate",function(myPost,coreSocket){
        return {
            scope:false,
            link:function(scope){

                scope.conceptStatus = "judgeMent"

                if(scope.debateInfo.position == 1){
                    if(scope.debateInfo.proRate){
                        scope.rateable = 0
                    }else{
                        scope.rateable = 1
                    }
                }

                if(scope.debateInfo.position == 2){
                    if(scope.debateInfo.conRate){
                        scope.rateable = 0
                    }else{
                        scope.rateable = 1
                    }

                }

                scope.determines = function(n){
                    // 1 win
                    // 2 draw
                    // 3 lost
/*
                    myPost.postData("/release/rate",{rate:n}).then(function(_res){
                        if(_res.data.err == 0){
                            scope.isReadonly = true;
                            scope.rateable = false
                            scope.debateInfo.proRate = _res.data.data.proRate
                            scope.debateInfo.conRate = _res.data.data.conRate

                            if(scope.debateInfo.proRate && scope.debateInfo.conRate){
                                scope.debateInfo.finish = true;
                            }
                        }
                    })
*/

                    coreSocket.emit("rate",{rate:n})

                }

                coreSocket.on("rated",function(msg){
                    if(msg.err == 0){
                        scope.debateInfo.proRate = msg.data.proRate
                        scope.debateInfo.conRate = msg.data.conRate
                        if(scope.debateInfo.position == 1 && scope.debateInfo.proRate){
                            scope.isReadonly = true;
                            scope.rateable = false
                        }

                        if(scope.debateInfo.position == 2 && scope.debateInfo.conRate){
                            scope.isReadonly = true;
                            scope.rateable = false
                        }




                        if(scope.debateInfo.proRate && scope.debateInfo.conRate){
                            scope.debateInfo.finish = true;
                        }
                    }

                })
            },
            templateUrl:"/angularJSTemplate/process/noAnalysisfinishDebate.html"
        }
    })





// no analysis function process finish



    myApp.directive("inputFormArea",function(coreSocket,$rootScope){
        return {
            scope:false,
            link:function($scope){
                $scope.conceptStatus = "analysis"   //concept directive controller

                $scope.topArticleChangeTabVal = 0



                transportInputInfo("FormInputing")

                $scope.$watch("analysisObject.target",function(val,preVal){
                    //从 construct变成dissentExplain
                    if(val == "dissentExplain" && preVal == "construct"){
                        $scope.topArticleChangeTabVal = 1
                        //$rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:1});
                    }

                    if(val == "construct" && preVal == "dissentExplain"){
                        $scope.topArticleChangeTabVal = 0
                        ///$rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:0});
                    }

                })

                $scope.$watch("analysisObject.i",function(val,preVal){
                    //从 dissentExplain[preVal] 变dissentExplain[val]
                    if($scope.analysisObject.target == "dissentExplain"){
                        $scope.topArticleChangeTabVal = $scope.topArticleChangeTabVal + 1
                        //$rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:val+1});
                   }
                })

                function addIntoAnalysisData(name){
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if($scope.analysisObject.target == "construct"){
                        if(name == "claim"){
                            $scope.analysisData.analysisResult[i].claim = $scope._contents
                        }

                        if(name == "evidence"){
                            $scope.analysisData.analysisResult[i].support[j].evidence = $scope._contents
                        }

                        if(name == "warrant"){
                            $scope.analysisData.analysisResult[i].support[j].warrant = $scope._contents
                        }
                    }


                    if($scope.analysisObject.target == "dissentExplain"){
                        var _i = $scope.analysisObject.i
                        if(name == "claim"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].claim = $scope._contents
                        }

                        if(name == "evidence"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].evidence = $scope._contents
                        }

                        if(name == "warrant"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = $scope._contents
                        }
                    }


                    //每次填写完当前的analysis信息后都更新debateStatus里面的everyAnalysisData字段
                    preSubmit()


                }



                $scope.output = function(){

                    if(!$scope._contents){
                        $scope.data1Success = 0
                        return;
                    }else{
                        $scope.data1Success = 1
                    }

                    if($scope.inputStatus.name == "claim"){
                        addIntoAnalysisData("claim")
                        $scope.inputStatus.name = "evidence"
                    }else if($scope.inputStatus.name == "evidence"){
                        addIntoAnalysisData("evidence")
                        $scope.inputStatus.name = "warrant"
                    }else if($scope.inputStatus.name == "warrant"){
                        addIntoAnalysisData("warrant")
                        $scope.inputStatus.name = "newEvidence"
                    }else if($scope.inputStatus.name == "newEvidence"){

                    }else if($scope.inputStatus.name == "newClaim"){

                    }else{

                    }

                    //让滚动条到最底端
                    $("#ak47").animate({scrollTop: 1000}, "slow")

                    //$("body").animate({scrollTop: $target.offset().top}, "slow");
                    //画图

                    $rootScope.$broadcast('click',{});

                    checkIfOriginalDataExists()

                    //将目前的表单输入信息传输给对方
                    transportInputInfo("FormInputing")

                }


                function checkIfOriginalDataExists(){
                    var status = $scope.inputStatus.name
                    var target = $scope.analysisObject.target
                    if(target == "construct"){
                        var data = $scope.analysisData.analysisResult
                    }else{
                        var data = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult
                    }
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if(status == "claim"){
                        $scope._contents = data[i].claim || ""
                    }else if(status == "evidence"){
                        $scope._contents = data[i].support[j].evidence || ""
                    }else if(status == "warrant"){
                        $scope._contents = data[i].support[j].warrant || ""
                    }else{

                    }


                }


                $scope.noClaim = function(){
                    //点击已经没有claim的按钮
                    if($scope.analysisObject.target == "construct"){
                        $scope.inputStatus.name = "claim"
                        $scope.inputStatus.i = 0
                        $scope.inputStatus.j = 0

                        if($scope.analysisDissentExplainData.length>0){
                            $scope.analysisObject = {target:"dissentExplain",i:0}
                            checkIfOriginalDataExists()
                        }else{
                            //console.log("send")
                            //coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                            //print()
                            $scope.analysisObject.target = "preview"
                            //画图
                            $rootScope.$broadcast("drawAnalysisResult",{})
                        }
                    } else if($scope.analysisObject.target == "dissentExplain"){
                        $scope.inputStatus.name = "claim"
                        $scope.inputStatus.i = 0
                        $scope.inputStatus.j = 0
                        if($scope.analysisObject.i<$scope.analysisDissentExplainData.length-1){
                            $scope.analysisObject.i = parseInt($scope.analysisObject.i) + 1
                            checkIfOriginalDataExists()
                        }else{
                            //console.log("send")
                            //coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                            //print()
                            $scope.analysisObject.target = "preview"
                            $rootScope.$broadcast("drawAnalysisResult",{})
                        }
                    }else{

                    }


                }


                function preSubmit(){
                    //还没提交以前把最新的analysis data 传给数据库,以便自己和对方都够看到当前即使填写的analysis data信息
                    console.log("pre submit analysis data")
                    console.log($scope.analysisData)
                    console.log($scope.analysisDissentExplainData)
                    coreSocket.emit("updateGiveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                }

                $scope.submit = function(){
                    console.log("submit analysis data")
                    console.log($scope.analysisData)
                    console.log($scope.analysisDissentExplainData)
                    coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                }

                $scope.noEvidence = function(){
                    //点击已经没有evidence的按钮
                    $scope.inputStatus.name = "newClaim"

                    //重新画图
                    $rootScope.$broadcast('click',{});

                }


                $scope.noCurrentEvidence = function(){
                    //没有在当前的i,j里找到evidence
                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j


                        if(j== $scope.analysisData.analysisResult[i].support.length-1){
                            //如果是最后一个evidence的话,去下一个claim或者去newClaim

                                if($scope.analysisData.analysisResult[i+1]){
                                    //如果下一个claim有内容的话,则去下一个claim
                                    $scope.inputStatus.name = "claim"
                                    $scope.inputStatus.i = i + 1
                                }else{
                                    //如果下一个claim没有内容的话,则去生成claim的选项
                                    $scope.inputStatus.name = "newClaim"
                                }

                        }else{
                            //如果舍弃的不是最后一个evidence的话,去下一个evidence
                            $scope.inputStatus.name = "evidence"
                        }


                        //不要删唯一的那个那个support
                        if($scope.analysisData.analysisResult[i].support.length > 1){
                            //说明至少还有两个support,删掉一个无所谓的
                            $scope.analysisData.analysisResult[i].support.splice(j,1)
                        }else{
                            $scope.analysisData.analysisResult[i].support[j].warrant = ""
                            $scope.analysisData.analysisResult[i].support[j].evidence = ""
                        }


                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        var _i = $scope.analysisObject.i


                        if(j== $scope.analysisDissentExplainData[_i].analysisResult[i].support.length-1){
                            //如果是最后一个evidence的话,去下一个claim或者去newClaim

                            if($scope.analysisDissentExplainData[_i].analysisResult[i+1]){
                                //如果下一个claim有内容的话,则去下一个claim
                                $scope.inputStatus.name = "claim"
                                $scope.inputStatus.i = i + 1
                            }else{
                                //如果下一个claim没有内容的话,则去生成claim的选项
                                $scope.inputStatus.name = "newClaim"
                            }

                        }else{
                            //如果舍弃的不是最后一个evidence的话,去下一个evidence
                            $scope.inputStatus.name = "evidence"
                        }


                        //不要删唯一的那个那个support
                        if($scope.analysisDissentExplainData[_i].analysisResult[i].support.length > 1){
                            //说明至少还有两个support,删掉一个无所谓的
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support.splice(j,1)
                        }else{
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = ""
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].evidence = ""
                        }


                    }else{

                    }



                    //重新画图
                    $rootScope.$broadcast('click',{});

                }

                $scope.noCurrentWarrant = function(){
                    //点击已经没有warrant的按钮



                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        $scope.analysisData.analysisResult[i].support[j].warrant = ""


                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        var _i = $scope.analysisObject.i
                        $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = ""


                    }else{

                    }

                    $scope.inputStatus.name = "newEvidence"
                    //重新画图
                    $rootScope.$broadcast('click',{});
                }

                $scope.setNewClaim = function(){
                    //点击还有claim的按钮


                    //如果下一步中有原先添加好的
                    var nextExistsOrNot = false

                    var _i = $scope.inputStatus.i

                    if($scope.analysisObject.target == "construct"){
                        if($scope.analysisData.analysisResult[_i+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.i = _i + 1
                            $scope.inputStatus.j = 0
                            $scope.inputStatus.name = "claim"
                            $scope._contents = $scope.analysisData.analysisResult[_i+1].claim || ""
                        }
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        if($scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.i = _i + 1
                            $scope.inputStatus.j = 0
                            $scope.inputStatus.name = "claim"
                            $scope._contents = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i+1].claim || ""
                        }
                    }else{

                    }


                    if(nextExistsOrNot){
                        return;
                    }



                    //接下来是处理如果下一步添加的是没有添加过的情况

                    $scope._contents = "" //先清空表单
                    $scope.inputStatus.i++

                    $scope.inputStatus.j = 0
                    $scope.inputStatus.name = "claim"


                    if($scope.analysisObject.target == 'construct'){
                        $scope.analysisData.analysisResult.push({claim:"",support:[
                            {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        ],random:Math.round(Math.random()*100000)})
                    }else if($scope.analysisObject.target == 'dissentExplain'){
                        $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult.push({claim:"",support:[
                            {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        ],random:Math.round(Math.random()*100000)})
                    }else{

                    }


                    //让滚动条到最底端
                    $("#ak47").animate({scrollTop: 1000}, "slow")



                }

                $scope.setNewEvidence = function(){

                    //如果下一步中已经有原先添加的
                    var nextExistsOrNot = false

                    var _i = $scope.inputStatus.i
                    var _j = $scope.inputStatus.j

                    if($scope.analysisObject.target == "construct"){
                        if($scope.analysisData.analysisResult[_i].support[_j+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.j = _j + 1
                            $scope.inputStatus.name ="evidence"
                            $scope._contents = $scope.analysisData.analysisResult[_i].support[_j+1].evidence || ""
                        }
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        if($scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i].support[_j+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.j = _j + 1
                            $scope.inputStatus.name ="evidence"
                            $scope._contents = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i].support[_j+1].evidence || ""
                        }
                    }else{

                    }

                    if(nextExistsOrNot){
                        return;
                    }


                    //接下来是处理如果下一步添加的是没有添加过的情况

                    $scope._contents = ""  //先清空表单
                    var i = $scope.inputStatus.i
                    $scope.inputStatus.j++

                    $scope.inputStatus.name ="evidence"

                    if($scope.analysisObject.target == 'construct'){
                        $scope.analysisData.analysisResult[i].support.push(
                                {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        )
                    }else if($scope.analysisObject.target == 'dissentExplain'){
                        $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[i].support.push(
                                {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        )
                    }else{

                    }



                    //让滚动条到最底端
                    $("#ak47").animate({scrollTop: 1000}, "slow")


                }


                $scope.noFirstClaim = function(){
                    //非第一个claim被点击没有claim
                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i

                        if(i == $scope.analysisData.analysisResult.length-1){
                            //如果是当前最后一个claim,那么进入newClaim环节
                            $scope.inputStatus.i = i-1
                            $scope.inputStatus.name = "newClaim"
                        }else{
                            //如果不是当前最后一个claim,那么进入下一个claim
                            $scope.inputStatus.name = "claim"
                        }

                        $scope.analysisData.analysisResult.splice(i,1)
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var _i = $scope.analysisObject.i

                        if(i == $scope.analysisDissentExplainData[_i].analysisResult.length-1){
                            //如果是当前最后一个claim,那么进入newClaim环节
                            $scope.inputStatus.i = i-1
                            $scope.inputStatus.name = "newClaim"
                        }else{
                            //如果不是当前最后一个claim,那么进入下一个claim
                            $scope.inputStatus.name = "claim"
                        }

                        $scope.analysisDissentExplainData[_i].analysisResult.splice(i,1)
                    }else{

                    }

                    //重新画图
                    $rootScope.$broadcast('click',{});

                }

                $scope.inputing = function(){
                    transportInputInfo("FormInputing")
                }

                $scope.focus = function(){
                    transportInputInfo("FormStartInputing")
                }

                $scope.blur = function(){
                    transportInputInfo("FormLeaveInputing")
                }

                function transportInputInfo(event){
                    coreSocket.emit(event,{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData,analysisObject:$scope.analysisObject,inputStatus:$scope.inputStatus,topArticleChangeTabVal:$scope.topArticleChangeTabVal})
                }

                $scope.formStartInputingVal = 0
                coreSocket.on("FormInputing",function(_res){
                    //opposite开头的变量告诉你对方现在正在干什么
                    $scope.opposite_analysisData = _res.analysisData
                    $scope.opposite_analysisDissentExplainData = _res.analysisDissentExplainData
                    $scope.opposite_analysisObject = _res.analysisObject
                    $scope.opposite_topArticleChangeTabVal = _res.topArticleChangeTabVal
                    $scope.opposite_inputStatus = _res.inputStatus
                })

                coreSocket.on("FormStartInputing",function(_res){
                    $scope.formStartInputingVal = 1
                })

                coreSocket.on("FormLeaveInputing",function(_res){
                    $scope.formStartInputingVal = 0
                })


                $scope.dataSucessOfRequestTwice = 1
                $scope.requestTwiceStatement = function(){
                    if(!$scope.requestContentReason){
                        $scope.dataSucessOfRequestTwice = 0
                    }else{
                        alert("send request")
                    }
                }

            },
            templateUrl:"/angularJSTemplate/public/inputFormArea.html"
        }
    })

    myApp.directive("oppositeInputInfo",function(){
        return{
            scope:false,
            link:function(scope,element,attrs){

            },
            templateUrl:"/angularJSTemplate/public/oppositeInputInfo.html"
        }
    })

    myApp.directive("oppositeStatementInfo",function(){
        return{
            scope:false,
            link:function(scope,element,attrs){

            },
            templateUrl:"/angularJSTemplate/public/oppositeStatementInfo.html"
        }
    })

    myApp.directive("oppositeStatementInfoForNoAnalysis",function(){
        return{
            scope:false,
            link:function(scope,element,attrs){

            },
            templateUrl:"/angularJSTemplate/public/oppositeStatementInfoForNoAnalysis.html"
        }
    })


    myApp.directive("inputTextAreaForNoAnalysis",function(coreSocket){
        return{
            scope:false,
            link:function(scope){


                if(scope.debateInfo.order == 0 && scope.debateInfo.status == 'noAnalysisStart'){
                    //如果是第一次,那么只有立论
                    scope.statementStatus = {name:"claim",i:0}  //目前是反驳状态还是立論的状态
                    scope.rebuttalData = ""  //反驳 data
                }else{
                    //如果不是第一次,那么可以有反驳
                    scope.statementStatus = {name:"rebuttal",i:0}  //目前是反驳状态还是立論的状态
                    scope.rebuttalData = [{txt:scope.selectedTxt,reply:"",indexToStatement:0,random:Math.round(Math.random()*100000),level:1}]  //反驳 data
                }

                //判断如果你现在是等待方

                if(scope.debateInfo.position == 1 && scope.debateInfo.status == "noAnalysisFuncAppealAndState"){
                    scope.statementStatus.name = "wait"
                }

                if(scope.debateInfo.position == 2 && scope.debateInfo.status == "noAnalysisStart"){
                    scope.statementStatus.name = "wait"
                }

                scope.statementData = ""  //  立論 data
                scope.output = function(){
                        if(!scope._contents){
                            scope.data2Success = 0
                            return;
                        }

                        if(scope.statementStatus.name == 'rebuttal'){
                            var i = scope.statementStatus.i
                            scope.rebuttalData[i].reply = scope._contents

                            //如果下一个rebuttal仍然存在的话
                            if(scope.rebuttalData[i+1]){
                                scope.statementStatus.name = 'rebuttal'
                                scope.statementStatus.i = (i+1)
                                scope._contents =  scope.rebuttalData[i+1].reply
                            }else{
                                scope.statementStatus.name = 'newRebuttal'
                                scope._contents = ""
                            }

                        }

                        if(scope.statementStatus.name == 'claim'){
                            scope.statementData = scope._contents
                            scope.statementStatus.name = "preview"
                        }

                        transportStatementInfo("textInputing")

                }

                scope.skipRebutal = function(){
                        scope.statementStatus.name = "claim"
                        scope._contents = scope.statementData || ""
                }

                scope.setNewRebuttal = function(){
                    scope.statementStatus.name = "rebuttal"
                    scope.statementStatus.i = (scope.statementStatus.i + 1)
                    scope._contents = ""


                    scope.modoru()
                    scope.rebuttalData.push({txt:scope.selectedTxt,reply:"",indexToStatement:scope.selectedRandom,random:Math.round(Math.random()*100000),level:scope.selectedLevel})
                }

                scope.toClaim = function(){

                    if(scope.debateInfo.preFinish){
                        //
                        scope.statementStatus.name = 'preview'
                    }else{
                        scope.statementStatus.name = 'claim'
                        scope.statementStatus.i = 0
                        scope._contents = scope.statementData || ""
                    }

                }


                scope.edit = function(name,i){
                    if(name == "rebuttal"){
                        scope._contents = scope.rebuttalData[i].reply
                        scope.statementStatus.name = name
                        scope.statementStatus.i = i
                    }
                    if(name == "claim"){
                        scope._contents = scope.statementData
                        scope.statementStatus.name = "claim"
                        scope.statementStatus.i = 0
                    }
                }

                scope.drop = function(name,i){
                    scope.rebuttalData.splice(i,1)
                    scope.statementStatus.i = scope.statementStatus.i - 1
                }


                scope.inputing = function(){

                    if(scope.statementStatus.name == "claim"){
                        scope.statementData = scope._contents
                    }

                    if(scope.statementStatus.name == "rebuttal"){
                        scope.rebuttalData[scope.statementStatus.i].reply = scope._contents
                    }

                    transportStatementInfo("textInputing")
                }


                scope.focus = function(){
                    transportStatementInfo("textInputing")
                }

                scope.blur = function(){
                    transportStatementInfo("textLeaveInputing")
                }

                function transportStatementInfo(event){
                    coreSocket.emit(event,{content:scope._contents,statementData:scope.statementData,rebuttalData:scope.rebuttalData,statementStatus:scope.statementStatus})
                }

                scope.textStartInputingVal = 0

                coreSocket.on("textInputing",function(_res){
                    //opposite开头的代表对方正在输入的信息
                    scope.opposite_textInputingContent = _res.content
                    scope.opposite_statementData = _res.statementData
                    scope.opposite_rebuttalData = _res.rebuttalData
                    scope.opposite_statementStatus = _res.statementStatus
                    console.log(_res)
                })



                coreSocket.on("textLeaveInputing",function(_res){
                    scope.textStartInputingVal = 0
                })



            },
            templateUrl:"/angularJSTemplate/public/inputTextAreaForNoAnalysis.html"
        }
    })


    myApp.directive("inputTextArea",function(coreSocket,$compile,$rootScope) {
        return {
            scope: false,
            link:function(scope, element, attrs){
                /*
                    var TOP = 15   //最先画的方块距离顶端的距离
                    var LEFT = 80   //最先画的方块距离左边的距离
                    var DISSENTWIDTH = 250 //异议方块的长度
                    var DISSENTHEIGHT = 260//异议方块的高度
                    var DISSENTANDEXPLAINSPACE = 250 //异议方块距离右边的赛解释说明方块的横向距离
                    var DISSENTSPACEY = 80 //异议方块之间间隔的距离
                    var EXPLAINWIDTH = 460
                    var EXPLAINHEIGHT = 260
                    var DISSENTANDLINESPACEY = 90 //异议方块距离下面虚线的纵向距离
                    var DOTTEDLINEX = 40//虚线的左边位移
                    var DOTTEDWIDTH = 360 //虚线的长度
                    var DOTTEDSPACEWIDTH = 300 //虚线间隔的长度
                    var DOTTEDLINEANDCONSTRUCTSPACE = 50 //虚线距离下面方块的纵向距离
                    var CONSTRUCTX = LEFT //结论方块距离左侧的位移
                    var CONSTRUCTWIDTH = 960 //结论方块的长度
                    var CONSTRUCTHEIGHT = 260 //结论方块的高度

                    var LASTX = 0
                    var LASTY = 0
                    var svg


                    setTimeout(function(){
                        svg = d3.select("#_mainSVG")
                        clearDraw()
                        draw()
                    },800)
                    */


                    scope.inputing = function(){
                        transportStatementInfo("textInputing")
                    }


                    scope.focus = function(){
                        transportStatementInfo("textStartInputing")
                    }

                    scope.blur = function(){
                        transportStatementInfo("textLeaveInputing")
                    }

                    function transportStatementInfo(event){
                        coreSocket.emit(event,{content:scope.statement,statementData:scope.statementData,dissentData:scope.dissentData})
                    }

                    scope.textStartInputingVal = 0

                    coreSocket.on("textInputing",function(_res){
                        //opposite开头的代表对方正在输入的信息
                        scope.opposite_textInputingContent = _res.content
                        scope.opposite_statementData = _res.statementData
                        scope.opposite_dissentData = _res.dissentData
                    })

                    coreSocket.on("textStartInputing",function(_res){
                        scope.textStartInputingVal = 1
                    })


                    coreSocket.on("textLeaveInputing",function(_res){
                        scope.textStartInputingVal = 0
                    })

                    scope.textStartInputingVal = 0


                    if(scope.dissentData.length > 0){
                        scope.dissentTxt = scope.dissentData[0].txt
                    }

                    scope.conceptStatus = "statement"   //concept directive controller

                    scope.output2 = function(){
                        if(!scope.statement){
                            scope.data2Success = 0
                            return;
                        }else{
                            scope.data2Success = 1
                        }

                        var i = scope.statementStatus.i
                        scope.infoAndStatementMapTabVal = 2

                        console.log(scope.statementStatus)
                        console.log(scope.dissentData)

                        if(scope.statementStatus.name == "claim"){
                            scope.statementData = scope.statement

                            scope.statementStatus.name = "submit"
                        }else if(scope.statementStatus.name == "dissent"){
                            scope.dissentData[i].reply = scope.statement
                                if(i<scope.dissentData.length-1){
                                    i++
                                    scope.statement = scope.dissentData[i].reply
                                    scope.dissentTxt = scope.dissentData[i].txt
                                    scope.statementStatus.i = i
                                }else{

                                    if(scope.lastStatement == 1){
                                            //如果到了准结束的阶段,那么发送

                                        scope.statementStatus.name = "preview"
                                        scope.conceptStatus = "noberu"
                                        transportStatementInfo("textInputing")
                                        $rootScope.$broadcast('drawStatementResult');
                                        //submit()

                                        scope.statement = ""
                                        //清空输入框
                                    }else{
                                            //如果还没有到准结束的阶段那么阐述立論
                                            scope.dissentTxt = ""
                                            scope.statement = scope.statementData
                                            scope.statementStatus.i = 0
                                            scope.statementStatus.name = "claim"
                                    }

                                }
                        }else{

                            scope.statementStatus.name = "preview"
                            scope.conceptStatus = "noberu"
                            transportStatementInfo("textInputing")
                            $rootScope.$broadcast('drawStatementResult');
                            //submit()

                            scope.statement = ""
                            //清空输入框
                        }



                        transportStatementInfo("textInputing")
                        //传递到目前为止的输入信息
                    }


                scope.edit2 = function(type,i){
                    if(type == "dissent"){
                        if(i < scope.dissentData.length){
                            scope.statementStatus.name = "dissent"
                            scope.statementStatus.i = i
                            scope.statement = scope.dissentData[i].reply
                            scope.dissentTxt = scope.dissentData[i].txt
                        }else{
                            scope.statementStatus.name = "claim"
                            scope.statementStatus.i = 0
                            scope.statement = scope.statementData
                        }
                    }else if(type == "claim"){
                        scope.statementStatus.name = "claim"
                        scope.statementStatus.i = 0
                        scope.statement = scope.statementData
                    }else{

                    }


                }



                    function submit(){
                        alert(2)
                        return;
                        coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                    }



/*
                    function draw(){
                        LASTX = LEFT
                        LASTY = TOP
                        for(var i = 0;i<scope.dissentData.length;i++){
                            if(i>0) LASTY += DISSENTSPACEY
                            appendRect(scope.dissentData[i].txt,1,LASTX,LASTY,DISSENTWIDTH,DISSENTHEIGHT,"dissent"+i)

                            if(scope.dissentData[i].reply){
                                drawArrow(LASTX+DISSENTWIDTH,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE,LASTY+DISSENTHEIGHT/2,LASTY+DISSENTHEIGHT/2)


                                if(scope.LAN == 'JP'){
                                    drawText("この異議の説明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                                }else{
                                    drawText("这里是对质疑的说明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                                }





                                appendRect(scope.dissentData[i].reply,0,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE+5,LASTY,EXPLAINWIDTH,EXPLAINHEIGHT,"explain"+i)
                            }else{
                                drawPointer(LASTX+DISSENTWIDTH,LASTY+DISSENTHEIGHT/4,200,200)
                            }

                            LASTY += DISSENTHEIGHT
                        }


                        LASTY += DISSENTANDLINESPACEY



                            //如果为非准结束阶段,那么是允许立論的,否则不允许立論

                            if(scope.lastStatement != 1){

                                drawDottedLine(DOTTEDLINEX,LASTY,DOTTEDLINEX+DOTTEDWIDTH,LASTY)

                                if(scope.LAN == 'JP'){
                                    drawText("ここから立論の部分",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                                }else{
                                    drawText("以下是原始阐述说明",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                                }

                                drawDottedLine(DOTTEDLINEX+DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY,DOTTEDLINEX+2*DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY)

                                appendRect(scope.statementData,0,CONSTRUCTX,LASTY+DOTTEDLINEANDCONSTRUCTSPACE,CONSTRUCTWIDTH,CONSTRUCTHEIGHT,"constructClaim")
                                if(scope.statementData){
                                    d3.select("#constructClaim").style("display","block")
                                }else{
                                    d3.select("#constructClaim").style("display","none")
                                }
                            }


                    }

                    function clearDraw(){
                        svg.selectAll(".draw").remove()
                        LASTX = 0
                        LASTY = 0
                    }

                    function drawDottedLine(x1,y1,x2,y2){
                        var line = svg.insert("line")
                                .attr("x1",x1)
                                .attr("y1",y1)
                                .attr("x2",x2)
                                .attr("y2",y2)
                                .attr("stroke","#000")
                                .attr("stroke-width",3)
                                .attr("class","arrow draw")
                                .attr("stroke-dasharray","4,10")
                    }

                    function drawPointer(x,y,width,height){
                        var foreignObject = svg.append("foreignObject")
                                .attr("width",width)
                                .attr("height",height)
                                .attr("x",x)
                                .attr("y",y)
                                .attr("class","draw")

                        var div = foreignObject.append('xhtml:div')
                        var image = div.append("img")

                        image.attr("src", "/leftPointer.png")
                                .attr("width", "100")
                                .attr("height", "100");

                        if(scope.LAN == 'JP'){
                            drawText("左の異議を説明してください",x+100,y+100/2,20)
                        }else{
                            drawText("请对左侧您选择的质疑做阐述说明",x+100,y+100/2,20)
                        }

                    }

                    function drawArrow(x1,x2,y1,y2){
                        var line = svg.insert("line",":first-child")
                                .attr("x1",x1)
                                .attr("y1",y1)
                                .attr("x2",x2)
                                .attr("y2",y2)
                                .attr("stroke","#9acfea")
                                .attr("stroke-width",3)
                                .attr("class","arrow draw")
                                .attr("marker-end","url(#arrow)")
                    }

                    function drawText(txt,x,y,font){
                        var text = svg.insert("text")
                        text.text(txt)
                        text.attr("x",x)
                                .attr("y",y)
                                .attr("font-size",font)
                                .attr("fill","#8a6d3b")
                                .attr("class","draw")
                    }

                    function appendRect(txt,dissent,x,y,w,h,id){
                        var foreignObject = svg.append("foreignObject")
                        foreignObject.attr("width",w)
                        foreignObject.attr("height",h)

                        foreignObject.attr("x",x)
                        foreignObject.attr("y",y)
                        foreignObject.attr("id",id)
                        foreignObject.attr("class","draw")


                        var _div = foreignObject.append('xhtml:div')
                        var div = _div.append("div")
                        div.attr("class","alert alert-warning  row")
                        div.attr("role","alert")
                        div.attr("style","height: "+ h*0.6 +"px; overflow: auto;margin-bottom:1px")


                        var p = div.append("p")
                        p.html(txt)



                        if(id != 'constructClaim' && dissent == 1){
                            //如果是左边的被质疑的模块
                            var div = _div.append("div")
                            var button = _div.append("button")
                            if(scope.LAN == 'JP'){
                                button.html("異議あり")
                            }else{
                                button.html("被质疑")
                            }

                            button.attr("type","button")
                            button.attr("class","btn btn-danger pull-right")
                        }


                        if(id != 'constructClaim' && dissent == 0){
                            //如果是右侧异议解释模块
                            var div = _div.append("div")
                            div.attr("class","row")
                            var divId = "btn"+Math.round(Math.random()*10000)
                            div.attr("id",divId)

                            var num = parseInt(/explain(\d)/.exec(id)[1])

                            if(scope.LAN == 'JP'){
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">編集</button>'
                            }else{
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">修改</button>'
                            }


                            angular.element(document.getElementById(divId)).append($compile(html)(scope));


                        }


                        if(id == 'constructClaim'){
                            //如果是原始阐述的部分的话
                            var div = _div.append("div")
                            div.attr("class","row")
                            var divId = "btn"+Math.round(Math.random()*10000)
                            div.attr("id",divId)


                            if(scope.LAN == 'JP'){
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">編集</button>'
                            }else{
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">修改</button>'
                            }


                            angular.element(document.getElementById(divId)).append($compile(html)(scope));
                        }

                    }

*/

            },
            templateUrl:"/angularJSTemplate/public/inputTextArea.html"
        }
    })


    myApp.directive("examAnalysisResult",function(coreSocket){
        return{
            scope:false,
            link:function(scope,element){
                scope.examAnalysisResultTabVal = 1

                scope.submit = function(){
                    if(scope.examAnalysisResultTabVal == 1){
                        approval()
                    }else{
                        refuse()
                    }
                }

                var approval = function(){
                    coreSocket.emit("confirmAnalysisResult",{comment:scope.examAnalysisResultComment})
                }

                var refuse = function(){
                    coreSocket.emit("refuseAnalysisResult",{comment:scope.examAnalysisResultComment})
                }
            },
            templateUrl:"/angularJSTemplate/public/examAnalysisResult.html"
        }
    })






    myApp.directive("concept",function(){
        return {
            scope:false,
            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/public/concept.html"
        }
    })




    myApp.directive("conceptForNoAnalysis",function(){
        return {
            scope:false,
            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/public/conceptForNoAnalysis.html"
        }
    })

    myApp.directive("infoAndStatementMap",function(){
        return {
            scope:false,
            link:function(scope,element){
                scope.infoAndStatementMapTabVal = 2
                scope.infoAndStatementMapTab = function(n){
                    scope.infoAndStatementMapTabVal = n
                }

                if(scope.debateInfo.status == 'appeal' || scope.debateInfo.status == 'lookup'){
                    scope.infoAndStatementMapBodyHeight = 600
                }else{
                    scope.infoAndStatementMapBodyHeight = 400
                }


            },
            templateUrl:"/angularJSTemplate/public/infoAndStatementMap.html"
        }
    })

    myApp.directive("info",function($rootScope){
        return{
            scope:false,
            link:function(scope){

                scope.expandVal = 1
                //最初状态是开启左边框栏的

                scope.verticalExpandVal = 1
                //最初状态是开启下方的输入栏的


                scope.topInfoHeight = 220

                scope.expand = function(){
                    scope.expandVal = (scope.expandVal + 1 ) %2
                    $rootScope.$broadcast('reDrawStatementMap',{});
                }

                scope.verticalExpand = function(){
                    scope.verticalExpandVal = (scope.verticalExpandVal + 1) % 2
                    if(scope.verticalExpandVal == 0){
                        scope.topInfoHeight = scope.topInfoHeight + 300
                    }else{
                        scope.topInfoHeight = 220
                    }


                }

                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }
            },
            templateUrl:"/angularJSTemplate/public/info.html"
        }
    })

    myApp.directive("infoAndAnalysisMap",function($rootScope){
        return {
            scope:false,
            link:function(scope,element,attr){
                scope.changeTabVal = 0
                scope.changeTab = function(n){
                    scope.changeTabVal = n
                }

                scope.expandVal = 1
                //最初状态是开启左边框栏的

                scope.verticalExpandVal = 1
                //最初状态是开启下方的输入栏的


                scope.topInfoHeight = 220

                scope.expand = function(){
                    scope.expandVal = (scope.expandVal + 1 ) %2
                    $rootScope.$broadcast('reDrawMap',{});
                    //重画地图
                }

                scope.verticalExpand = function(){
                    scope.verticalExpandVal = (scope.verticalExpandVal + 1) % 2
                    if(scope.verticalExpandVal == 0){
                        scope.topInfoHeight = scope.topInfoHeight + 300
                    }else{
                        scope.topInfoHeight = 220
                    }


                    $rootScope.$broadcast('reDrawMap',{});

                }

                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }
            },
            templateUrl:"/angularJSTemplate/public/infoAndAnalysisMap.html"
        }
    })


    myApp.directive("infoAndStatementAnalysisMap",function(myPost){
        return {
            scope:false,
            link:function(scope,element){
                scope.infoAndStatementAnalysisMapTabVal = 1
                scope.infoAndStatementAnalysisMapTab = function(n){
                    scope.infoAndStatementAnalysisMapTabVal = n
                }

                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }
            },
            templateUrl:"/angularJSTemplate/public/infoAndStatementAnalysisMap.html"
        }
    })





    myApp.directive("analysisMapResult3",function(getDebateAnalysisMapInformation) {
        return {
            scope: false,
            link: function (scope, element,attr) {

                var svg = d3.select(element.find("svg")[0])

                svg.attr("width","1200px")
                svg.attr("height","4000px")
                svg.style("background","#bdf")


                var LEFT
                var TOP

                var CLAIMWIDTH //占据除去两个边距后5分之4的位置

                var CLAIMHEIGHT
                var CLAIMXINTERVAL  //间距占据除去两个编剧后5分之1的位置
                var CLAIMYINTERVAL //轮次内的主张之间的垂直间隙

                var CLAIMANDSUPPORTYINTERVAL //主张和support的纵距离
                var SUPPORTANDCLAIMYINTERVAL //support和主张的纵距离
                var SUPPORTANDSUPPORTYINTERVAL //support和support之间的纵距离

                var POPUPWIDTH //弹出框的宽度
                var POPUPHEIGHT

                var ELEMENTWIDTH  //占据5分之1的的位置
                var ELEMENTHEIGHT

                var CLAIMXPRO
                var CLAIMXCON
                var CLAIMX

                var LASTY  //一个数组的第二项和第三项分别存储正方和反方的升降机标尺数据

                var MAINARROWLEFTOFFSET
                var LINEWIDTH

                var PROCOLOR
                var CONCOLOR

                var mainLeftArrow
                var mainLeftArrowOfDissent
                var ELEMENTDISSENTCLAIM

                var FONTSIZE

                var analysisMapInformation = getDebateAnalysisMapInformation.getDebateAnalysisMapInformation()

                analysisMapInformation.then(function(msg){
                    scope.analysisMapInformation = msg
                    scope.analysisMapInformationLen = scope.analysisMapInformation.res.data.length

                    dealWithData()
                    dealWithDraw()
                })


                scope.$on("reDrawMap",function(){
                    setTimeout(function(){
                            dealWithData()
                            console.log(scope.mapData)
                            dealWithDraw()
                    },500)
                })


                function define(){
                    var _width = element.find("div")[0].offsetWidth
                    LEFT = _width*0.05
                    TOP = 35

                    CLAIMWIDTH = (_width-2*LEFT)*0.4  //占据除去两个边距后5分之4的位置

                    CLAIMHEIGHT = CLAIMWIDTH*1.2;
                    CLAIMXINTERVAL = (_width-2*LEFT)*0.2 //间距占据除去两个编剧后5分之1的位置
                    CLAIMYINTERVAL = 100  //轮次内的主张之间的垂直间隙

                    CLAIMANDSUPPORTYINTERVAL = 50  //主张和support的纵距离
                    SUPPORTANDCLAIMYINTERVAL = 10  //support和主张的纵距离
                    SUPPORTANDSUPPORTYINTERVAL = 20  //support和support之间的纵距离

                    POPUPWIDTH = CLAIMWIDTH //弹出框的宽度
                    POPUPHEIGHT = CLAIMWIDTH*0.75

                    ELEMENTWIDTH = CLAIMWIDTH/5  //占据5分之1的的位置
                    ELEMENTHEIGHT = ELEMENTWIDTH*0.7

                    CLAIMXPRO = LEFT
                    CLAIMXCON = LEFT + CLAIMWIDTH + CLAIMXINTERVAL
                    CLAIMX = ["",CLAIMXPRO,CLAIMXCON]

                    LASTY = ["",TOP,TOP] //一个数组的第二项和第三项分别存储正方和反方的升降机标尺数据

                    MAINARROWLEFTOFFSET = 10
                    LINEWIDTH = 5

                    PROCOLOR = "#2aabd2"
                    CONCOLOR = "#419641"

                    if(_width>=900){
                        FONTSIZE = 16
                    }else if(_width>=700 && _width<900){
                        FONTSIZE = 14
                    }else if(_width>=500 && _width<700){
                        FONTSIZE = 12
                    }else{
                        FONTSIZE = 10
                    }

                    mainLeftArrow = {pro:[],con:[]}
                    mainLeftArrowOfDissent = {pro:{},con:{}}
                    ELEMENTDISSENTCLAIM = {pro:{},con:{}}
                }

                function dealWithData() {

                    if(scope.currentAnalysis){
                        scope.analysisMapInformation.res.data[scope.analysisMapInformationLen] = scope.currentAnalysis
                    }

                    scope.mapData = {pro:[],con:[]}
                    scope.mapDissentData = []

                    //先把主张的分析结果合一块儿
                    for (var i = 0; i < scope.analysisMapInformation.res.data.length; i++) {
                        var analysisResult = scope.analysisMapInformation.res.data[i].analysisData.analysisResult
                        var analysisDissentExplainData = scope.analysisMapInformation.res.data[i].analysisDissentExplainData

                        if (analysisDissentExplainData.length > 0) {
                            var analysisDissentExplainData = addAnalysisIndexInto(analysisDissentExplainData)
                            scope.mapDissentData.push(analysisDissentExplainData)
                        }
                        var position = scope.analysisMapInformation.res.data[i].position

                        //应该是反的,正方在分析的时候他是分析的反方的数据
                        if (position == 2) {
                            scope.mapData.pro.push(analysisResult)
                        } else {
                            scope.mapData.con.push(analysisResult)
                        }
                    }


                    function addAnalysisIndexInto(data) {
                        //很遗憾服务器端claim里没有数据告诉里claim指向的是那个analysis index 所以只好在这里作处理
                        for (var i = 0; i < data.length; i++) {
                            var indexToAnalysis = data[i].indexToAnalysis
                            for (var j = 0; j < data[i].analysisResult.length; j++) {
                                data[i].analysisResult[j].indexToAnalysis = indexToAnalysis
                                for (var k = 0; k < data[i].analysisResult[j].support.length; k++) {
                                    data[i].analysisResult[j].support[k].indexToAnalysis = indexToAnalysis
                                }
                            }

                        }
                        return data
                    }

                    digui()
                    //最难的递归啦

                    function digui() {
                        //递归处理质疑的质疑

                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                var indexToAnalysis = scope.mapDissentData[i][j].indexToAnalysis

                                var _slightestOrNot = slightestOrNot(scope.mapDissentData[i][j].analysisResult)

                                if (_slightestOrNot) {
                                    var _findRandomByIndexToAnalysis = findRandomByIndexToAnalysis(indexToAnalysis)

                                    if (_findRandomByIndexToAnalysis) {
                                        //删掉队列中的scope.mapDissentData[i][j] 放入相应的子元素下面
                                        var _copy = scope.mapDissentData[i][j].analysisResult
                                        scope.mapDissentData[i].splice(j, 1)
                                        var _type = _findRandomByIndexToAnalysis.type
                                        var _i = _findRandomByIndexToAnalysis.i
                                        var _j = _findRandomByIndexToAnalysis.j
                                        var _k = _findRandomByIndexToAnalysis.k
                                        var _m = _findRandomByIndexToAnalysis.m

                                        if (_type == "warrant") {
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].wDissent = _copy
                                        }

                                        if (_type == "evidence") {
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].eDissent = _copy
                                        }

                                        digui()
                                    }
                                }

                                //alert(findRandomByIndexToAnalysis(indexToAnalysis,i,j))


                            }
                        }

                        return false;

                    }


                    function slightestOrNot(arr) {
                        for (var i = 0; i < arr.length; i++) {
                            for (var j = 0; j < arr[i].support.length; j++) {

                                if (findIndexToAnalysisByRandom(arr[i].support[j].wrandom)) {
                                    return false
                                }

                                if (findIndexToAnalysisByRandom(arr[i].support[j].erandom)) {
                                    return false
                                }


                            }
                        }

                        return true
                    }


                    function findIndexToAnalysisByRandom(random) {

                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                for (var k = 0; k < scope.mapDissentData[i][j].analysisResult.length; k++) {
                                    var indexToAnalysis = scope.mapDissentData[i][j].indexToAnalysis
                                    if (indexToAnalysis == random) {
                                        return true
                                    }
                                }


                            }
                        }

                        return false;
                    }


                    function findRandomByIndexToAnalysis(indexToAnalysis) {


                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                for (var k = 0; k < scope.mapDissentData[i][j].analysisResult.length; k++) {

                                    for (var m = 0; m < scope.mapDissentData[i][j].analysisResult[k].support.length; m++) {
                                        var wrandom = scope.mapDissentData[i][j].analysisResult[k].support[m].wrandom
                                        var erandom = scope.mapDissentData[i][j].analysisResult[k].support[m].erandom

                                        if (indexToAnalysis == wrandom) {
                                            return {type: "warrant", i: i, j: j, k: k, m: m}
                                        }

                                        if (indexToAnalysis == erandom) {
                                            return {type: "evidence", i: i, j: j, k: k, m: m}
                                        }

                                    }
                                }


                            }
                        }

                        return false;
                    }


                    //再处理刚刚合一块儿的主张结果,对其中每个元素做检查,看是否有对他的质疑解释


                    appendDissentAnalysisDataToElement("pro")
                    appendDissentAnalysisDataToElement("con")

                    function appendDissentAnalysisDataToElement(position) {

                        for (var i = 0; i < scope.mapData[position].length; i++) {
                            for (var j = 0; j < scope.mapData[position][i].length; j++) {
                                var res = findDissentAnalysisResult(scope.mapData[position][i][j].random)
                                if (res) {
                                    scope.mapData[position][i][j].cDissent = res
                                }

                                for (var k = 0; k < scope.mapData[position][i][j].support.length; k++) {
                                    var res1 = findDissentAnalysisResult(scope.mapData[position][i][j].support[k].wrandom)
                                    if (res1) {
                                        scope.mapData[position][i][j].support[k].wDissent = res1
                                        //初始情况不显示
                                        scope.mapData[position][i][j].support[k].wDissentShow = 0
                                    }
                                    var res2 = findDissentAnalysisResult(scope.mapData[position][i][j].support[k].erandom)
                                    if (res2) {
                                        scope.mapData[position][i][j].support[k].eDissent = res2
                                        //初始情况不显示
                                        scope.mapData[position][i][j].support[k].eDissentShow = 0
                                    }
                                }
                            }
                        }
                    }


                    function findDissentAnalysisResult(random) {
                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {
                                if (random == scope.mapDissentData[i][j].indexToAnalysis) {
                                    return scope.mapDissentData[i][j].analysisResult
                                }
                            }
                        }
                        return false
                    }

                    }

                function dealWithDraw(){
                    define()
                    console.log(scope.mapData)
                    console.log(66666666666666666)
                    console.log(scope.mapDissentData)

                    clearDraw()
                    //主体思想是嵌套循环数据,分为左右两个区域
                    startDraw(scope.mapData.pro,1)
                    startDraw(scope.mapData.con,2)

                    console.log("ak47")
                    console.log(mainLeftArrowOfDissent)

                    drawMainArrow(mainLeftArrow,PROCOLOR,1)
                    drawMainArrow(mainLeftArrow,CONCOLOR,2)

                    _drawMainArrow(mainLeftArrowOfDissent.pro,"#000")
                    _drawMainArrow(mainLeftArrowOfDissent.con,"#000")

                    _drawMainArrow(ELEMENTDISSENTCLAIM.pro,"red")
                    _drawMainArrow(ELEMENTDISSENTCLAIM.con,"red")
                }

                function startDraw(data,position){
                        for(var i=0;i<data.length;i++){
                            //第i轮的主张
                            var recursionI = 0  //这个变存储递归的深度

                            position == 1?mainLeftArrow.pro[i] = []:mainLeftArrow.con[i] = []
                            drawClaim(i,recursionI,data[i],position,CLAIMX[position])
                        }
                    }

                function clearDraw(){
                    svg.selectAll(".mapData").remove()
                    LASTY = ["",TOP,TOP] //一个数组的第二项和第三项分别存储正方和反方的升降机标尺数据
                }

                function drawMainArrow(data,color,position){
                    var data = (position == 1)?data.pro:data.con
                    for(var i=0;i<data.length;i++){
                        //i代表第几轮
                        for(var j=0;j<data[i].length;j++){
                            if(data[i][j].startY && data[i][j].endY){
                                //只有等起点和终点同时存在时
                                painLine(svg,data[i][j].x,data[i][j].x,data[i][j].startY,data[i][j].endY,color)
                            }

                        }
                    }
                }



                function _drawMainArrow(data,color){
                    console.log("htcasdas")
                    console.log(data)


                    for(var i in data){
                        if(data[i].startY && data[i].endY){
                            //只有等起点和终点同时存在时
                            painLine(svg,data[i].x,data[i].x,data[i].startY-5,data[i].endY,color)
                        }

                    }


                }


                function painLine(platform,x1,x2,y1,y2,color){

                    var svg = platform
                    var line = svg.append("line")
                    line.attr("class","mapData")
                    line.attr("x1",x1)
                    line.attr("x2",x2)
                    line.attr("y1",y1)
                    line.attr("y2",y2)
                    line.attr("stroke",color)
                    line.attr("stroke-width",LINEWIDTH)
                }


                function judeElementPosition(position,recursionI){
                   //通过对递归深度的分析和对位置的分析判断这个元素是正方还是反方做出的

                    //比如说position==1,代表正方pro,在正方pro中所有偶数的递归深度值都指的是pro,所有奇数的递归深度值都指的是con
                    //相反说position==2,代表反方con,在反方con中所有偶数的递归深度值都指的是con,所有奇数的递归深度值都指的是pro

                    if(recursionI%2==0){
                        if(position == 1) return 1
                        if(position == 2) return 2
                    }else{
                        if(position == 1) return 2
                        if(position == 2) return 1
                    }
                }



                function drawClaim(I,recursionI,data,position,currentX){
                    //I代表第几轮主张
                    //主轴是以原始claim为模块进行描画的
                    for(var j=0;j<data.length;j++){

                        if(!data[j].claim) return;

                        if(recursionI == 0){
                            //说明这是最原始的claim不是異議説明的claim
                            //这里实际上push的是第j个对象

                            position == 1?mainLeftArrow.pro[I].push({x:(currentX-MAINARROWLEFTOFFSET),startY:LASTY[position] + ELEMENTHEIGHT/2}):mainLeftArrow.con[I].push({x:(currentX-10),startY:LASTY[position] + ELEMENTHEIGHT/2})
                            //连接和左边mainLine的连线
                            var color = position == 1?PROCOLOR:CONCOLOR
                            painLine(svg,currentX-MAINARROWLEFTOFFSET-LINEWIDTH/2,currentX,LASTY[position] + ELEMENTHEIGHT/2,LASTY[position] + ELEMENTHEIGHT/2,color)
                        }else{
                            //说明这里的claim不是原始的claim而是異議説明的claim
                            var indexToAnalysis = data[j].indexToAnalysis
                            position == 1?mainLeftArrowOfDissent.pro[indexToAnalysis] = {x:currentX+ELEMENTWIDTH/2,startY:LASTY[position]+ELEMENTHEIGHT}:mainLeftArrowOfDissent.con[indexToAnalysis] = {x:currentX+ELEMENTWIDTH/2,startY:LASTY[position]+ELEMENTHEIGHT}
                            //mainLeftArrowOfDissent
                        }

                        var y = LASTY[position]

                        var _element = appendElement(recursionI,currentX,LASTY[position],"主張",position,0,data[j].claim,"claim",data[j].random)

                        //这个时候升降机的调整要分是原始claim的情况和非原始claim的情况

                        if(recursionI == 0){
                            //为原始claim的情况
                            var shenjiangjiHEIGHT = CLAIMHEIGHT
                            //var shenjiangjiHEIGHT = document.getElementById(_element.id).clientHeight
                        }else{
                            //为非原始claim的情况
                            var shenjiangjiHEIGHT = ELEMENTHEIGHT
                            //var shenjiangjiHEIGHT = document.getElementById(_element.id).clientHeight
                        }

                        if(data[j].support[0].evidence){
                            //如果次主张下的第一个support有数据的话,那么把升降机下降至support数据的高度
                            LASTY[position] = LASTY[position] + shenjiangjiHEIGHT + CLAIMANDSUPPORTYINTERVAL
                            drawSupport(I,recursionI,data[j].support,position,currentX,j)
                        }else{
                            //如果该次主张下没有support的话
                            if(data[j+1]){
                                //如果该轮次下一个主张存在的话,那么把升降机下降到该轮次下一个主张的高度
                                LASTY[position] = LASTY[position] + shenjiangjiHEIGHT + CLAIMYINTERVAL
                            }else{
                                LASTY[position] = LASTY[position] + shenjiangjiHEIGHT
                            }
                        }

                    }

                    return y
                }


                function drawSupport(I,recursionI,data,position,currentX,j){
                    //I代表第几轮主张

                    for(var i=0;i<data.length;i++){
                        if(recursionI == 0){
                            //说明这是最原始的claim不是異議説明的claim
                            //这里实际上push的是第j个对象

                            position == 1?mainLeftArrow.pro[I][j].endY = LASTY[position] + ELEMENTHEIGHT*0.5:mainLeftArrow.con[I][j].endY = LASTY[position] + ELEMENTHEIGHT*0.5
                        }else{
                            //说明这里不是原始的claim是異議説明的claim
                            var indexToAnalysis = data[i].indexToAnalysis
                            //这里所属的元素是属于对那个元素的质疑
                            position == 1?mainLeftArrowOfDissent.pro[indexToAnalysis].endY = (LASTY[position] + ELEMENTHEIGHT/2):mainLeftArrowOfDissent.con[indexToAnalysis].endY = (LASTY[position] + ELEMENTHEIGHT/2)
                            //mainLeftArrowOfDissent
                        }

                        var y1 = LASTY[position] + ELEMENTHEIGHT
                            //先画evidence
                                if(data[i].evidence){
                                    var evidenceX = appendEvidence(recursionI,data,i,position,currentX)
                                }

                            //再画warrant
                                if(data[i].warrant){
                                    var warrantX = appendWarrant(recursionI,data,i,position,currentX)
                                }



                            //递归还是不递归判断分析

                            if(data[i].eDissent){
                                //如果对于evidence的质疑解释还有的话


                                if(data[i].eDissent[0].claim){
                                    //如果对这个质疑的解释已经加入了内容的话,否则buzuochuli
                                    LASTY[position] = LASTY[position] + CLAIMANDSUPPORTYINTERVAL
                                    var y2 = drawClaim(I,(recursionI+1),data[i].eDissent,position,evidenceX)  //返回这个元素所属的claim的高度
                                    //进行一次递归调用,因此递归深度在原有的递归深度上+1

                                    var indexToAnalysis = data[i].erandom

                                    position==1?ELEMENTDISSENTCLAIM.pro[indexToAnalysis] = {x:evidenceX+ELEMENTWIDTH/2,startY:y1,endY:y2}:ELEMENTDISSENTCLAIM.con[indexToAnalysis] = {x:evidenceX+ELEMENTWIDTH/2,startY:y1,endY:y2}
                                }
                            }

                            if(data[i].wDissent){
                                //如果对warrant的质疑解释还有的话

                                if(data[i].wDissent[0].claim){
                                    //如果对这个质疑的解释已经加入了内容的话,否则buzuochuli
                                    LASTY[position] = LASTY[position] + CLAIMANDSUPPORTYINTERVAL
                                    var y2 = drawClaim(I,(recursionI+1),data[i].wDissent,position,warrantX) //返回这个元素所属的claim的高度
                                    //进行一次递归调用,因此递归深度在原有的递归深度上+1

                                    var indexToAnalysis = data[i].wrandom
                                    position==1?ELEMENTDISSENTCLAIM.pro[indexToAnalysis] = {x:warrantX+ELEMENTWIDTH/2,startY:y1,endY:y2}:ELEMENTDISSENTCLAIM.con[indexToAnalysis] = {x:warrantX+ELEMENTWIDTH/2,startY:y1,endY:y2}
                                }

                            }

                    }
                }


                function appendEvidence(recursionI,data,i,position,currentX){
                    var text = data[i].evidence


                    if(recursionI % 2 == 0){
                        //如果递归深度为偶数向右伸展
                        var x = currentX + 3*ELEMENTWIDTH
                    }else{
                        //如果递归深度为奇数向左伸展
                        var x = currentX - 3*ELEMENTWIDTH
                    }

                    if(data[i].eDissent){
                        var dissent = 1
                    }else{
                        var dissent = 0
                    }


                    if(recursionI == 0){
                        //说明这是最原始的claim不是異議説明的claim
                        //连接和左边mainLine的连线
                        var color = position == 1?PROCOLOR:CONCOLOR
                        painLine(svg,currentX-MAINARROWLEFTOFFSET-LINEWIDTH/2,x,LASTY[position] + ELEMENTHEIGHT/2,LASTY[position] + ELEMENTHEIGHT/2,color)
                    }else{
                        //说明这不是最原始的claim而是異議説明的claim
                        var indexToAnalysis = data[i].indexToAnalysis
                        //连接和左边mainLine的连线
                        if(position == 1){
                            var _startx = mainLeftArrowOfDissent.pro[indexToAnalysis].x + LINEWIDTH/2
                        }else{
                            var _startx = mainLeftArrowOfDissent.con[indexToAnalysis].x + LINEWIDTH/2
                        }
                        painLine(svg,_startx,x,LASTY[position] + ELEMENTHEIGHT/2,LASTY[position] + ELEMENTHEIGHT/2,"#000")
                    }



                    appendElement(recursionI,x,LASTY[position],"根拠",position,dissent,data[i].evidence,"evidence",data[i].erandom)
                    if(!data[i].warrant){
                        //如果下一个要画的warrant不存在的话,那么现在就开始调整升降机//否则等到下一个画warrant的时候再调整升降机
                                        if(data[i+1]){
                                            //如果下一个support存在的话那么调整升降机到下一个support的位置
                                            LASTY[position] = LASTY[position] + ELEMENTHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                                        }else{
                                            //如果下一个support不存在的话
                                            LASTY[position] = LASTY[position] + ELEMENTHEIGHT + SUPPORTANDCLAIMYINTERVAL
                                        }
                    }

                    //返回当前集结点的横坐标信息
                    return x
                }

                function appendWarrant(recursionI,data,i,position,currentX){

                    if(recursionI % 2 == 0){
                        //如果递归深度为偶数向右伸展
                        var x = currentX+ELEMENTWIDTH
                    }else{
                        //如果递归深度为奇数向左伸展
                        var x = currentX - ELEMENTWIDTH
                    }




                    if(data[i].wDissent){
                        var dissent = 1
                    }else{
                        var dissent = 0
                    }


                    appendElement(recursionI,x,LASTY[position],"論拠",position,dissent,data[i].warrant,"warrant",data[i].wrandom)

                    //处理升降机

                    if(data[i+1]){
                        //如果下一个support存在的话那么调整升降机到下一个support的位置
                        LASTY[position] = LASTY[position] + ELEMENTHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                    }else{
                        LASTY[position] = LASTY[position] + ELEMENTHEIGHT + SUPPORTANDCLAIMYINTERVAL
                    }

                    //返回当前集结点的横坐标信息
                    return x
                }


                function appendElement(recursionI,x,y,text,position,dissent,_text,type,random){
                    if(!text)  return
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("class","mapData")

                    var id = type + Math.round(Math.random()*10000000)

                    if(type == "claim" && recursionI == 0){
                        //如果是最原始的claim的话那么以claim级别去对待
                        foreignObject.attr("width",CLAIMWIDTH)


                        //根据text的长度,确定模块的高度

                        if(_text.length > 200){
                            CLAIMHEIGHT = CLAIMWIDTH*1.2
                        }else if(_text.length > 100 && _text.length <= 200){
                            CLAIMHEIGHT = CLAIMWIDTH*1.0
                        }else if(_text.length > 50 && _text.length <= 100){
                            CLAIMHEIGHT = CLAIMWIDTH*0.6
                        }else{
                            CLAIMHEIGHT = CLAIMWIDTH*0.3
                        }

                        foreignObject.attr("height",CLAIMHEIGHT)
                    }else{
                        //如果不是最原始的claim的话那么以元素级别去对待
                        foreignObject.attr("width",ELEMENTWIDTH)
                        foreignObject.attr("height",ELEMENTHEIGHT)
                    }

                    foreignObject.attr("id",id)
                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')

                    if(type == "claim" && recursionI == 0){
                        //如果是最原始的claim的话那么以claim级别去对待
                        //div.style("height",CLAIMHEIGHT+"px")
                        div.style("overflow","auto")

                       var div = div.append("div")
                           div.attr("class","panel panel-default")
                           var div = div.append("div")
                           div.attr("class","panel-body")
                           div.text(_text)
                           div.text(_text)
                           div.style("font-size",FONTSIZE+"px")
                    }else{
                        //如果不是最原始的claim的话那么以元素级别去对待
                        div.style("height",ELEMENTHEIGHT+"px")
                        div.style("overflow","auto")

                        var button = div.append("button")
                        if(judeElementPosition(position,recursionI) == 1){
                            button.attr("class","btn btn-info")
                        }else{
                            button.attr("class","btn btn-success")
                        }


                        button.text(text)
                        button.style("font-size",FONTSIZE+"px")
                        button.style("height",ELEMENTHEIGHT*0.95+"px")

                        if(dissent == 1){
                            var span = button.append("span")
                            span.attr("class","glyphicon glyphicon-star")
                        }

                        var _id = "element"+Math.round(Math.random()*10000)
                        button.attr("id",_id)
                        document.getElementById(_id).onclick = function(){
                            popUp(text,x,y,position,_text)

                            if(dissent == 1){
                                changeShowStatus(random,position)
                            }
                        }


                    }

                    return {id:id}

                }



                function changeShowStatus(random,position){
                    //递归查询scope.mapData中wrandom或者erandom为random的并把这个数据的显示状态反置
                    var data = position == 1?scope.mapData.pro:scope.mapData.con

                    for(var i=0;i<data.length;i++){
                        for(var j=0;j<data[i].length;j++){
                            var res = diguiGetPosition(random,data[i][j])
                            if( res != 0){
                                return;
                            }else{
                                return;
                            }
                        }

                    }
                }

                function diguiGetPosition(random,data){
                    if(!data || !data.support ) return;

                    for(var i=0;i<data.support.length;i++){
                        var erandom = data.support[i].erandom
                        var wrandom = data.support[i].wrandom

                        if(random == erandom){
                            if(!data.support[i].eDissentShow){
                                data.support[i].eDissentShow = 1
                            }else{
                                data.support[i].eDissentShow = (data.support[i].eDissentShow + 1) % 2
                            }

                            return "find in erandom"
                        }

                        if(random == wrandom){
                            if(!data.support[i].wDissentShow){
                                data.support[i].wDissentShow = 1
                            }else{
                                data.support[i].wDissentShow = (data.support[i].wDissentShow + 1) % 2
                            }

                            return "find in wrandom"
                        }


                        //如果当前递归深度的wrandom以及erandom没有找到匹配的那么看看它的自元素

                        if(data.support[i].eDissent){
                            var res = diguiGetPosition(random,data.support[i].eDissent)
                            if(res != 0){
                                data.support[i].eDissent = res
                                return res
                            }
                        }

                        if(data.support[i].wDissent){
                            var res = diguiGetPosition(random,data.support[i].wDissent)
                            if(res != 0){
                                data.support[i].wDissent = res
                                return res
                            }
                        }

                    }

                    return 0

                }

                function popUp(text,x,y,position,_text){


                    d3.selectAll(".balloon").remove()

                    var rect = svg.append("foreignObject")

                    rect.attr("x",x)
                    rect.attr("y",y)
                    rect.attr("width",POPUPWIDTH)
                    rect.attr("height",POPUPHEIGHT)


                    var div = rect.append('xhtml:div')
                    div.style("width",POPUPWIDTH)
                    div.style("height",POPUPHEIGHT)
                    div = div.append("div")


                    div.attr("class","row col-sm-12 balloon")

                    if(position == 1){
                        rect.attr("x",x+ELEMENTWIDTH + 30)
                        div.classed("_balloon", true);
                    }else{
                        rect.attr("x",x-ELEMENTWIDTH)
                        div.classed("__balloon", true);
                    }

                    div.style("width",POPUPWIDTH+"px")
                    div.style("background-color","#fff")


                    var sdiv = div.append("div")
                    sdiv.attr("class","row")

                    var title = sdiv.append("div")
                    title.attr("class","col-sm-10")

                    var remove = sdiv.append("div")
                    remove.attr("class","col-sm-6")
                    remove = remove.append("span")
                    remove.attr("class","glyphicon glyphicon-remove")
                    remove.attr("aria-hidden","true")
                    remove.style("cursor","pointer")

                    remove.on("click",function(){
                        rect.remove()
                    })


                    var content = sdiv.append("div")
                    content.attr("class","col-sm-11")
                    content.html(_text)
                }
            },
            templateUrl:"/angularJSTemplate/public/__analysisMapResult.html"
        }
    })


    myApp.directive("statementMapResult2",function(getDebateStatementMapInformation){
        return{
            scope:false,
            link:function(scope,element){
                var LEFT  //左边距
                var RIGHT //右边距
                var TOP //上边距
                var RECTWIDTH //模块的宽度
                var RECTHEIGHT //模块的高度
                var BUTTONWIDTH //按钮的宽度
                var BUTTONHEIGHT //按钮的高度
                var LASTY //升降机的高度坐标
                var XPRO //左边pro模块的横坐标
                var XCON //右边con模块的横坐标
                var svg
                var INTERVALY  //模块和模块之间的垂直间距
                var CONNECTLINE
                var LINEWIDTH

                var statementMapInformation = getDebateStatementMapInformation.getDebateStatementMapInformation()


                statementMapInformation.then(function(msg){
                    scope.statementMapInformation = msg
                    draw(scope.statementMapInformation.res.data)
                    drawLine(CONNECTLINE)
                })


                scope.$on("reDrawStatementMap",function(){
                    setTimeout(function(){
                        draw(scope.statementMapInformation.res.data)
                        drawLine(CONNECTLINE)
                    },500)
                })


                function define(){
                    var _width = element.find("div")[0].offsetWidth
                    LEFT = _width*0.05
                    RIGHT = LEFT
                    TOP = 10
                    RECTWIDTH = (_width - (LEFT+RIGHT))/3
                    RECTHEIGHT = RECTWIDTH*0.8
                    BUTTONWIDTH = RECTWIDTH*0.2
                    BUTTONHEIGHT = BUTTONWIDTH*0.8
                    INTERVALY = RECTHEIGHT*0.3

                    XPRO = LEFT
                    XCON = _width - RIGHT - RECTWIDTH
                    LASTY = ["",TOP,TOP]
                    CONNECTLINE = {}
                    LINEWIDTH = 2

                    svg = d3.select(element.find("svg")[0])
                    svg.attr("width","1200px")
                    svg.attr("height","4000px")
                }


                function clearDraw(){
                    svg.selectAll(".statementMapData").remove()
                }



                function draw(data){
                    define()
                    clearDraw()
                    if(scope.debateInfo.analysisFunc == 1){
                        //有分析功能的,肯定带有质疑功能
                        dealWithData(data)
                        for(var i=0;i<data.length;i++){
                            for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                                appendRect(data[i].everyStatement.dissentExplain[j].reply,data[i].everyStatement.position,"dissentExplain",data[i].everyStatement.dissentExplain[j].dissent,data[i].everyStatement.dissentExplain[j].random,data[i].everyStatement.dissentExplain[j].indexToStatement,data[i].everyStatement.dissentExplain[j].level)
                            }
                            appendRect(data[i].everyStatement.statementData,data[i].everyStatement.position,"construct",data[i].everyStatement.dissent,data[i].everyStatement.statementDataRandom,0,0)
                        }
                    }


                    if(scope.debateInfo.analysisFunc == 0){
                        //不带分析功能的肯定不带质疑功能
                        dealWithData(data)
                        for(var i=0;i<data.length;i++){

                            if((data[i].everyStatement.dissentExplain)){
                                //rebuttal

                                for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                                    appendRect(data[i].everyStatement.dissentExplain[j].reply,data[i].everyStatement.position,"dissentExplain",data[i].everyStatement.dissentExplain[j].dissent,data[i].everyStatement.dissentExplain[j].random,data[i].everyStatement.dissentExplain[j].indexToStatement,data[i].everyStatement.dissentExplain[j].level)
                                }
                            }

                            appendRect(data[i].everyStatement.statementData,data[i].everyStatement.position,"construct",data[i].everyStatement.dissent,data[i].everyStatement.statementDataRandom,0,0)
                        }
                    }


                }


                function drawLine(data){
                    for(var i in data) {
                        if(!data[i].end) continue;
                        for(var j=0;j<data[i].end.length;j++){
                            var startX = data[i].startX
                            var startY = data[i].startY
                            var endX = data[i].end[j].endX
                            var endY = data[i].end[j].endY
                            //painLine(svg,startX,startY,endX,endY,"blue")

                            //折线画四个点
                            var ax,ay,bx,by,cx,cy,dx,dy
                            var zheXNum = generateRandomNum()
                            ax = startX
                            bx = startX + (endX - startX)/zheXNum
                            cx = bx
                            dx = endX
                            ay = startY + j*RECTHEIGHT*0.08
                            by = startY + j*RECTHEIGHT*0.08
                            cy = endY
                            dy = endY

                            painDot(svg,ax,ay,5)
                            painDot(svg,dx,dy,5)
                            painLine(svg,ax,bx,ay,by,"#000",i,j,"start")
                            painLine(svg,bx,cx,by,cy,"#000",i,j,"middle")
                            painLine(svg,cx,dx,cy,dy,"#000",i,j,"end")

                        }
                    }

                }

                function generateRandomNum(){
                    return Math.round(Math.random()*8) + Math.random()*2
                }


                function painLine(platform,x1,x2,y1,y2,color,index,_index,type){
                    var svg = platform
                    var line = svg.append("line")
                    line.attr("x1",x1)
                    line.attr("x2",x2)
                    line.attr("y1",y1)
                    line.attr("y2",y2)
                    line.attr("stroke",color)
                    line.attr("stroke-width",LINEWIDTH)
                            .attr("class","arrow draw statementMapData connectLine a" + index + "b"+ _index)
                    line.on("mouseover",function(){
                        d3.selectAll(".connectLine").attr("stroke",color)
                        d3.selectAll(".a"+index+"b"+_index).attr("stroke","yellow")
                    })

                    if(type == "end"){
                        line.attr("marker-end","url(#arrow)")
                    }

                    line.on("mouseout",function(){
                        d3.selectAll(".connectLine").attr("stroke",color)
                    })
                }


                function painDot(platform,x,y,r){
                    var circle = platform.append("circle")
                    circle.attr("cx",x)
                    circle.attr("cy",y)
                    circle.attr("r",r)
                    circle.attr("fill","red")
                    circle.attr("class","statementMapData")
                }


                function addIntoCoordinate(index,obj,startOrEnd){
                    if(!CONNECTLINE[index]){
                        CONNECTLINE[index] = {}
                    }


                    if(startOrEnd == "start"){
                        for(var i in obj){
                            CONNECTLINE[index][i] = obj[i]
                        }
                    }else{
                        if(!CONNECTLINE[index]["end"]) {
                            CONNECTLINE[index]["end"] = []
                        }
                        CONNECTLINE[index]["end"].push(obj)
                    }

                }

                function appendRect(text,position,type,dissent,random,indexToStatement,level){
                        if(!text) return
                        var _x,_y
                        if(position == 1){
                            _x = XPRO
                            _y = LASTY[position]
                        }else if(position == 2){
                            var _x = XCON
                            _y = LASTY[position]
                        }else{
                            alert("cdk")
                            return
                        }

                        //根据文字的实际长度来决定模块的高度

                        if(text.length > 200){
                            RECTHEIGHT = RECTWIDTH*1.4
                        }else if(text.length >100 && text.length <=200){
                            RECTHEIGHT = RECTWIDTH*1.2
                        }else if(text.length > 50 && text.length <=100){
                            RECTHEIGHT = RECTWIDTH*0.8
                        }else{
                            RECTHEIGHT = RECTWIDTH*0.6
                        }


                        var foreignObject = svg.append("foreignObject")
                        foreignObject.attr("width",RECTWIDTH)
                        foreignObject.attr("height",RECTHEIGHT)
                        foreignObject.attr("x",_x)
                        foreignObject.attr("y",_y)
                        foreignObject.attr("class","statementMapData")

                        //处理異議説明的连接线
                        if(dissent == 1){
                            //开始的坐标  因为dissent==1代表这个内容里面有被质疑的部分

                            //左右所在地不同,那么连接线的开始结束的方位也应该不同

                            var __y = _y + RECTHEIGHT/8
                            if(position == 1){
                                var __x = _x + RECTWIDTH
                            }else{
                                var __x = _x
                            }



                            addIntoCoordinate(random,{startX:__x,startY:__y},"start")
                        }

                        if(type == "dissentExplain"){
                            //结束的坐标 因为dissentExplain的数据都是异议解释数据


                            //左右所在地不同,那么连接线的开始结束的方位也应该不同
                            var __y = _y + RECTHEIGHT/2.5
                            if(position == 1){
                                var __x = _x + RECTWIDTH
                            }else{
                                var __x = _x
                            }

                            addIntoCoordinate(indexToStatement,{endX:__x,endY:__y},"end")
                        }

                        //处理升降机
                        LASTY[position] = LASTY[position] + RECTHEIGHT + BUTTONHEIGHT + INTERVALY


                        var div = foreignObject.append('xhtml:div')
                        div.style("width",RECTWIDTH+"px")
                        div.style("height",RECTHEIGHT+"px")
                        div.style("overflow","auto")

                        var div = div.append("div")
                        if(position == 1){
                            div.attr("class","panel panel-info")
                        }else{
                            div.attr("class","panel panel-success")
                        }

                        var heading = div.append("div").attr("class","panel-heading")
                        var body = div.append("div").attr("class","panel-body")

                        if(type == "construct"){
                            heading.text("立論")
                        }else{

                            heading.text("第"+level+"反駁")
                        }

                        body.text(text)
                }



                function dealWithData(data){
                    for(var s=0;s<data.length;s++){

                        var res = indexAndRandom(data[s].everyStatement.statementDataRandom)

                        if(res.res > 0){
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 1
                        }else{
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 0
                        }

                        if(data[s].everyStatement.dissentExplain){
                            for(var k=0;k<data[s].everyStatement.dissentExplain.length;k++){
                                var res = indexAndRandom(data[s].everyStatement.dissentExplain[k].random)
                                if(res.res > 0){
                                    scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 1
                                }else{
                                    scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 0
                                }
                            }
                        }

                    }
                }

                function indexAndRandom(random){
                    var data = scope.statementMapInformation.res.data
                    for(var i=0;i<data.length;i++){
                        if(data[i].everyStatement.dissentExplain){
                            for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                                if(data[i].everyStatement.dissentExplain[j].indexToStatement == random){
                                    return {res:1,i:i,j:j}
                                }
                            }
                        }

                    }
                    return {res:0}
                }


            },
            templateUrl:"/angularJSTemplate/public/_statementMapResult.html"
        }
    })

    myApp.directive("statementMapResult",function(getDebateStatementMapInformation){
        return {
            scope:false,
            link:function(scope,element){

                var RECTWIDTH  //模块的长度
                var RECTHEIGHT  //模块的宽度
                var LEFT //最开始模块距离左边的边距
                var TOP //最开始模块距离顶端的边距
                var SPACEX //左边模块和右边模块的横向间距
                var SPACEY //模块和模块的上下垂直距离
                var LASTX,LASTY
                var svg
                var LINEWIDTH

                var statementMapInformation = getDebateStatementMapInformation.getDebateStatementMapInformation()

                var CONNECTLINE //異議あり、異議説明的连线的坐标信息

                statementMapInformation.then(function(msg){
                    scope.statementMapInformation = msg
                    draw(scope.statementMapInformation.res.data)
                })


                function define(){
                    LEFT = 50  //最开始模块距离左边的边距
                    TOP = 50  //最开始模块距离顶端的边距
                    SPACEX = 150 //左边模块和右边模块的横向间距
                    SPACEY = 50 //模块和模块的上下垂直距离
                    LINEWIDTH = 5
                    var _width = element.find("div")[0].offsetWidth

                    RECTWIDTH =  _width/3 //模块的长度
                    RECTHEIGHT = RECTWIDTH*0.6  //模块的宽度
                    CONNECTLINE = {}
                    svg = d3.select("#statementMapSVG").append("svg")
                    svg.attr("width","1400px")
                    svg.attr("height","4000px")
                }



                function draw(data){
                    define()
                    dealWithData(data)

                    LASTX = LEFT
                    LASTY = TOP
                    for(var i=0;i<data.length;i++){
                        for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                            appendRect(LASTX,LASTY,data[i].everyStatement.dissentExplain[j].reply,data[i].everyStatement.position,"dissentExplain",data[i].everyStatement.dissentExplain[j].dissent)
                            if(data[i].everyStatement.position == 1){
                                var _x = LASTX
                            }else{
                                var _x = LASTX + RECTWIDTH + SPACEX
                            }
                            if(data[i].everyStatement.dissentExplain[j].dissent == 1){
                                addIntoCoordinate(data[i].everyStatement.dissentExplain[j].random,{startX:_x,startY:LASTY})
                            }
                            addIntoCoordinate(data[i].everyStatement.dissentExplain[j].indexToStatement,{endX:_x,endY:LASTY})
                            LASTY += (RECTHEIGHT + SPACEY)
                        }
                            appendRect(LASTX,LASTY,data[i].everyStatement.statementData,data[i].everyStatement.position,"construct",data[i].everyStatement.dissent)
                            if(data[i].everyStatement.dissent == 1){
                                if(data[i].everyStatement.position == 1){
                                    var _x = LASTX
                                }else{
                                    var _x = LASTX + RECTWIDTH + SPACEX
                                }

                                addIntoCoordinate(data[i].everyStatement.statementDataRandom,{startX:LASTX,startY:LASTY})
                            }
                            LASTY += (RECTHEIGHT + SPACEY)
                    }

                    //drawDissentConnectLine(CONNECTLINE)
                }

                function addIntoCoordinate(index,obj){
                        if(!CONNECTLINE[index]){
                            CONNECTLINE[index] = {}
                        }

                        for(var i in obj){
                            CONNECTLINE[index][i] = obj[i]
                        }
                }

                function drawDissentConnectLine(data){
                        for(var i in data){
                            console.log(data[i])
                            var middleX = data[i].startX
                            var middleY = data[i].endY
                            painLine(svg,data[i].startX,middleX,data[i].startY,middleY,"blue")
                            painLine(svg,middleX,data[i].endX,middleY,data[i].endY,"blue")
                        }
                }


                function painLine(platform,x1,x2,y1,y2,color){
                    var svg = platform
                    var line = svg.append("line")
                    line.attr("class","mapData")
                    line.attr("x1",x1)
                    line.attr("x2",x2)
                    line.attr("y1",y1)
                    line.attr("y2",y2)
                    line.attr("stroke",color)
                    line.attr("stroke-width",LINEWIDTH)
                }

                function dealWithData(data){
                    for(var s=0;s<data.length;s++){
                        var res = indexAndRandom(data[s].everyStatement.statementDataRandom)

                        if(res.res > 0){
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 1
                        }else{
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 0
                        }

                        for(var k=0;k<data[s].everyStatement.dissentExplain.length;k++){
                            var res = indexAndRandom(data[s].everyStatement.dissentExplain[k].random)
                            if(res.res > 0){
                                scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 1
                            }else{
                                scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 0
                            }
                        }

                    }
                }

                function indexAndRandom(random){
                    var data = scope.statementMapInformation.res.data
                    for(var i=0;i<data.length;i++){
                        for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                            if(data[i].everyStatement.dissentExplain[j].indexToStatement == random){
                                return {res:1,i:i,j:j}
                            }
                        }
                    }
                    return {res:0}
                }

                function appendRect(x,y,txt,position,type,dissent){
                    if(!txt) return;

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH)
                    foreignObject.attr("height",RECTHEIGHT)

                    if(parseInt(position) == 1){
                        foreignObject.attr("x",x)
                    }else{
                        foreignObject.attr("x",(x + RECTWIDTH + SPACEX))
                    }

                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')

                    var _div = div.append("div")

                    if(parseInt(position) == 1){
                        _div.attr("class","alert alert-info")
                    }else{
                        _div.attr("class","alert alert-success")
                    }
                    _div.style("height",RECTHEIGHT*0.7+"px")
                    _div.style("width",RECTWIDTH+"px")
                    _div.style("overflow","auto")
                    _div.style("margin-bottom","1px")
                    _div.append("p").text(txt)


                    if(position == 2){
                        if(type == "construct"){
                            var _div = div.append("div")
                            _div.html('<button type="button" class="btn btn-default pull-left">立論</button>')
                        }else if(type == "dissentExplain"){
                            var _div = div.append("div")
                            _div.html('<button type="button" class="btn btn-default pull-left">異議説明</button>')
                        }else{

                        }

                        if(dissent>0) _div.html(_div.html() + '<button type="button" class="btn btn-danger pull-right">異議あり</button>')
                    }


                    if(position == 1){
                        if(type == "construct"){
                            var _div = div.append("div")
                            _div.html('<button type="button" class="btn btn-default pull-right">立論</button>')
                        }else if(type == "dissentExplain"){
                            var _div = div.append("div")
                            _div.html('<button type="button" class="btn btn-default pull-right">異議説明</button>')
                        }else{

                        }

                        if(dissent>0) _div.html(_div.html() + '<button type="button" class="btn btn-danger pull-left">異議あり</button>')
                    }

                }
            },
            templateUrl:"/angularJSTemplate/public/statementMapResult.html"
        }
    })

    myApp.directive("infoTable",function(myPost,coreSocket) {
        return {
            scope: false,
            link: function ($scope) {
                $scope.rate = 7;
                $scope.overStar = 7
                $scope.max = 10;
                $scope.isReadonly = false;
                $scope.percent = 100 * ($scope.rate / $scope.max);
                $scope.rateable = false


                if($scope.debateInfo.position == 1){
                    //自分の自己評価
                    if($scope.debateInfo.proRate){
                        $scope.rateable = false
                        $scope.rate = $scope.debateInfo.proRate
                    }else{
                        $scope.rateable = true
                    }

                    //相手の自己評価
                    if($scope.debateInfo.conRate){
                        $scope.oppositeRate = $scope.debateInfo.conRate
                    }else{
                        $scope.oppositeRate = false
                    }

                    //勝負の判断

                    $scope.gameResult = gameResult($scope.debateInfo.proRate,$scope.debateInfo.conRate)


                }else if($scope.debateInfo.position == 2){
                    //自分の自己評価
                    if($scope.debateInfo.conRate){
                        $scope.rateable = false
                        $scope.rate = $scope.debateInfo.conRate
                    }else{
                        $scope.rateable = true
                    }


                    //相手の自己評価
                    if($scope.debateInfo.proRate){
                        $scope.oppositeRate = $scope.debateInfo.proRate
                    }else{
                        $scope.oppositeRate = false
                    }

                    $scope.gameResult = gameResult($scope.debateInfo.proRate,$scope.debateInfo.conRate)
                }else if($scope.debateInfo.position == 0){

                }else{

                }


                function gameResult(proRate,conRate){

                    if(!proRate || !conRate){
                        return {res:"wait"}
                    }


                    if(proRate > 5 && conRate < 5){
                        return {res:"win",target:"pro",order:0}
                    }

                    if(proRate < 5 && conRate > 5){
                        return {res:"win",target:"con",order:1}
                    }

                    if(proRate == 5 && conRate == 5){
                        return {res:"draw",target:"",order:2}
                    }

                    if(proRate > 5 && conRate >= 5){
                        return {res:"still",target:"",order:3}
                    }

                    if(proRate < 5 && conRate <= 5){
                        return {res:"still",target:"",order:4}
                    }


                    if(proRate = 5 && conRate != 5){
                        return {res:"still",target:"",order:5}
                    }


                }


                $scope.hoveringOver = function(value) {
                    $scope.overStar = value;
                    $scope.percent = 100 * ($scope.overStar / $scope.max);
                };

                $scope.determine = function(){
                    myPost.postData("/release/rate",{rate:$scope.overStar}).then(function(_res){
                        if(_res.data.err == 0){
                            $scope.isReadonly = true;
                            $scope.rateable = false
                        }
                    })
                }

                $scope.cyousi = function(){
                    var cyousiVal = $scope.cyousiVal
                    coreSocket.emit("sendCyousi",{cyousiVal:cyousiVal})
                }

                $scope.ratingStates = [
                    {stateOn: 'glyphicon-ok-sign', stateOff: 'glyphicon-ok-circle'},
                    {stateOn: 'glyphicon-star', stateOff: 'glyphicon-star-empty'},
                    {stateOn: 'glyphicon-heart', stateOff: 'glyphicon-ban-circle'},
                    {stateOn: 'glyphicon-heart'},
                    {stateOff: 'glyphicon-off'}
                ];
            },


            templateUrl:"/angularJSTemplate/public/infoTable.html"
        }
    })

    function initData($scope){
        $scope.debateInfo = {
            pro:"",
            con:"",
            finishi:"",
            setting:"",
            group:"",
            config:{},
            proPrepare:0,
            conPrepare:0
        }



        $scope.statusController = {
            startDebate:false,
            waitDebate:false,
            analysisDebate:false
        }


        $scope.inputStatus = {name:"claim",i:0,j:0}
        //$scope.inputStatus = {name:"evidence",i:0,j:0}
        //$scope.inputStatus = {name:"warrant",i:0,j:0}

        /*

         $scope.dissentData = [{type:"construct",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:0},
         {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
         {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
         ]
        */

        $scope.dissentData = []

        $scope.statementData = ""
        $scope.statementStatus = {name:"claim",i:0}


        $scope.conceptStatus = "analysis"
        $scope.conceptStatus = "statement"

        $scope.dissentTxt = "aaa"  //在对质疑进行解释性说明的时候在左侧显示对那一段话有质疑

        $scope.totalNum = 1


    }


</script>
</html>