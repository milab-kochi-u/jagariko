<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>group page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <![endif]-->
    <!--<script src="/release/angular.min.js"></script>-->

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <!--
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular-animate.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular-touch.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.3.3/ui-bootstrap.min.js"></script>
    -->

    <script type="text/javascript" src="/release/angular-route.min.js"></script>
    <script src="/release/ui-bootstrap-tpls-2.2.0.min.js"></script>

    <script src="/_debate/d3/d3.js"></script>


    <style>



        .balloon {
            background-color:#fff;
            border:1px solid #000;
            border-radius:5px;
            position:relative;
        }

        .__balloon:before {
            border:10px solid transparent;
            border-left-color:#fff;
            border-right-width:0;
            right:-9px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
            z-index:1;
        }

        .__balloon:after {
            border:10px solid transparent;
            border-left-color:#000;
            border-right-width:0;
            right:-10px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
        }



        ._balloon:before {
            border:10px solid transparent;
            border-right-color:#fff;
            border-left-width:0;
            left:-9px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
            z-index:1;
        }

        ._balloon:after {
            border:10px solid transparent;
            border-right-color:#000;
            border-left-width:0;
            left:-10px;
            content:"";
            display:block;
            top:15px;
            position:absolute;
            width:0;
        }




    </style>
</head>
<body ng-app="myApp" ng-init="LAN='JP'">

<div  class="container" ng-controller="myController" >

    <wait-debate ng-if="statusController.waitDebate"></wait-debate>
    <start-debate ng-if="statusController.startDebate"></start-debate>
    <analysis-debate ng-if="statusController.analysisDebate"></analysis-debate>
    <check-debate ng-if="statusController.checkDebate"></check-debate>
    <appeal-debate ng-if="statusController.appealDebate"></appeal-debate>
    <state-debate ng-if="statusController.stateDebate"></state-debate>
    <bunseki-debate ng-if="statusController.bunsekiDebate"></bunseki-debate>
    <kentou-debate ng-if="statusController.kentouDebate"></kentou-debate>
    <lookup-debate ng-if="statusController.lookupDebate"></lookup-debate>
    <noberu-debate ng-if="statusController.noberuDebate"></noberu-debate>
    <finish-debate ng-if="statusController.finishDebate"></finish-debate>

</div>
</body>

<script>

    var myApp = angular.module("myApp",['ui.bootstrap']);

    myApp.factory('coreSocket', function($rootScope) {
        //var socket = io.connect();
        var socket = io(window.location.host + "/release").connect()
        return {
            on: function(eventName, callback) {
                socket.on(eventName, function() {
                    var args = arguments;
                    $rootScope.$apply(function() {
                        callback.apply(socket, args);
                    });
                });
            },
            emit: function(eventName, data, callback) {
                socket.emit(eventName, data, function() {
                    var args = arguments;
                    $rootScope.$apply(function() {
                        if (callback) {
                            callback.apply(socket, args);
                        }
                    });
                });
            }
        };
    });



    myApp.factory("myPost",function($http){
        return{
            postData:function(url,data){
                return $http.post(url,data).success(function(res){
                    return res;
                })
            }
        }
    })


    myApp.controller("myController",function($scope,myPost,coreSocket,$q){

        function init(){

            initData($scope)



            var promise = getDebateInformation()
            promise.then(function(msg){
                checkStatus($scope.debateInfo.status,$scope.debateInfo.preStatus)
            })

            var promise = getUserInformation()
            promise.then(function(msg){
                coreSocket.emit("enterRoom",{username:$scope.username})
            })

        }

        init()

        $scope.$watch("debateInfo.status",checkStatus)



        coreSocket.on("enterRoom",function(_res){
            var promise = getDebateInformation()
        })


        coreSocket.on('sys', function (sysMsg, users) {
            //alert(sysMsg)
        });


        coreSocket.on("prepared",function(_res){
            var promise = getDebateInformation()
        })

        coreSocket.on("prepareCompelete",function(_res){
            var promise = getDebateInformation()
        })

        coreSocket.on("receiveStatement",function(_res){
            console.log("receive statement....")
            console.log(_res)
            var promise = getDebateInformation()

        })


        coreSocket.on("receiveAnalysis",function(_res){
            console.log("receive result of analysis result")
            var promise = getDebateInformation()
        })

        coreSocket.on("confirmAnalysisResultFinish",function(_res){
            console.log("result of analysis has been approved")
            var promise = getDebateInformation()
        })

        coreSocket.on("selectDissentFinish",function(msg){
            var promise = getDebateInformation()
            if($scope.debateInfo.status == "appeal"){
                console.log("con select dissent and prepare to do state")
                $scope.debateInfo.status = "state"
                $scope.debateInfo.preStatus = "appeal"
            }else if($scope.debateInfo.status == "lookup"){
                console.log("pro select dissent and prepare to do state")
                $scope.debateInfo.status = "noberu"
                $scope.debateInfo.preStatus = "lookup"
            }else{

            }

            console.log($scope.dissentData)
            $scope.dissentData = msg.dissentData
            $scope.statementStatus = msg.statementStatus

            $scope.statementData = msg.statementData

        })





        function getDebateInformation(){

            var deferred = $q.defer();

            myPost.postData("/release/getDebateInformation").then(function(_res){
                console.log("get debate information")
                console.log(_res)

                if(_res.data.err == 1){
                    window.location = "/release/login"
                }


                if(_res.data){

                    $scope.debateInfo.title = _res.data.title
                    $scope.debateInfo.pro = _res.data.pro
                    $scope.debateInfo.con = _res.data.con
                    $scope.debateInfo.finish = _res.data.finish
                    $scope.debateInfo.setting = _res.data.setting
                    $scope.debateInfo.group = _res.data.group
                    $scope.debateInfo.proPrepare = _res.data.proPrepare
                    $scope.debateInfo.conPrepare = _res.data.conPrepare
                    $scope.debateInfo.position = _res.data.position
                    $scope.debateInfo.status = _res.data.status
                    $scope.debateInfo.preStatus = _res.data.preStatus
                    $scope.debateInfo.config = _res.data.config
                    $scope.debateInfo.username = _res.data.username
                    $scope.debateInfo.LAN = _res.data.LAN
                    $scope.debateInfo.path = _res.data.path

                    $scope.everyStatementData = _res.data.everyStatement
                    if($scope.everyStatementData) generateAnalysisResult($scope.everyStatementData)
                    $scope.requestStatementMessage = _res.data.requestStatementMessage
                    $scope.refuseAnalysisResultReason = _res.data.refuseAnalysisResultReason
                    $scope.everyAnalysisData = _res.data.everyAnalysisData


                    if($scope.debateInfo.status != 'analysis' && $scope.debateInfo.status != 'bunseki'){
                        if(_res.data.everyAnalysisData){
                            $scope.analysisData = _res.data.everyAnalysisData.analysisData
                            $scope.analysisDissentExplainData = _res.data.everyAnalysisData.analysisDissentExplainData
                        }
                    }



                    $scope.debateInfo.order =  _res.data.order
                    $scope.debateInfo.preFinish =  _res.data.preFinish
                    $scope.debateInfo.proRate = parseInt(_res.data.proRate)
                    $scope.debateInfo.conRate = parseInt(_res.data.conRate)
                    deferred.resolve({err:0,msg:"data acquired"});
                }else{
                    deferred.reject({err:1,msg:"data not acquired"});
                }

            })


            var statementMapInformation = getDebateStatementMapInformation()
            var analysisMapInformation =  getDebateAnalysisMapInformation()
            statementMapInformation.then(function(msg){
                $scope.statementMapInformation = msg
            })

            analysisMapInformation.then(function(msg){
                $scope.analysisMapInformation = msg
            })


            return deferred.promise;
        }


        function getDebateStatementMapInformation(){

            var deferred = $q.defer();

            myPost.postData("/release/getDebateStatementMapInformation").then(function(_res){
                console.log("getDebateStatementMapInformation")
                console.log(_res)
                if(_res.data){
                    deferred.resolve({err:0,msg:"data acquired",res:_res});
                }else{
                    deferred.reject({err:1,msg:"data not acquired",res:_res});
                }

            })
            return deferred.promise;
        }

        $scope.getDebateStatementMapInformation = getDebateStatementMapInformation

        function getDebateAnalysisMapInformation(){

            var deferred = $q.defer();

            myPost.postData("/release/getDebateAnalysisMapInformation").then(function(_res){
                console.log("getDebateAnalysisMapInformation")
                console.log(_res)
                if(_res.data){
                    $scope.debateInfo.order =  _res.data.order
                    deferred.resolve({err:0,msg:"data acquired",res:_res});
                }else{
                    deferred.reject({err:1,msg:"data not acquired",res:_res});
                }

            })
            return deferred.promise;
        }

        $scope.getDebateAnalysisMapInformation = getDebateAnalysisMapInformation

        function generateAnalysisResult(everyStatementData){


            $scope.analysisData = {txt:everyStatementData.statementData,analysisResult:[
                {claim:"",support:[
                    {evidence:"",warrant:"",wrandom:Math.round(Math.random()*100000),erandom:Math.round(Math.random()*100000)},
                ],random:Math.round(Math.random()*100000)},
            ],indexToStatement:everyStatementData.statementDataRandom}


            $scope.analysisDissentExplainData = []


            for(var i=0;i<everyStatementData.dissentExplain.length;i++){
                $scope.analysisDissentExplainData.push({txt:everyStatementData.dissentExplain[i].reply,analysisResult:[
                    {claim:"",support:[
                        {evidence:"",warrant:"",wrandom:Math.round(Math.random()*100000),erandom:Math.round(Math.random()*100000)},
                    ],
                      random:Math.round(Math.random()*100000)
                    }
                    ],
                    indexToAnalysis:everyStatementData.dissentExplain[i].indexToAnalysis,
                    indexToStatement:everyStatementData.dissentExplain[i].random,
                })
            }



            console.log("analysisData")
            console.log($scope.analysisData)
            console.log("analysisDissentExplainData")
            console.log($scope.analysisDissentExplainData)
        }

        function getUserInformation(){

            var deferred = $q.defer();
            myPost.postData("/release/getUserInformation").then(function(_res){

                if(_res.data){
                    console.log(_res)
                    $scope.username = _res.data.data.username
                    $scope.debateInvolve = _res.data.data.debateInvolve
                    $scope.group = _res.data.data.group
                    $scope.num = _res.data.data.num
                    $scope.rNum = _res.data.data.rNum
                    $scope.status = _res.data.data.rNum
                    $scope.LAN = _res.data.data.LAN
                    deferred.resolve({err:0,msg:"data acquired"});
                }else{
                    deferred.reject({err:1,msg:"data not acquired"});
                }

            })

            return deferred.promise;
        }


        function checkStatus(status,preStatus){
                if(status == "wait"){
                    changeStatusController(["waitDebate"])
                }

                if(status == "start" && preStatus == "wait"){
                    changeStatusController(["startDebate"])
                }

                if(status == "analysis" && preStatus == "start"){
                    changeStatusController(["analysisDebate"])
                }

                if(status == "check" && preStatus == "analysis"){
                    changeStatusController(["checkDebate"])
                }

                if(status == "appeal" && preStatus == "check"){
                    changeStatusController(["appealDebate"])
                }

                    if(status == "state" && preStatus == "appeal"){
                        changeStatusController(["stateDebate"])
                    }

                    // status "state" will not inserted into database


                if(status == "bunseki" && preStatus == "appeal"){
                    changeStatusController(["bunsekiDebate"])
                }

                if(status == "kentou" && preStatus == "bunseki"){
                    changeStatusController(["kentouDebate"])
                }

                if(status == "lookup" && preStatus == "kentou"){
                    changeStatusController(["lookupDebate"])
                }

                    if(status == "noberu" && preStatus == "lookup"){
                        changeStatusController(["noberuDebate"])
                    }

                if(status == "analysis" && preStatus == "lookup"){
                    changeStatusController(["analysisDebate"])
                }


                if(status == "finish"){
                    changeStatusController(["finishDebate"])
                }

        }


        function changeStatusController(arr){
            for(var i in $scope.statusController){
                $scope.statusController[i] = false
            }

            for(var i in arr){
                $scope.statusController[arr[i]] = true
            }

            console.log("now the showing flat is ....")
            console.log(arr)
            console.log("---------------------------")
        }



    });



    myApp.directive("myNavy",function(){
        return {
            scope:false,
            templateUrl:"/angularJSTemplate/navy.html"
        }
    })



    myApp.directive("prepareOfPro",function(){
        return{
            scope:false,
            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/pro/prepare.html"
        }
    })

    myApp.directive("topArticle",function(){
        return{
            scope:false,
            link:function(scope,element){
                scope.topArticleChangeTabVal = 0
                scope.topArticleChangeTab = function(n){
                    scope.topArticleChangeTabVal = n
                }

                scope.$on('topArticleChangeTab',function(event, data){
                    scope.topArticleChangeTabVal = data.topArticleChangeTabVal
                });

                scope.selectedOrNot = function(n){
                    return parseInt(n)==scope.topArticleChangeTabVal?"active":""
                }
            },
            templateUrl:"/angularJSTemplate/public/topArticle.html"
        }
    })


    myApp.directive("middleInfo",function(coreSocket,myPost){
        return{
            scope:false,
            link:function(scope,element){
                scope.prepare = function(){
                    coreSocket.emit("prepare",{})
                }


                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }
            },
            templateUrl:"/angularJSTemplate/public/middleInfo.html"
        }
    })


    // process directive
    myApp.directive("waitDebate",function(coreSocket){
        return{
            scope:false,
            link:function(scope,element){
                scope.prepare = function(){
                    coreSocket.emit("prepare",{})
                }
            },
            templateUrl:"/angularJSTemplate/process/waitDebate.html"
        }
    })



    myApp.directive("startDebate",function(coreSocket){
        return{
            scope:false,

            link:function(scope,element){
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                }
            },
            templateUrl:"/angularJSTemplate/process/startDebate.html"
        }
    })


    myApp.directive("analysisDebate",function(){
        return{
            scope:false,

            link:function(scope,element){
                if(scope.debateInfo.preFinish){
                    //如果是属于准结束阶段,那么这个时候只有分析異議説明的份儿
                    scope.analysisObject = {target:"dissentExplain",i:0}
                }else{
                    //如果不是准结束的阶段,那么这个时候要分析立論
                    scope.analysisObject = {target:"construct",i:0}
                }

            },
            templateUrl:"/angularJSTemplate/process/analysisDebate.html"
        }
    })



    myApp.directive("checkDebate",function(){
        return{
            scope:false,

            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/process/checkDebate.html"
        }
    })



    myApp.directive("appealDebate",function(){
        return{
            scope:false,

            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/process/appealDebate.html"
        }
    })


    myApp.directive("stateDebate",function(coreSocket){
        return{
            scope:false,

            link:function(scope,element){
                scope.submit = function(){
                    coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                }
            },
            templateUrl:"/angularJSTemplate/process/stateDebate.html"
        }
    })



    myApp.directive("bunsekiDebate",function(){
        return{
            scope:false,
            controller:function($scope){
                $scope.analysisObject = {target:"construct",i:0}

            },
            templateUrl:"/angularJSTemplate/process/bunsekiDebate.html"
        }
    })


    myApp.directive("kentouDebate",function(){
        return{
            scope:false,

            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/process/kentouDebate.html"
        }
    })

    myApp.directive("lookupDebate",function(){
        return{
            scope:false,

            link:function(scope,element){
                    //如果是最后一轮的话那么这里只能反論,不能立論


            },
            templateUrl:"/angularJSTemplate/process/lookupDebate.html"
        }
    })

    myApp.directive("noberuDebate",function(coreSocket){
        return{
            scope:false,

            link:function(scope,element){
                    if(scope.debateInfo.order == scope.totalNum-1){
                        //说明现在这个阶段不能立論了,因为快要结束了
                        scope.lastStatement = 1
                    }

                    scope.submit = function(){
                        coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                    }
            },
            templateUrl:"/angularJSTemplate/process/noberuDebate.html"
        }
    })

    myApp.directive("finishDebate",function(myPost){
        return{
            scope:false,
            link:function(scope,element){


                scope.conceptStatus = "judgeMent"
                var statementMapInformation = scope.getDebateStatementMapInformation()
                var analysisMapInformation =  scope.getDebateAnalysisMapInformation()
                statementMapInformation.then(function(msg){
                    scope.statementMapInformation = msg
                })

                analysisMapInformation.then(function(msg){
                    scope.analysisMapInformation = msg
                })


                if(scope.debateInfo.position == 1){
                    if(scope.debateInfo.proRate){
                       scope.rateable = 0
                    }else{
                       scope.rateable = 1
                    }
                }

                if(scope.debateInfo.position == 2){
                    if(scope.debateInfo.conRate){
                        scope.rateable = 0
                    }else{
                        scope.rateable = 1
                    }

                }


                scope.determines = function(n){
                    // 0 win
                    // 1 draw
                    // 2 lost


                    myPost.postData("/release/rate",{rate:n}).then(function(_res){
                        if(_res.data.err == 0){
                            scope.isReadonly = true;
                            scope.rateable = false
                        }
                    })


                }



                /*
                scope.rate = 7;
                scope.overStar = 7
                scope.max = 10;
                scope.isReadonly = false;
                scope.percent = 100 * (scope.rate / scope.max);
                scope.rateable = false


                if(scope.debateInfo.position == 1){
                    //自分の自己評価
                    if(scope.debateInfo.proRate){
                        scope.rateable = false
                        scope.rate = scope.debateInfo.proRate
                    }else{
                        scope.rateable = true
                    }

                    //相手の自己評価
                    if(scope.debateInfo.conRate){
                        scope.oppositeRate = scope.debateInfo.conRate
                    }else{
                        scope.oppositeRate = false
                    }

                    //勝負の判断

                    scope.gameResult = gameResult(scope.debateInfo.proRate,scope.debateInfo.conRate)


                }else if(scope.debateInfo.position == 2){
                    //自分の自己評価
                    if(scope.debateInfo.conRate){
                        scope.rateable = false
                        scope.rate = scope.debateInfo.conRate
                    }else{
                        scope.rateable = true
                    }


                    //相手の自己評価
                    if(scope.debateInfo.proRate){
                        scope.oppositeRate = scope.debateInfo.proRate
                    }else{
                        scope.oppositeRate = false
                    }

                    scope.gameResult = gameResult(scope.debateInfo.proRate,scope.debateInfo.conRate)
                }else if(scope.debateInfo.position == 0){

                }else{

                }


                function gameResult(proRate,conRate){

                    if(!proRate || !conRate){
                        return {res:"wait"}
                    }


                    if(proRate > 5 && conRate < 5){
                        return {res:"win",target:"pro",order:0}
                    }

                    if(proRate < 5 && conRate > 5){
                        return {res:"win",target:"con",order:1}
                    }

                    if(proRate == 5 && conRate == 5){
                        return {res:"draw",target:"",order:2}
                    }

                    if(proRate > 5 && conRate >= 5){
                        return {res:"still",target:"",order:3}
                    }

                    if(proRate < 5 && conRate <= 5){
                        return {res:"still",target:"",order:4}
                    }


                    if(proRate = 5 && conRate != 5){
                        return {res:"still",target:"",order:5}
                    }


                }


                scope.hoveringOver = function(value) {
                    scope.overStar = value;
                    scope.percent = 100 * (scope.overStar / scope.max);
                };

                scope.determine = function(){
                    myPost.postData("/release/rate",{rate:scope.overStar}).then(function(_res){
                        if(_res.data.err == 0){
                            scope.isReadonly = true;
                            scope.rateable = false
                        }
                    })
                }

                scope.ratingStates = [
                    {stateOn: 'glyphicon-ok-sign', stateOff: 'glyphicon-ok-circle'},
                    {stateOn: 'glyphicon-star', stateOff: 'glyphicon-star-empty'},
                    {stateOn: 'glyphicon-heart', stateOff: 'glyphicon-ban-circle'},
                    {stateOn: 'glyphicon-heart'},
                    {stateOff: 'glyphicon-off'}
                ];

                */

            },
            templateUrl:"/angularJSTemplate/process/finishDebate.html"
        }
    })

    // end of process directive

    myApp.directive("statementResult",function() {
        return {
            scope: false,
            link: function (scope) {

            },
            templateUrl:"/angularJSTemplate/public/statementResult.html"
        }
    })

    myApp.directive("analysisResult",function(coreSocket,$compile){
        return {
            scope:false,
            link:function($scope,$element){

                var RECTWIDTH = 450
                var RECTHEIGHT = 150
                var OFFSETLEFT = 80
                var OFFSETTOP = 100


                var SPACECWH = 80   //interval between claim and warrant vertical
                var SPACECCH = 100    //interval between claim and claim vertical
                var SPACEWWH = 60  //interval between warrant and warrant vertical


                var SPACECWW = 100   // interval between claim and warrant level
                var SPACEWEW = 50   // interval between evidence and warrant level
                var MAINLINEOFFSETLEFT = OFFSETLEFT + 40
                var LASTY = 0
                var LASTX = 0


                var DOTTEDLINEMARGINTOP = 50
                var DOTTEDLINEMARGINBOTTOM = 10
                var DOTTEDLINELENGTH = 350
                var DOTTEDLINESPACE = 350
                var DOTTEDLINEMARGINLEFT = 30

                var svg = d3.select("#mainSVG").append("svg")
                svg.attr("width","1200px")
                svg.attr("height","2000px")
                svg.attr("id","mainSVG"+Math.round(Math.random()*1000))
                $scope.addDissentArr = {}




                function init(){
                    clearDraw()
                    draw()
                }


                $scope.$on('click',function(event, data){
                    clearDraw()
                    draw()
                });



                $scope.$on('analysisInit',function(event, data){
                    init()
                });

                function clearDraw(){
                    svg.selectAll(".draw").remove()
                    LASTX = 0
                    LASTY = 0
                }

                init()

                function draw(){
                    LASTY += OFFSETTOP
                    LASTX += OFFSETLEFT

                    if($scope.debateInfo.preFinish){
                        //如果是准结束阶段,那么只有異議説明可以分析

                    }else{
                        painTitle("construct",LASTX,LASTY)
                        if($scope.analysisData){
                            paintFromData("construct",$scope.analysisData.analysisResult,0)
                        }

                    }


                    if($scope.analysisDissentExplainData){
                        for(var i=0;i<$scope.analysisDissentExplainData.length;i++){
                            if(!$scope.analysisDissentExplainData[i].analysisResult[0].claim) return
                            painTitle("dissentExplain",LASTX,LASTY)
                            paintFromData("dissentExplain",$scope.analysisDissentExplainData[i].analysisResult,i)
                        }
                    }


                }


                function paintFromData(category,data,dissentExplainI){
                    var startY = LASTY
                    for(var i=0;i<data.length;i++){
                        if(!data[i].claim) return;
                        appendRect(data[i].claim,data[i].cDissent,LASTX,LASTY,[category,i,0,"claim",dissentExplainI])

                        if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){
                            appendHint(LASTX,LASTX)
                        }

                        for(var j=0;j<data[i].support.length;j++){

                            //先画warrant
                            if(data[i].support[j].warrant || data[i].support[j].evidence){

                                if(j==0){
                                    LASTY += (SPACECWH+RECTHEIGHT)
                                }else{
                                    LASTY += (SPACEWWH+RECTHEIGHT)
                                }


                            }

                            LASTX += (SPACECWW)

                            if(data[i].support[j].warrant){
                                appendRect(data[i].support[j].warrant,data[i].support[j].wDissent,LASTX,LASTY,[category,i,j,"warrant",dissentExplainI])
                            }



                            //再画evidence

                            LASTX += (RECTWIDTH + SPACEWEW)
                            if(data[i].support[j].evidence){
                                appendRect(data[i].support[j].evidence,data[i].support[j].eDissent,LASTX,LASTY,[category,i,j,"evidence",dissentExplainI])
                                drawArrow(MAINLINEOFFSETLEFT,LASTX,LASTY+RECTHEIGHT/2,LASTY+RECTHEIGHT/2)
                            }

                            LASTX -= (RECTWIDTH + SPACEWEW + SPACECWW)

                        }

                        LASTY += (SPACECCH + RECTHEIGHT)
                    }


                    drawMainArrow(startY,LASTY)
                }


                function painTitle(type,x,y){

                    drawDottedLine(LASTX+DOTTEDLINEMARGINLEFT-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP,LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP)

                    if(type == "construct"){
                        if($scope.LAN == 'JP'){
                            drawText("立論の分析結果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }else{
                            drawText("原始阐述说明的分析结果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }

                    }else{

                        if($scope.LAN == 'JP'){
                            drawText("異議説明文の分析結果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }else{
                            drawText("质疑解释说明的分析结果",LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH-OFFSETLEFT+110,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP+8,16)
                        }

                    }

                    drawDottedLine(LASTX+DOTTEDLINEMARGINLEFT+DOTTEDLINELENGTH+DOTTEDLINESPACE-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP,LASTX+DOTTEDLINEMARGINLEFT+2*DOTTEDLINELENGTH+DOTTEDLINESPACE-OFFSETLEFT,LASTY+DOTTEDLINEMARGINTOP-OFFSETTOP)


                }


                function drawMainArrow(y1,y2){
                    var mainLine = svg.insert("line",":first-child")
                            .attr("x1",MAINLINEOFFSETLEFT)
                            .attr("y1",y1)
                            .attr("x2",MAINLINEOFFSETLEFT)
                            .attr("y2",y2+RECTHEIGHT-((SPACECCH + RECTHEIGHT))-RECTHEIGHT/2)
                            .attr("stroke","#9acfea")
                            .attr("stroke-width",5)
                            .attr("class","arrow draw")
                }

                function drawArrow(x1,x2,y1,y2){
                    var line = svg.insert("line",":first-child")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#9acfea")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                }

                function appendHint(x,y){
                    /*
                    var circle = svg.append("circle")
                    var circleR = 10
                    circle.attr("cy",y + RECTHEIGHT/2 - 2*circleR)
                    circle.attr("cx",x + 1.4*RECTWIDTH)
                    circle.style("fill","blue")
                    circle.attr("r",circleR)
                    */

                    var foreignObject = svg.append("foreignObject")
                    var hintWidth = 360
                    var hintHeight = 120
                    foreignObject.attr("width",hintWidth)
                    foreignObject.attr("height",hintHeight)

                    foreignObject.attr("y",y )
                    foreignObject.attr("x",x + 1.4*RECTWIDTH)
                    var _div = foreignObject.append('xhtml:div')
                    var image = _div.append("img")
                    image.attr("src", "/leftPointer.png")
                            .attr("width", "100")
                            .attr("height", "100");
                    foreignObject.transition().duration(1000).ease(d3.easeBounce).attr("x", x + 1.02*RECTWIDTH).attr("fill", "red");

                    var text = _div.append("span")
                    if($scope.LAN == 'JP'){
                        text.text("異議がある部分を選んでください")
                    }else{
                        text.text("点击选择您想要质疑的那一项")
                    }


                    text.style("color","rgb(138, 109, 59)")
                    text.style("font-size","16px")
                }

                function appendRect(txt,dissent,x,y,conf){

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH)
                    foreignObject.attr("height",RECTHEIGHT)
                    foreignObject.attr("class","draw")

                    if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){


                        var bordered = foreignObject.attr("bordered") || 1

                            foreignObject.on("click",function(){


                                if(conf[3] == "claim"){
                                    //规定主张不能被质疑
                                    return false;
                                }

                                if(bordered %2 == 1){
                                    this.style.border = "4px solid yellow"
                                    var div = _div.append("div")
                                    var button = _div.append("button")

                                    if($scope.LAN == 'JP'){
                                        button.html("異議あり")
                                    }else{
                                        button.html("被质疑")
                                    }
                                    button.attr("type","button")
                                    button.attr("class","btn btn-danger pull-right")
                                    button.attr("id",conf.join(""))


                                    // get index


                                    var _category = conf[0]
                                    var _i = conf[1]
                                    var _j = conf[2]
                                    var _type =  conf[3]
                                    var indexToAnalysis,indexToStatement //statement's index <--> analysis random(_index) <----> statements' random(__index) statement中異議説明连analysis中的random,然后再通过analysis中的index找到最初对哪个statement质疑的
                                    var dissentExplainI = conf[4]





                                    if(_category == "construct"){
                                        indexToStatement = $scope.analysisData.indexToStatement
                                        if(_type == "claim"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].random
                                        }else if(_type == "warrant"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].support[_j].wrandom
                                        }else if(_type == "evidence"){
                                            indexToAnalysis = $scope.analysisData.analysisResult[_i].support[_j].erandom
                                        }else{
                                            alert("error0")
                                        }


                                    }else if(_category == "dissentExplain"){

                                        indexToStatement = $scope.analysisDissentExplainData[dissentExplainI].indexToStatement
                                        if(_type == "claim"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].random
                                        }else if(_type == "warrant"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].wrandom
                                        }else if(_type == "evidence"){
                                            indexToAnalysis = $scope.analysisDissentExplainData[dissentExplainI].analysisResult[_i].support[_j].erandom
                                        }else{
                                            alert("error1")
                                        }

                                    }else{
                                        alert("error2")
                                    }

                                    $scope.addDissentArr[conf.join("")] = {res:1,category:conf[0],i:conf[1],j:conf[2],type:conf[3],txt:txt,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement}

                                }else{
                                    this.style.border = ""
                                    d3.select("#"+conf.join("")).remove()
                                    $scope.addDissentArr[conf.join("")] = {res:0}
                                }

                                foreignObject.attr("bordered",++bordered)
                            })

                        }


                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)



                    var _div = foreignObject.append('xhtml:div')
                    var div = _div.append("div")
                    div.attr("class","alert alert-info draw")
                    div.attr("role","alert")
                    div.attr("style","height: 100px; overflow: auto;margin-bottom:1px")

                    var p = div.append("p")

                    var liebie
                    if($scope.LAN == "JP"){
                        if(conf[3] == "claim"){
                            liebie = "主張"
                        }else if(conf[3] == "evidence"){
                            liebie = "根拠"
                        }else{
                            liebie = "論拠"
                        }
                    }


                    if($scope.LAN == "CN"){
                        if(conf[3] == "claim"){
                            liebie = "主张"
                        }else if(conf[3] == "evidence"){
                            liebie = "证据"
                        }else{
                            liebie = "理由"
                        }
                    }


                    p.html(liebie+":"+txt)


                    //如果是在表明异议的阶段的话则不提供修改功能
                    //如果是在检查阶段则不提供修改功能
                    if($scope.debateInfo.status != 'appeal' && $scope.debateInfo.status != 'lookup' && $scope.debateInfo.status != 'kentou' && $scope.debateInfo.status != 'check'){
                        var div = _div.append("div")

                        //-----------------------------------------------
                        var divId = "btn"+Math.round(Math.random()*10000)
                        div.attr("id",divId)


                        if($scope.LAN == 'JP'){
                            var html = '<button class="btn btn-default pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">編集</button>'
                        }else{
                            var html = '<button class="btn btn-default pull-right" ng-click="edit(\''+conf[0]+'\','+parseInt(conf[1])+','+parseInt(conf[2])+',\''+conf[3]+'\',\''+parseInt(conf[4])+'\')">修改</button>'
                        }


                        angular.element(document.getElementById(divId)).append($compile(html)($scope));
                    }


                }


                function drawDottedLine(x1,y1,x2,y2){
                    var line = svg.insert("line")
                            .attr("x1",x1)
                            .attr("y1",y1)
                            .attr("x2",x2)
                            .attr("y2",y2)
                            .attr("stroke","#000")
                            .attr("stroke-width",3)
                            .attr("class","arrow draw")
                            .attr("stroke-dasharray","4,10")
                }


                function drawText(txt,x,y,font){
                    var text = svg.insert("text")
                    text.text(txt)
                    text.attr("x",x)
                            .attr("y",y)
                            .attr("font-size",font)
                            .attr("fill","#8a6d3b")
                            .attr("class","draw")
                }



                //如果是在表明异议的阶段的话则在最下方画一个下一步的按钮,点击后进入下一阶段
                if(($scope.debateInfo.status == 'appeal' && $scope.debateInfo.position == 2) || ($scope.debateInfo.status == 'lookup' && $scope.debateInfo.position == 1)){
                    addNextButton(LASTX,LASTY)
                }


                function addNextButton(x,y){
                    // will work when we need to add dissent on to the map
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH*1.2)
                    foreignObject.attr("height",RECTHEIGHT)

                    foreignObject.attr("x",x+RECTWIDTH)
                    foreignObject.attr("y",y-RECTHEIGHT)

                    if($scope.LAN == 'JP'){
                        drawText("次は立論と異議の説明文です....",x+RECTWIDTH+OFFSETLEFT+30,y-0.6*RECTHEIGHT,16)
                    }else{
                        drawText("接下来进入质疑解释说明和原始阐述说明阶段....",x+RECTWIDTH+OFFSETLEFT+30,y-0.6*RECTHEIGHT,16)
                    }


                    var _div = foreignObject.append('xhtml:div')


                    var button = _div.append("button")
                    if($scope.LAN == 'JP'){
                        button.html("次へ")
                    }else{
                        button.html("下一步")
                    }


                    button.attr("type","button")
                    button.attr("class","btn btn-default btn-lg pull-right")
                    button.style("margin-top","30px")
                    button.on("click",function(){
                        console.log("confirm dissent arr")
                        console.log($scope.addDissentArr)
                        toNextStep()
                    })

                    var image = _div.append("img")

                    image.attr("src", "/rightPointer.png")
                            .attr("width", "100")
                            .attr("height", "100");

                }




                function toNextStep(){

                    $scope.dissentData = []

                    $scope.statementData = ""

                    if(angular.equals($scope.addDissentArr, {})){
                        //如果没有选择质疑的选项那么直接进入下一步的立論的部分
                        $scope.statementStatus = {name:"claim",i:0}

                        if(($scope.debateInfo.order == $scope.totalNum-1) && ($scope.debateInfo.status == 'lookup')){
                            //说明现在这个阶段不能立論了,因为快要结束了
                            //而且在这里没有质疑那么直接提交空的異議説明和空的立論
                            $scope.lastStatement = 1
                            coreSocket.emit("giveStatement",{dissentData:$scope.dissentData,statementData:$scope.statementData})
                        }
                    }else{
                        $scope.statementStatus = {name:"dissent",i:0}
                    }



                    for(var i in $scope.addDissentArr){
                        if($scope.addDissentArr[i].res == 0) continue;

                        var category = $scope.addDissentArr[i].category
                        var _i = $scope.addDissentArr[i].i
                        var _j = $scope.addDissentArr[i].j
                        var type = $scope.addDissentArr[i].type
                        var txt = $scope.addDissentArr[i].txt
                        var indexToAnalysis = $scope.addDissentArr[i].indexToAnalysis
                        var indexToStatement = $scope.addDissentArr[i].indexToStatement
                        $scope.dissentData.push({category:category,type:type,txt:txt,reply:"",i:_i,j:_j,indexToAnalysis:indexToAnalysis,indexToStatement:indexToStatement})
                        $scope.statementStatus = {name:"dissent",i:0}

                    }

                    coreSocket.emit("selectDissent",{dissentData:$scope.dissentData,statementStatus:$scope.statementStatus,statementData:$scope.statementData})

                    /*
                     $scope.dissentData = [{type:"construct",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:0},
                     {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
                     {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
                     ]

                     */
                }



                $scope.edit = function(category,i,j,type,dissentExplainI){

                    if(category == "construct"){
                        $scope.inputStatus.i = i
                        $scope.inputStatus.j = j
                        $scope.inputStatus.name = type
                        $scope.analysisObject.target = category

                    }else if(category == "dissentExplain"){
                        $scope.analysisObject.i = parseInt(dissentExplainI)
                        $scope.analysisObject.target = category
                        $scope.inputStatus.i = i
                        $scope.inputStatus.j = j
                        $scope.inputStatus.name = type
                    }else{

                    }

                    checkIfOriginalDataExists()
                    //让textarea显示相应的内容
                }


                function checkIfOriginalDataExists(){
                    var status = $scope.inputStatus.name
                    var target = $scope.analysisObject.target
                    if(target == "construct"){
                        var data = $scope.analysisData.analysisResult
                    }else{
                        var data = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult
                    }
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if(status == "claim"){

                        $scope._contents = data[i].claim
                    }else if(status == "evidence"){
                        $scope._contents = data[i].support[j].evidence
                    }else if(status == "warrant"){
                        $scope._contents = data[i].support[j].warrant
                    }else{

                    }

                }



            },

            templateUrl:"/angularJSTemplate/public/analysisResult.html"
        }
    })


    myApp.directive("inputFormArea",function(){
        return {
            scope:false,
            controller:function($scope,$rootScope,coreSocket){

                $scope.conceptStatus = "analysis"   //concept directive controller


                $scope.$watch("analysisObject.target",function(val,preVal){
                    //从 construct变成dissentExplain
                    if(val == "dissentExplain" && preVal == "construct"){
                        $scope.topArticleChangeTabVal = 1
                        $rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:1});
                    }

                    if(val == "construct" && preVal == "dissentExplain"){
                        $scope.topArticleChangeTabVal = 0
                        $rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:0});
                    }

                })

                $scope.$watch("analysisObject.i",function(val,preVal){
                    //从 dissentExplain[preVal] 变dissentExplain[val]
                    if($scope.analysisObject.target == "dissentExplain"){
                        $rootScope.$broadcast('topArticleChangeTab',{topArticleChangeTabVal:val+1});
                   }
                })

                function addIntoAnalysisData(name){
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if($scope.analysisObject.target == "construct"){
                        if(name == "claim"){
                            $scope.analysisData.analysisResult[i].claim = $scope._contents
                        }

                        if(name == "evidence"){
                            $scope.analysisData.analysisResult[i].support[j].evidence = $scope._contents
                        }

                        if(name == "warrant"){
                            $scope.analysisData.analysisResult[i].support[j].warrant = $scope._contents
                        }
                    }


                    if($scope.analysisObject.target == "dissentExplain"){
                        var _i = $scope.analysisObject.i
                        if(name == "claim"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].claim = $scope._contents
                        }

                        if(name == "evidence"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].evidence = $scope._contents
                        }

                        if(name == "warrant"){
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = $scope._contents
                        }
                    }

                }



                $scope.output = function(){


                    if(!$scope._contents){
                        $scope.data1Success = 0
                        return;
                    }else{
                        $scope.data1Success = 1
                    }

                    if($scope.inputStatus.name == "claim"){
                        addIntoAnalysisData("claim")
                        $scope.inputStatus.name = "evidence"
                    }else if($scope.inputStatus.name == "evidence"){
                        addIntoAnalysisData("evidence")
                        $scope.inputStatus.name = "warrant"
                    }else if($scope.inputStatus.name == "warrant"){
                        addIntoAnalysisData("warrant")
                        $scope.inputStatus.name = "newEvidence"
                    }else if($scope.inputStatus.name == "newEvidence"){

                    }else if($scope.inputStatus.name == "newClaim"){

                    }else{

                    }

                    //画图

                    $rootScope.$broadcast('click',{});
                    checkIfOriginalDataExists()
                }


                function checkIfOriginalDataExists(){
                    var status = $scope.inputStatus.name
                    var target = $scope.analysisObject.target
                    if(target == "construct"){
                        var data = $scope.analysisData.analysisResult
                    }else{
                        var data = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult
                    }
                    var i = $scope.inputStatus.i
                    var j = $scope.inputStatus.j

                    if(status == "claim"){
                        $scope._contents = data[i].claim
                    }else if(status == "evidence"){
                        $scope._contents = data[i].support[j].evidence
                    }else if(status == "warrant"){
                        $scope._contents = data[i].support[j].warrant
                    }else{

                    }


                }


                $scope.noClaim = function(){
                    //点击已经没有claim的按钮
                    if($scope.analysisObject.target == "construct"){
                        $scope.inputStatus.name = "claim"
                        $scope.inputStatus.i = 0
                        $scope.inputStatus.j = 0

                        if($scope.analysisDissentExplainData.length>0){
                            $scope.analysisObject = {target:"dissentExplain",i:0}
                            checkIfOriginalDataExists()
                        }else{
                            //console.log("send")
                            //coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                            //print()
                            $scope.analysisObject.target = "preview"
                        }
                    } else if($scope.analysisObject.target == "dissentExplain"){
                        $scope.inputStatus.name = "claim"
                        $scope.inputStatus.i = 0
                        $scope.inputStatus.j = 0
                        if($scope.analysisObject.i<$scope.analysisDissentExplainData.length-1){
                            $scope.analysisObject.i = parseInt($scope.analysisObject.i) + 1
                            checkIfOriginalDataExists()
                        }else{
                            //console.log("send")
                            //coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                            //print()
                            $scope.analysisObject.target = "preview"
                        }
                    }else{

                    }


                }


                $scope.submit = function(){
                   // coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})



                    console.log("sfffffssssss")
                    console.log($scope.analysisData)
                      coreSocket.emit("giveAnalysis",{analysisData:$scope.analysisData,analysisDissentExplainData:$scope.analysisDissentExplainData})
                }

                $scope.noEvidence = function(){
                    //点击已经没有evidence的按钮
                    $scope.inputStatus.name = "newClaim"

                    //重新画图
                    $rootScope.$broadcast('click',{});

                }


                $scope.noCurrentEvidence = function(){
                    //没有在当前的i,j里找到evidence
                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j


                        if(j== $scope.analysisData.analysisResult[i].support.length-1){
                            //如果是最后一个evidence的话,去下一个claim或者去newClaim

                                if($scope.analysisData.analysisResult[i+1]){
                                    //如果下一个claim有内容的话,则去下一个claim
                                    $scope.inputStatus.name = "claim"
                                    $scope.inputStatus.i = i + 1
                                }else{
                                    //如果下一个claim没有内容的话,则去生成claim的选项
                                    $scope.inputStatus.name = "newClaim"
                                }

                        }else{
                            //如果舍弃的不是最后一个evidence的话,去下一个evidence
                            $scope.inputStatus.name = "evidence"
                        }


                        //不要删唯一的那个那个support
                        if($scope.analysisData.analysisResult[i].support.length > 1){
                            //说明至少还有两个support,删掉一个无所谓的
                            $scope.analysisData.analysisResult[i].support.splice(j,1)
                        }else{
                            $scope.analysisData.analysisResult[i].support[j].warrant = ""
                            $scope.analysisData.analysisResult[i].support[j].evidence = ""
                        }


                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        var _i = $scope.analysisObject.i


                        if(j== $scope.analysisDissentExplainData[_i].analysisResult[i].support.length-1){
                            //如果是最后一个evidence的话,去下一个claim或者去newClaim

                            if($scope.analysisDissentExplainData[_i].analysisResult[i+1]){
                                //如果下一个claim有内容的话,则去下一个claim
                                $scope.inputStatus.name = "claim"
                                $scope.inputStatus.i = i + 1
                            }else{
                                //如果下一个claim没有内容的话,则去生成claim的选项
                                $scope.inputStatus.name = "newClaim"
                            }

                        }else{
                            //如果舍弃的不是最后一个evidence的话,去下一个evidence
                            $scope.inputStatus.name = "evidence"
                        }


                        //不要删唯一的那个那个support
                        if($scope.analysisDissentExplainData[_i].analysisResult[i].support.length > 1){
                            //说明至少还有两个support,删掉一个无所谓的
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support.splice(j,1)
                        }else{
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = ""
                            $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].evidence = ""
                        }


                    }else{

                    }



                    //重新画图
                    $rootScope.$broadcast('click',{});

                }

                $scope.noCurrentWarrant = function(){
                    //点击已经没有warrant的按钮



                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        $scope.analysisData.analysisResult[i].support[j].warrant = ""


                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var j = $scope.inputStatus.j
                        var _i = $scope.analysisObject.i
                        $scope.analysisDissentExplainData[_i].analysisResult[i].support[j].warrant = ""


                    }else{

                    }

                    $scope.inputStatus.name = "newEvidence"
                    //重新画图
                    $rootScope.$broadcast('click',{});
                }

                $scope.setNewClaim = function(){
                    //点击还有claim的按钮


                    //如果下一步中有原先添加好的
                    var nextExistsOrNot = false

                    var _i = $scope.inputStatus.i

                    if($scope.analysisObject.target == "construct"){
                        if($scope.analysisData.analysisResult[_i+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.i = _i + 1
                            $scope.inputStatus.j = 0
                            $scope.inputStatus.name = "claim"
                            $scope._contents = $scope.analysisData.analysisResult[_i+1].claim
                        }
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        if($scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.i = _i + 1
                            $scope.inputStatus.j = 0
                            $scope.inputStatus.name = "claim"
                            $scope._contents = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i+1].claim
                        }
                    }else{

                    }


                    if(nextExistsOrNot){
                        return;
                    }


                    $scope.inputStatus.i++

                    $scope.inputStatus.j = 0
                    $scope.inputStatus.name = "claim"


                    if($scope.analysisObject.target == 'construct'){
                        $scope.analysisData.analysisResult.push({claim:"",support:[
                            {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        ],random:Math.round(Math.random()*100000)})
                    }else if($scope.analysisObject.target == 'dissentExplain'){
                        $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult.push({claim:"",support:[
                            {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        ],random:Math.round(Math.random()*100000)})
                    }else{

                    }

                }

                $scope.setNewEvidence = function(){

                    //如果下一步中已经有原先添加的
                    var nextExistsOrNot = false

                    var _i = $scope.inputStatus.i
                    var _j = $scope.inputStatus.j

                    if($scope.analysisObject.target == "construct"){
                        if($scope.analysisData.analysisResult[_i].support[_j+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.j = _j + 1
                            $scope.inputStatus.name ="evidence"
                            $scope._contents = $scope.analysisData.analysisResult[_i].support[_j+1].evidence
                        }
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        if($scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i].support[_j+1]){
                            nextExistsOrNot = true;
                            $scope.inputStatus.j = _j + 1
                            $scope.inputStatus.name ="evidence"
                            $scope._contents = $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[_i].support[_j+1].evidence
                        }
                    }else{

                    }

                    if(nextExistsOrNot){
                        return;
                    }


                    var i = $scope.inputStatus.i
                    $scope.inputStatus.j++

                    $scope.inputStatus.name ="evidence"

                    if($scope.analysisObject.target == 'construct'){
                        $scope.analysisData.analysisResult[i].support.push(
                                {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        )
                    }else if($scope.analysisObject.target == 'dissentExplain'){
                        $scope.analysisDissentExplainData[$scope.analysisObject.i].analysisResult[i].support.push(
                                {evidence:"",warrant:"",erandom:Math.round(Math.random()*100000),wrandom:Math.round(Math.random()*100000)}
                        )
                    }else{

                    }
                }


                $scope.noFirstClaim = function(){
                    //非第一个claim被点击没有claim


                    if($scope.analysisObject.target == "construct"){
                        var i = $scope.inputStatus.i

                        if(i == $scope.analysisData.analysisResult.length-1){
                            //如果是当前最后一个claim,那么进入newClaim环节
                            $scope.inputStatus.i = i-1
                            $scope.inputStatus.name = "newClaim"
                        }else{
                            //如果不是当前最后一个claim,那么进入下一个claim
                            $scope.inputStatus.name = "claim"
                        }

                        $scope.analysisData.analysisResult.splice(i,1)
                    }else if($scope.analysisObject.target == "dissentExplain"){
                        var i = $scope.inputStatus.i
                        var _i = $scope.analysisObject.i

                        if(i == $scope.analysisDissentExplainData[_i].analysisResult.length-1){
                            //如果是当前最后一个claim,那么进入newClaim环节
                            $scope.inputStatus.i = i-1
                            $scope.inputStatus.name = "newClaim"
                        }else{
                            //如果不是当前最后一个claim,那么进入下一个claim
                            $scope.inputStatus.name = "claim"
                        }

                        $scope.analysisDissentExplainData[_i].analysisResult.splice(i,1)
                    }else{

                    }

                    //重新画图
                    $rootScope.$broadcast('click',{});




                }


                $scope.dataSucessOfRequestTwice = 1
                $scope.requestTwiceStatement = function(){
                    if(!$scope.requestContentReason){
                        $scope.dataSucessOfRequestTwice = 0
                    }else{
                        alert("send request")
                    }
                }

            },
            templateUrl:"/angularJSTemplate/public/inputFormArea.html"
        }
    })



    myApp.directive("inputTextArea",function(coreSocket,$compile,$rootScope) {
        return {
            scope: false,
            link:function(scope, element, attrs){

                    var TOP = 15   //最先画的方块距离顶端的距离
                    var LEFT = 80   //最先画的方块距离左边的距离
                    var DISSENTWIDTH = 250 //异议方块的长度
                    var DISSENTHEIGHT = 260//异议方块的高度
                    var DISSENTANDEXPLAINSPACE = 250 //异议方块距离右边的赛解释说明方块的横向距离
                    var DISSENTSPACEY = 80 //异议方块之间间隔的距离
                    var EXPLAINWIDTH = 460
                    var EXPLAINHEIGHT = 260
                    var DISSENTANDLINESPACEY = 90 //异议方块距离下面虚线的纵向距离
                    var DOTTEDLINEX = 40//虚线的左边位移
                    var DOTTEDWIDTH = 360 //虚线的长度
                    var DOTTEDSPACEWIDTH = 300 //虚线间隔的长度
                    var DOTTEDLINEANDCONSTRUCTSPACE = 50 //虚线距离下面方块的纵向距离
                    var CONSTRUCTX = LEFT //结论方块距离左侧的位移
                    var CONSTRUCTWIDTH = 960 //结论方块的长度
                    var CONSTRUCTHEIGHT = 260 //结论方块的高度

                    var LASTX = 0
                    var LASTY = 0
                    var svg
                    setTimeout(function(){
                        svg = d3.select("#_mainSVG")
                        clearDraw()
                        draw()
                    },800)




                    scope.$on('drawStatementResult',function(event, data){
                        clearDraw()
                        draw()

                    });


                    if(scope.dissentData.length > 0){
                        scope.dissentTxt = scope.dissentData[0].txt
                    }

                    scope.conceptStatus = "statement"   //concept directive controller

                    scope.output2 = function(){

                        if(!scope.statement){
                            scope.data2Success = 0
                            return;
                        }else{
                            scope.data2Success = 1
                        }

                        var i = scope.statementStatus.i
                        scope.infoAndStatementMapTabVal = 2

                        console.log(scope.statementStatus)
                        console.log(scope.dissentData)

                        if(scope.statementStatus.name == "claim"){
                            scope.statementData = scope.statement

                            scope.statementStatus.name = "submit"
                        }else if(scope.statementStatus.name == "dissent"){
                            scope.dissentData[i].reply = scope.statement
                                if(i<scope.dissentData.length-1){
                                    i++
                                    scope.statement = scope.dissentData[i].reply
                                    scope.dissentTxt = scope.dissentData[i].txt
                                    scope.statementStatus.i = i
                                }else{

                                    if(scope.lastStatement == 1){
                                            //如果到了准结束的阶段,那么发送

                                        scope.statementStatus.name = "preview"
                                        scope.conceptStatus = "noberu"
                                        $rootScope.$broadcast('drawStatementResult');
                                        //submit()
                                    }else{
                                            //如果还没有到准结束的阶段那么阐述立論
                                            scope.dissentTxt = ""
                                            scope.statement = scope.statementData
                                            scope.statementStatus.i = 0
                                            scope.statementStatus.name = "claim"
                                    }

                                }
                        }else{

                            scope.statementStatus.name = "preview"
                            scope.conceptStatus = "noberu"
                            $rootScope.$broadcast('drawStatementResult');
                            //submit()
                        }


                        /*
                        if(scope.dissentData.length == 0 || i == scope.dissentData.length){
                            //说明这里没有质疑或者已经完成对所有质疑的解释
                            scope.statementStatus = {name:"claim",i:0}
                            scope.statementStatus.name = "submit"
                            scope.infoAndStatementMapTabVal = 2
                        }else{
                            //说明这里还是对异议做解释的阶段
                            i++
                            scope.statementStatus.i = i
                        }
                        */



                        clearDraw()
                        draw()

                        if(scope.statementStatus.name == "dissent"){
                            scrollTop("dissent"+i,1000,(parseInt(document.getElementById("dissent"+(i)).getAttribute("y")) - 10))
                        }else{
                            scrollTop("constructClaim",1000,(parseInt(document.getElementById("constructClaim").getAttribute("y")))-DISSENTANDLINESPACEY)
                        }
                    }


                scope.edit2 = function(type,i){
                    if(type == "dissent"){
                        if(i < scope.dissentData.length){
                            scope.statementStatus.name = "dissent"
                            scope.statementStatus.i = i
                            scope.statement = scope.dissentData[i].reply
                            scope.dissentTxt = scope.dissentData[i].txt
                        }else{
                            scope.statementStatus.name = "claim"
                            scope.statementStatus.i = 0
                            scope.statement = scope.statementData
                        }
                    }else if(type == "claim"){
                        scope.statementStatus.name = "claim"
                        scope.statementStatus.i = 0
                        scope.statement = scope.statementData
                    }else{

                    }


                }



                    function submit(){
                        coreSocket.emit("giveStatement",{dissentData:scope.dissentData,statementData:scope.statementData})
                    }

                    function scrollTop(id,time,y){
                            document.getElementById("statementResult").scrollTop = y
                    }


                    function draw(){
                        LASTX = LEFT
                        LASTY = TOP
                        for(var i = 0;i<scope.dissentData.length;i++){
                            if(i>0) LASTY += DISSENTSPACEY
                            appendRect(scope.dissentData[i].txt,1,LASTX,LASTY,DISSENTWIDTH,DISSENTHEIGHT,"dissent"+i)

                            if(scope.dissentData[i].reply){
                                drawArrow(LASTX+DISSENTWIDTH,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE,LASTY+DISSENTHEIGHT/2,LASTY+DISSENTHEIGHT/2)


                                if(scope.LAN == 'JP'){
                                    drawText("この異議の説明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                                }else{
                                    drawText("这里是对质疑的说明",LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE*0.4,LASTY+DISSENTHEIGHT/2,16)
                                }





                                appendRect(scope.dissentData[i].reply,0,LASTX+DISSENTWIDTH+DISSENTANDEXPLAINSPACE+5,LASTY,EXPLAINWIDTH,EXPLAINHEIGHT,"explain"+i)
                            }else{
                                drawPointer(LASTX+DISSENTWIDTH,LASTY+DISSENTHEIGHT/4,200,200)
                            }

                            LASTY += DISSENTHEIGHT
                        }


                        LASTY += DISSENTANDLINESPACEY



                            //如果为非准结束阶段,那么是允许立論的,否则不允许立論

                            if(scope.lastStatement != 1){


                                drawDottedLine(DOTTEDLINEX,LASTY,DOTTEDLINEX+DOTTEDWIDTH,LASTY)

                                if(scope.LAN == 'JP'){
                                    drawText("ここから立論の部分",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                                }else{
                                    drawText("以下是原始阐述说明",DOTTEDLINEX+DOTTEDWIDTH+50,LASTY+5,16)
                                }

                                drawDottedLine(DOTTEDLINEX+DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY,DOTTEDLINEX+2*DOTTEDWIDTH+DOTTEDSPACEWIDTH,LASTY)

                                appendRect(scope.statementData,0,CONSTRUCTX,LASTY+DOTTEDLINEANDCONSTRUCTSPACE,CONSTRUCTWIDTH,CONSTRUCTHEIGHT,"constructClaim")
                                if(scope.statementData){
                                    d3.select("#constructClaim").style("display","block")
                                }else{
                                    d3.select("#constructClaim").style("display","none")
                                }
                            }


                    }


                    function clearDraw(){
                        svg.selectAll(".draw").remove()
                        LASTX = 0
                        LASTY = 0
                    }

                    function drawDottedLine(x1,y1,x2,y2){
                        var line = svg.insert("line")
                                .attr("x1",x1)
                                .attr("y1",y1)
                                .attr("x2",x2)
                                .attr("y2",y2)
                                .attr("stroke","#000")
                                .attr("stroke-width",3)
                                .attr("class","arrow draw")
                                .attr("stroke-dasharray","4,10")
                    }

                    function drawPointer(x,y,width,height){
                        var foreignObject = svg.append("foreignObject")
                                .attr("width",width)
                                .attr("height",height)
                                .attr("x",x)
                                .attr("y",y)
                                .attr("class","draw")

                        var div = foreignObject.append('xhtml:div')
                        var image = div.append("img")

                        image.attr("src", "/leftPointer.png")
                                .attr("width", "100")
                                .attr("height", "100");

                        if(scope.LAN == 'JP'){
                            drawText("左の異議を説明してください",x+100,y+100/2,20)
                        }else{
                            drawText("请对左侧您选择的质疑做阐述说明",x+100,y+100/2,20)
                        }

                    }

                    function drawArrow(x1,x2,y1,y2){
                        var line = svg.insert("line",":first-child")
                                .attr("x1",x1)
                                .attr("y1",y1)
                                .attr("x2",x2)
                                .attr("y2",y2)
                                .attr("stroke","#9acfea")
                                .attr("stroke-width",3)
                                .attr("class","arrow draw")
                                .attr("marker-end","url(#arrow)")
                    }

                    function drawText(txt,x,y,font){
                        var text = svg.insert("text")
                        text.text(txt)
                        text.attr("x",x)
                                .attr("y",y)
                                .attr("font-size",font)
                                .attr("fill","#8a6d3b")
                                .attr("class","draw")
                    }

                    function appendRect(txt,dissent,x,y,w,h,id){
                        var foreignObject = svg.append("foreignObject")
                        foreignObject.attr("width",w)
                        foreignObject.attr("height",h)

                        foreignObject.attr("x",x)
                        foreignObject.attr("y",y)
                        foreignObject.attr("id",id)
                        foreignObject.attr("class","draw")


                        var _div = foreignObject.append('xhtml:div')
                        var div = _div.append("div")
                        div.attr("class","alert alert-warning  row")
                        div.attr("role","alert")
                        div.attr("style","height: "+ h*0.6 +"px; overflow: auto;margin-bottom:1px")


                        var p = div.append("p")
                        p.html(txt)



                        if(id != 'constructClaim' && dissent == 1){
                            //如果是左边的被质疑的模块
                            var div = _div.append("div")
                            var button = _div.append("button")
                            if(scope.LAN == 'JP'){
                                button.html("異議あり")
                            }else{
                                button.html("被质疑")
                            }

                            button.attr("type","button")
                            button.attr("class","btn btn-danger pull-right")
                        }


                        if(id != 'constructClaim' && dissent == 0){
                            //如果是右侧异议解释模块
                            var div = _div.append("div")
                            div.attr("class","row")
                            var divId = "btn"+Math.round(Math.random()*10000)
                            div.attr("id",divId)

                            var num = parseInt(/explain(\d)/.exec(id)[1])

                            if(scope.LAN == 'JP'){
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">編集</button>'
                            }else{
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'dissent\',' + num + ')">修改</button>'
                            }


                            angular.element(document.getElementById(divId)).append($compile(html)(scope));


                            /*
                            var button = div.append("button")
                            if(scope.LAN == 'JP'){
                                var span = button.html("span")
                                span.text("編集")
                            }else{
                                var span = button.html("span")
                                span.text("修改")
                            }


                            button.attr("class","btn btn-default pull-right")

                            span.bind("click",function(){
                                scope.edit2("dissent",parseInt(/explain(\d)/.exec(id)[1]))
                            })
                            */
                        }


                        if(id == 'constructClaim'){
                            //如果是原始阐述的部分的话
                            var div = _div.append("div")
                            div.attr("class","row")
                            var divId = "btn"+Math.round(Math.random()*10000)
                            div.attr("id",divId)


                            if(scope.LAN == 'JP'){
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">編集</button>'
                            }else{
                                var html = '<button class="btn btn-default pull-right" ng-click="edit2(\'claim\',' + num + ')">修改</button>'
                            }


                            angular.element(document.getElementById(divId)).append($compile(html)(scope));
                        }

                    }
            },
            templateUrl:"/angularJSTemplate/public/inputTextArea.html"
        }
    })


    myApp.directive("examAnalysisResult",function(coreSocket){
        return{
            scope:false,
            link:function(scope,element){
                scope.examAnalysisResultTabVal = 1


                scope.submit = function(){
                    if(scope.examAnalysisResultTabVal == 1){
                        approval()
                    }else{
                        refuse()
                    }
                }

                var approval = function(){
                    coreSocket.emit("confirmAnalysisResult",{comment:scope.examAnalysisResultComment})
                }

                var refuse = function(){
                        alert("refuse")
                }
            },
            templateUrl:"/angularJSTemplate/public/examAnalysisResult.html"
        }
    })






    myApp.directive("concept",function(){
        return {
            scope:false,
            link:function(scope,element){

            },
            templateUrl:"/angularJSTemplate/public/concept.html"
        }
    })

    myApp.directive("infoAndStatementMap",function(){
        return {
            scope:false,
            link:function(scope,element){
                scope.infoAndStatementMapTabVal = 2
                scope.infoAndStatementMapTab = function(n){
                    scope.infoAndStatementMapTabVal = n
                }

                if(scope.debateInfo.status == 'appeal' || scope.debateInfo.status == 'lookup'){
                    scope.infoAndStatementMapBodyHeight = 600
                }else{
                    scope.infoAndStatementMapBodyHeight = 400
                }


            },
            templateUrl:"/angularJSTemplate/public/infoAndStatementMap.html"
        }
    })


    myApp.directive("infoAndAnalysisMap",function(){
        return {
            scope:false,
            link:function(scope,element){

                scope.changeTabVal = 0
                scope.changeTab = function(n){
                    scope.changeTabVal = n
                }

                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }


            },
            templateUrl:"/angularJSTemplate/public/infoAndAnalysisMap.html"
        }
    })


    myApp.directive("infoAndStatementAnalysisMap",function(myPost){
        return {
            scope:false,
            link:function(scope,element){
                scope.infoAndStatementAnalysisMapTabVal = 1
                scope.infoAndStatementAnalysisMapTab = function(n){
                    scope.infoAndStatementAnalysisMapTabVal = n
                }

                scope.leave = function(){
                    myPost.postData("/release/leaveRoom").then(function(res){
                        if(res.data.err == 0){
                            if(scope.LAN == 'JP'){
                                location = "/release/group"
                            }else{
                                location = "/releaseCN/group"
                            }
                        }
                    })
                }
            },
            templateUrl:"/angularJSTemplate/public/infoAndStatementAnalysisMap.html"
        }
    })


    myApp.directive("analysisMapResult",function(){
        return {
            scope:false,
            link:function(scope,element){
                var svg = d3.select("#analysisMapSVG").append("svg")
                svg.attr("width","100%")
                svg.attr("height","2000px")

                var _width = document.getElementById("analysisMapSVG").offsetWidth //实际svg的宽度

                var LEFT = _width*0.05
                var TOP = 35

                var PROX1 = _width/7
                var PROX2 = _width/7*2
                var PROX3 = _width/7*3

                var CONX1 = _width/7*4
                var CONX2 = _width/7*5
                var CONX3 = _width/7*6

                var R = _width/7/3/2

                var PROLASTX,PROLASTY
                var CONLASTX,CONLASTY

                var PROLASTELEMENTY,CONLASTELEMENTY //记录上一个节点的坐标,用于线条的点数据坐标的处理

                var DEGREE = 30 * (Math.PI / 180)
                var arrowLine = {pro:[],con:[]}

                var loopI
                //current loop index reflexing the num of the data in database
                draw(scope.analysisMapInformation.res.data)

                console.log(scope.analysisMapInformation.res.data)

                function draw(data){
                    PROLASTY = TOP
                    CONLASTY = TOP

                    for(var i=0;i<data.length;i++){
                        //先画阐述说明的分析结果
                        loopI = i

                        paintFromData("construct",data[i].analysisData,data[i].position)
                        //再画异议说明的分析结果
                        paintFromData("dissentExplain",data[i].analysisDissentExplainData,data[i].position)
                    }

                    //画完图后每个点的坐标都计算出来了,接下来开始画线条,连接的线条

                    for(var i=0;i<data.length;i++){
                        loopI = i
                        doLineFromData("construct",data[i].analysisData,data[i].position)
                        doLineFromData("dissentExplain",data[i].analysisDissentExplainData,data[i].position)
                    }


                   drawConnectedLine(arrowLine.pro,"#bdf")
                   drawConnectedLine(arrowLine.con,"#bfd")
                }


                function drawConnectedLine(data,color){
                    for(var i=0;i<data.length;i++){
                        var line = svg.append("line")
                        line.attr("x1",data[i].startX)
                        line.attr("y1",data[i].startY)
                        line.attr("x2",data[i].endX)
                        line.attr("y2",data[i].endY)
                        line.attr("stroke",color)
                        line.attr("stroke-width",5)
                    }
                }

                function paintFromData(category,data,position){

                    if(position == 1){
                        var px1 = PROX1
                        var px2 = PROX2
                        var px3 = PROX3
                    }else if(position == 2){
                        var px1 = CONX1
                        var px2 = CONX2
                        var px3 = CONX3
                    }else{
                        return;
                    }


                    if(category == "construct"){
                        if(angular.equals({},data)){
                            return;
                        }

                            for(var i=0;i<data.analysisResult.length;i++){
                                if(data.analysisResult[i].claim){
                                    append(category,position,"claim",data.analysisResult[i].claim,px1,[0,i,j])
                                }

                                for(var j=0;j<data.analysisResult[i].support.length;j++){
                                    if(data.analysisResult[i].support[j].warrant){
                                        append(category,position,"warrant",data.analysisResult[i].support[j].warrant,px2,[0,i,j])
                                    }

                                    if(data.analysisResult[i].support[j].evidence){
                                        append(category,position,"evidence",data.analysisResult[i].support[j].evidence,px3,[0,i,j])
                                    }


                                }
                            }


                    }

                    if(category == "dissentExplain"){
                        if(data.length == 0){
                            //如果没有数据的话就到此为止了
                            return;
                        }

                            for(var s=0;s<data.length;s++) {
                                for (var i = 0; i < data[s].analysisResult.length; i++) {
                                    append(category,position,"claim",data[s].analysisResult[i].claim,px1,[s,i,j])
                                    for (var j = 0; j < data[s].analysisResult[i].support.length; j++) {

                                        if(data[s].analysisResult[i].support[j].warrant){
                                            append(category,position,"warrant",data[s].analysisResult[i].support[j].warrant,px2,[s,i,j])
                                        }

                                        if(data[s].analysisResult[i].support[j].evidence){
                                            append(category,position,"evidence",data[s].analysisResult[i].support[j].evidence,px3,[s,i,j])
                                        }
                                    }
                                }

                            }

                    }



                }


                function doLineFromData(category,data,position){
                    //arrowLine

                    if(position == 1){
                        var colum = "pro"
                    }else if(position == 2){
                        var colum = "con"
                    }else{
                        return;
                    }


                    if(category == "construct"){
                        if(angular.equals({},data)){
                            return;
                        }


                        for(var i=0;i<data.analysisResult.length;i++){


                            for(var j=0;j<data.analysisResult[i].support.length;j++){

                                if(data.analysisResult[i].support[j].warrant){
                                    //如果warrant存在的话
                                    var startX = data.analysisResult[i].coordinateC.x
                                    var startY = data.analysisResult[i].coordinateC.y
                                    var endX = data.analysisResult[i].support[j].coordinateW.x
                                    var endY = data.analysisResult[i].support[j].coordinateW.y
                                    arrowLine[colum].push({startX:startX,startY:startY,endX:endX,endY:endY})
                                }

                                if(data.analysisResult[i].support[j].evidence){

                                    //如果evidence存在的话
                                    if(data.analysisResult[i].support[j].warrant){
                                        //如果warrant存在,那么连接warrant
                                        var startX = data.analysisResult[i].support[j].coordinateW.x
                                        var startY = data.analysisResult[i].support[j].coordinateW.y
                                    }else{
                                        //如果warrant不存在,那么连接claim
                                        var startX = data.analysisResult[i].coordinateC.x
                                        var startY = data.analysisResult[i].coordinateC.y
                                    }

                                    var endX = data.analysisResult[i].support[j].coordinateE.x
                                    var endY = data.analysisResult[i].support[j].coordinateE.y
                                    arrowLine[colum].push({startX:startX,startY:startY,endX:endX,endY:endY})
                                }

                            }
                        }


                    }

                    if(category == "dissentExplain"){
                        if(data.length == 0){
                            //如果没有数据的话就到此为止了
                            return;
                        }

                        for(var s=0;s<data.length;s++) {

                            for (var i = 0; i < data[s].analysisResult.length; i++) {

                                for (var j = 0; j < data[s].analysisResult[i].support.length; j++) {
                                        if(data[s].analysisResult[i].support[j].warrant){

                                            var startX = data[s].analysisResult[i].coordinateC.x
                                            var startY = data[s].analysisResult[i].coordinateC.y


                                            var endX = data[s].analysisResult[i].support[j].coordinateW.x
                                            var endY = data[s].analysisResult[i].support[j].coordinateW.y
                                            arrowLine[colum].push({startX:startX,startY:startY,endX:endX,endY:endY})
                                        }


                                        if(data[s].analysisResult[i].support[j].evidence){

                                            if(data[s].analysisResult[i].support[j].warrant){
                                                    //如果warrant存在,那么连接warrant
                                                var startX = data[s].analysisResult[i].support[j].coordinateW.x
                                                var startY = data[s].analysisResult[i].support[j].coordinateW.y
                                            }else{
                                                    //如果warrant不存在,那么连接claim
                                                var startX = data[s].analysisResult[i].coordinateC.x
                                                var startY = data[s].analysisResult[i].coordinateC.y
                                            }

                                            var endX = data[s].analysisResult[i].support[j].coordinateE.x
                                            var endY = data[s].analysisResult[i].support[j].coordinateE.y
                                            arrowLine[colum].push({startX:startX,startY:startY,endX:endX,endY:endY})
                                        }
                                }
                            }

                        }

                    }
                }



                function append(category,position,type,_text,XPOSITION,conf){
                    var i = parseInt(conf[1])
                    var j = parseInt(conf[2])

                    if(position == 1){
                        var colum = "pro"
                        var px1 = PROX1
                        var px2 = PROX2
                        var px3 = PROX3
                        var color = "#bdf"
                        var lastY = PROLASTY
                    }else if(position == 2){
                        var colum = "con"
                        var px1 = CONX1
                        var px2 = CONX2
                        var px3 = CONX3
                        var color = "#bfd"
                        var lastY = CONLASTY
                    }else{
                        return;
                    }

                    //写得好乱啊
                    var coordinate = drawACircle(XPOSITION,lastY,R,color)
                    editCoordinate(coordinate,category,type,conf)
                    drawAText(XPOSITION - R*0.7,lastY + R*0.1,type,{category:category,conf:conf,coordinate:coordinate})

                    var _verticalInterval = Math.tan(DEGREE)*(_width/7)

                    if(position == 1){
                        PROLASTY += _verticalInterval
                    }else if(position == 2){
                        CONLASTY += _verticalInterval
                    }else{
                        return;
                    }

                }



                function drawACircle(x,y,r,color){
                    var circle = svg.append("circle")
                    circle.attr("cx",x)
                    circle.attr("r",r)
                    circle.attr("cy",y)
                    circle.attr("fill",color)
                    return {x:x,y:y}
                }


                function drawAText(x,y,_text,info){
                    var text = svg.append("text")
                    text.attr("x",x)
                    text.text(_text + "----"+info.coordinate.y+"--"+info.category)
                    text.attr("y",y)
                }

                function editCoordinate(coordinate,category,type,conf){
                    //scope.analysisMapInformation.res.data

                    var s = parseInt(conf[0])
                    var i = parseInt(conf[1])
                    var j = parseInt(conf[2])


                    if(category == "construct"){
                        if(type == "claim"){
                            scope.analysisMapInformation.res.data[loopI].analysisData.analysisResult[i].coordinateC = coordinate
                        }else if(type == "evidence"){
                            scope.analysisMapInformation.res.data[loopI].analysisData.analysisResult[i].support[j].coordinateE = coordinate
                        }else if(type == "warrant"){
                            scope.analysisMapInformation.res.data[loopI].analysisData.analysisResult[i].support[j].coordinateW = coordinate
                        }else{

                        }
                    }else if(category == "dissentExplain"){

                        if(type == "claim"){
                            scope.analysisMapInformation.res.data[loopI].analysisDissentExplainData[s].analysisResult[i].coordinateC = coordinate
                        }else if(type == "evidence"){
                            scope.analysisMapInformation.res.data[loopI].analysisDissentExplainData[s].analysisResult[i].support[j].coordinateE = coordinate
                        }else if(type == "warrant"){
                            scope.analysisMapInformation.res.data[loopI].analysisDissentExplainData[s].analysisResult[i].support[j].coordinateW = coordinate
                        }else{

                        }
                    }else{
                        return;
                    }
                }


            },
            templateUrl:"/angularJSTemplate/public/analysisMapResult.html"
        }
    })







    myApp.directive("analysisMapResult2",function(){
        return {
            scope:false,
            link:function(scope,element){


                var _width = document.getElementById("analysisMapSVG").offsetWidth //实际svg的宽度
                var svg = d3.select("#analysisMapSVG").append("svg")
                svg.attr("width","1200px")
                svg.attr("height","2000px")
                svg.style("background","#bdf")

                var LEFT = _width*0.05
                var TOP = 35

                var CLAIMWIDTH = (_width-2*LEFT)*0.4  //占据除去两个边距后5分之4的位置
                var POPUPRECTWIDTH = CLAIMWIDTH
                var CLAIMHEIGHT = 100;
                var POPUPRECTHEIGHT = CLAIMHEIGHT
                var CLAIMXINTERVAL = (_width-2*LEFT)*0.2 //间距占据除去两个编剧后5分之1的位置
                var CLAIMYINTERVAL = 100
                var SUPPORTYINTERVAL = 20
                var CLAIMANDSUPPORTYINTERVAL = 20  //主张和support的纵距离
                var SUPPORTANDSUPPORTYINTERVAL = 20  //support和support之间的纵距离
                var SUPPORTELEMENTANDDISSENTEXPLAINELEMENTYINTERVAL = 30  //被质疑的evidence或者warrant距离下面的解释说明的主张的距离

                var WARRANTWIDTH = CLAIMWIDTH/5  //占据5分之1的的位置


                var WARRANTHEIGHT = WARRANTWIDTH*0.7
                var EVIDENCEWIDTH = CLAIMWIDTH/5  //占据5分之1的的位置
                var EVIDENCEHEIGHT = EVIDENCEWIDTH*0.7


                var CLAIMXPRO = LEFT
                var CLAIMXCON = LEFT + CLAIMWIDTH + CLAIMXINTERVAL
                var LASTYPRO,LASTYCON
                LASTYPRO = TOP
                LASTYCON = TOP


                var WARRANTXPRO = CLAIMXPRO + CLAIMWIDTH/5
                var EVIDENCEXPRO = WARRANTXPRO +  2*(CLAIMWIDTH/5)

                var WARRANTXCON = CLAIMXCON + CLAIMWIDTH/5
                var EVIDENCEXCON = WARRANTXCON +  2*(CLAIMWIDTH/5)


                var MAINLINEXPRO = CLAIMXPRO + WARRANTWIDTH/3  //左侧主线条的起点横坐标
                var MAINLINEXCON = CLAIMXCON + WARRANTWIDTH/3  //右侧主线条的起点横坐标

                var MAINLINESTARTYPRO,MAINLINELASTYPRO //左侧主线条的起点和终点纵坐标
                var MAINLINESTARTYCON,MAINLINELASTYCON //右侧主线条的起点和终点纵坐标


                scope.mapData = {pro:[],con:[]}
                scope.mapDissentData = []
                dealWithData()
                function dealWithData(){



                    //先把主张的分析结果合一块儿
                    for(var i=0;i<scope.analysisMapInformation.res.data.length;i++){
                        var analysisResult = scope.analysisMapInformation.res.data[i].analysisData.analysisResult
                        var analysisDissentExplainData = scope.analysisMapInformation.res.data[i].analysisDissentExplainData

                        if(analysisDissentExplainData.length > 0) scope.mapDissentData.push(analysisDissentExplainData)
                        var position = scope.analysisMapInformation.res.data[i].position

                        if(position == 1){
                            scope.mapData.pro.push(analysisResult)
                        }else{
                            scope.mapData.con.push(analysisResult)
                        }
                    }




                    digui()
                    //最难的递归啦

                    function digui(){
                        //递归处理质疑的质疑

                        for(var i=0;i<scope.mapDissentData.length;i++){
                            for(var j=0;j<scope.mapDissentData[i].length;j++){

                                var indexToAnalysis = scope.mapDissentData[i][j].indexToAnalysis

                                var _slightestOrNot = slightestOrNot(scope.mapDissentData[i][j].analysisResult)

                                if(_slightestOrNot){
                                    var _findRandomByIndexToAnalysis = findRandomByIndexToAnalysis(indexToAnalysis)

                                    if(_findRandomByIndexToAnalysis){
                                        //删掉队列中的scope.mapDissentData[i][j] 放入相应的子元素下面
                                        var _copy = scope.mapDissentData[i][j].analysisResult
                                        scope.mapDissentData[i].splice(j,1)
                                        var _type = _findRandomByIndexToAnalysis.type
                                        var _i = _findRandomByIndexToAnalysis.i
                                        var _j = _findRandomByIndexToAnalysis.j
                                        var _k = _findRandomByIndexToAnalysis.k
                                        var _m = _findRandomByIndexToAnalysis.m

                                        if(_type == "warrant"){
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].wDissent = _copy
                                        }

                                        if(_type == "evidence"){
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].eDissent = _copy
                                        }



                                        digui()
                                    }
                                }

                                //alert(findRandomByIndexToAnalysis(indexToAnalysis,i,j))


                            }
                        }

                        return false;

                    }





                    function slightestOrNot(arr){
                        for(var i=0;i<arr.length;i++){
                            for(var j=0;j<arr[i].support.length;j++){

                                if(findIndexToAnalysisByRandom(arr[i].support[j].wrandom)){
                                    return false
                                }

                                if(findIndexToAnalysisByRandom(arr[i].support[j].erandom)){
                                    return false
                                }


                            }
                        }

                        return true
                    }


                    function findIndexToAnalysisByRandom(random){

                        for(var i=0;i<scope.mapDissentData.length;i++){
                            for(var j=0;j<scope.mapDissentData[i].length;j++){

                                for(var k=0;k<scope.mapDissentData[i][j].analysisResult.length;k++){
                                    var indexToAnalysis =  scope.mapDissentData[i][j].indexToAnalysis
                                    if(indexToAnalysis == random){
                                        return true
                                    }
                                }




                            }
                        }

                        return false;
                    }


                    function findRandomByIndexToAnalysis(indexToAnalysis){


                        for(var i=0;i<scope.mapDissentData.length;i++){
                            for(var j=0;j<scope.mapDissentData[i].length;j++){

                                for(var k=0;k<scope.mapDissentData[i][j].analysisResult.length;k++){

                                    for(var m=0;m<scope.mapDissentData[i][j].analysisResult[k].support.length;m++){
                                        var wrandom = scope.mapDissentData[i][j].analysisResult[k].support[m].wrandom
                                        var erandom = scope.mapDissentData[i][j].analysisResult[k].support[m].erandom

                                        if(indexToAnalysis == wrandom){
                                            return {type:"warrant",i:i,j:j,k:k,m:m}
                                        }

                                        if(indexToAnalysis == erandom){
                                            return {type:"evidence",i:i,j:j,k:k,m:m}
                                        }

                                    }
                                }




                            }
                        }

                        return false;
                    }







                    //再处理刚刚合一块儿的主张结果,对其中每个元素做检查,看是否有对他的质疑解释


                    for(var i=0;i<scope.mapData.pro.length;i++){
                        for(var j=0;j<scope.mapData.pro[i].length;j++){
                            var res =  findDissentAnalysisResult(scope.mapData.pro[i][j].random)
                            if(res){
                                scope.mapData.pro[i][j].cDissent = res
                            }

                            for(var k=0;k<scope.mapData.pro[i][j].support.length;k++){
                                var res1 =  findDissentAnalysisResult(scope.mapData.pro[i][j].support[k].wrandom)
                                if(res1){
                                    scope.mapData.pro[i][j].support[k].wDissent = res1
                                    //初始情况不显示
                                    scope.mapData.pro[i][j].support[k].wDissentShow = 0
                                }
                                var res2 =  findDissentAnalysisResult(scope.mapData.pro[i][j].support[k].erandom)
                                if(res2){
                                    scope.mapData.pro[i][j].support[k].eDissent = res2
                                    //初始情况不显示
                                    scope.mapData.pro[i][j].support[k].eDissentShow = 0
                                }
                            }
                        }
                    }

                    opt(scope.mapData.pro,1)

                    for(var i=0;i<scope.mapData.con.length;i++){
                        for(var j=0;j<scope.mapData.con[i].length;j++){
                            var res =  findDissentAnalysisResult(scope.mapData.con[i][j].random)
                            if(res){
                                scope.mapData.con[i][j].cDissent = res
                            }
                            for(var k=0;k<scope.mapData.con[i][j].support.length;k++){
                                var res1 =  findDissentAnalysisResult(scope.mapData.con[i][j].support[k].wrandom)
                                var res2 =  findDissentAnalysisResult(scope.mapData.con[i][j].support[k].erandom)

                                if(res1){
                                    scope.mapData.con[i][j].support[k].wDissent = res1
                                    //初始情况不显示
                                    scope.mapData.con[i][j].support[k].wDissentShow = 0
                                }
                                if(res2){
                                    scope.mapData.con[i][j].support[k].eDissent = res2
                                    //初始情况不显示
                                    scope.mapData.con[i][j].support[k].eDissentShow = 0
                                }

                            }

                        }
                    }

                    opt(scope.mapData.con,2)


                }









                function reDraw(){

                    svg.selectAll(".mapData").remove()
                    //起点重新规划
                    CLAIMXPRO = LEFT
                    CLAIMXCON = LEFT + CLAIMWIDTH + CLAIMXINTERVAL
                    LASTYPRO = TOP
                    LASTYCON = TOP

                    opt(scope.mapData.pro,1)
                    opt(scope.mapData.con,2)



                }


                function findDissentAnalysisResult(random){
                        for(var i=0;i<scope.mapDissentData.length;i++){
                            for(var j=0;j<scope.mapDissentData[i].length;j++){
                                if(random == scope.mapDissentData[i][j].indexToAnalysis){
                                        return scope.mapDissentData[i][j].analysisResult
                                }
                            }
                        }
                            return false
                }



                function drawLine(position){

                    if(position == 1){
                        painLine(svg,MAINLINEXPRO,MAINLINEXPRO,MAINLINESTARTYPRO,MAINLINELASTYPRO,"#e2e2e2")
                    }

                    if(position == 2){
                        painLine(svg,MAINLINEXCON,MAINLINEXCON,MAINLINESTARTYCON,MAINLINELASTYCON,"#e2e2e2")
                    }


                }


                function painLine(platform,x1,x2,y1,y2,color){
                    var svg = platform
                    var line = svg.append("line")
                    line.attr("class","mapData")
                    line.attr("x1",x1)
                    line.attr("x2",x2)
                    line.attr("y1",y1)
                    line.attr("y2",y2)
                    line.attr("stroke",color)
                    line.attr("stroke-width",5)
                }


                function opt(data,position){
                    for(var i=0;i<data.length;i++){
                        var analysisResult = data[i]
                        //console.log(scope.analysisMapInformation.res.data[i].position)

                        for(var j=0;j<analysisResult.length;j++){
                            var text = analysisResult[j].claim

                            if(!text) continue;
                            appendClaimText(text,position)


                            var support = analysisResult[j].support

                            if(position == 1){
                                MAINLINESTARTYPRO = LASTYPRO + CLAIMHEIGHT  //主线条的开始垂直纵坐标
                                LASTYPRO = LASTYPRO + CLAIMHEIGHT
                                if(support[0].evidence || support[0].warrant){
                                    //如果这个claim所属的evidence或者warrant存在的话那么把最后的延长线延伸到support
                                    LASTYPRO = LASTYPRO + CLAIMANDSUPPORTYINTERVAL  //模块的最后垂直坐标
                                }
                            }else{
                                MAINLINESTARTYCON = LASTYCON  + CLAIMHEIGHT  //主线条的开始垂直纵坐标
                                LASTYCON = LASTYCON + CLAIMHEIGHT
                                if(support[0].evidence || support[0].warrant){
                                    LASTYCON = LASTYCON + CLAIMANDSUPPORTYINTERVAL  //模块的最后垂直坐标
                                }

                            }


                            for(var k=0;k<support.length;k++){
                                var coordinateE = appendEvidence(support[k].evidence,position,support[k].eDissent,support[k].erandom,i,j,k)
                                var coordinateW = appendWarrant(support[k].warrant,position,support[k].wDissent,support[k].wrandom,i,j,k)


                                if(support[k].evidence || support[k].warrant){
                                    if(position == 1){
                                        MAINLINELASTYPRO = LASTYPRO + WARRANTHEIGHT/2

                                        if(support[k+1]){
                                            //如果还有下一个support的话
                                            LASTYPRO = LASTYPRO + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                                        }else{
                                            LASTYPRO = LASTYPRO + EVIDENCEHEIGHT
                                        }


                                    }else{
                                        MAINLINELASTYCON = LASTYCON + WARRANTHEIGHT/2

                                        if(support[k+1]){
                                            //如果还有下一个support的话
                                            LASTYCON = LASTYCON + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                                        }else{
                                            LASTYCON = LASTYCON + EVIDENCEHEIGHT
                                        }

                                    }
                                }

                                addDissentIfExists(support[k],position,coordinateE,coordinateW)
                            }


                            //如果还有下一个claim的话
                            if(analysisResult[j+1]){
                                if(position == 1){
                                    LASTYPRO = LASTYPRO + CLAIMYINTERVAL
                                }else{
                                    LASTYCON = LASTYCON + CLAIMYINTERVAL
                                }
                            }



                            drawLine(position)
                            //每循环一个claim画一次主线条

                        }


                    }

                }




                function appendClaimText(text,position){
                    if(!text) return;

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",CLAIMWIDTH)
                    foreignObject.attr("height",CLAIMHEIGHT)
                    foreignObject.attr("class","mapData")

                    var x = position == 1?CLAIMXPRO:CLAIMXCON
                    var y = position == 1?LASTYPRO:LASTYCON


                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')
                    div.attr("class","panel panel-default")
                    var _div = div.append("div")
                    _div.attr("class","panel-body")

                    _div.style("height",CLAIMHEIGHT+"px")
                    _div.style("overflow","auto")
                    var p = _div.append("p")
                    p.text(text)



                }



                function appendWarrant(text,position,dissentArr,wRandom,i,j,k){
                    if(!text) return;

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",WARRANTWIDTH)
                    foreignObject.attr("height",WARRANTHEIGHT)
                    foreignObject.attr("class","mapData")

                    var x = position == 1?WARRANTXPRO:WARRANTXCON
                    var y = position == 1?LASTYPRO:LASTYCON

                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')

                    var button = div.append("button")
                    button.attr("class","btn btn-default")
                    button.text("論拠")
                    var _id = "warrant"+Math.round(Math.random()*10000)
                    button.attr("id",_id)
                    document.getElementById(_id).onclick = function(){
                        popUp(text,x,y,position)
                    }

                    if(dissentArr){
                        button.append("span").attr("class","glyphicon glyphicon-star")
                    }
                    button.on("click",function(){

                        if(position == 1){
                            scope.mapData.pro[i][j].support[k].wDissentShow = (scope.mapData.pro[i][j].support[k].wDissentShow +1 ) % 2
                        }else if(position == 2){
                            scope.mapData.con[i][j].support[k].wDissentShow = (scope.mapData.con[i][j].support[k].wDissentShow + 1) % 2
                        }else{
                            alert("dvg")
                        }

                        reDraw()

                    })




                    return {x:x+10,y:y}
                }



                function popUp(text,x,y,position){

                    d3.selectAll(".balloon").remove()

                    var rect = svg.append("foreignObject")

                    rect.attr("x",x)
                    rect.attr("y",y)
                    rect.attr("width",POPUPRECTWIDTH)
                    rect.attr("height",POPUPRECTHEIGHT)


                    var div = rect.append('xhtml:div')
                    div.style("width",POPUPRECTWIDTH)
                    div.style("height",POPUPRECTHEIGHT)
                    div = div.append("div")


                    div.attr("class","row col-sm-12 balloon")

                    if(position == 1){
                        rect.attr("x",x+WARRANTWIDTH + 30)
                        div.classed("_balloon", true);
                    }else{
                        rect.attr("x",x-WARRANTHEIGHT)
                        div.classed("__balloon", true);
                    }

                    div.style("width",POPUPRECTWIDTH+"px")
                    div.style("background-color","#fff")


                    var sdiv = div.append("div")
                    sdiv.attr("class","row")

                    var title = sdiv.append("div")
                    title.attr("class","col-sm-10")

                    var remove = sdiv.append("div")
                    remove.attr("class","col-sm-6")
                    remove = remove.append("span")
                    remove.attr("class","glyphicon glyphicon-remove")
                    remove.attr("aria-hidden","true")
                    remove.style("cursor","pointer")

                    remove.on("click",function(){
                        rect.remove()
                    })


                    var content = sdiv.append("div")
                    content.attr("class","col-sm-11")
                    content.html(text)

                }

                function appendEvidence(text,position,dissentArr,eRandom,i,j,k){
                    if(!text) return;

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",EVIDENCEWIDTH)
                    foreignObject.attr("height",EVIDENCEHEIGHT)
                    foreignObject.attr("class","mapData")

                    var x = position == 1?EVIDENCEXPRO:EVIDENCEXCON
                    var y = position == 1?LASTYPRO:LASTYCON

                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)

                    var div = foreignObject.append('xhtml:div')

                    var button = div.append("button")
                    button.attr("class","btn btn-default")
                    button.text("根拠")


                    var _id = "evidence"+Math.round(Math.random()*10000)
                    button.attr("id",_id)
                    document.getElementById(_id).onclick = function(){
                        popUp(text,x,y,position)
                    }


                    if(dissentArr){
                        button.append("span").attr("class","glyphicon glyphicon-star")
                    }
                    button.on("click",function(){

                        if(position == 1){
                            scope.mapData.pro[i][j].support[k].eDissentShow = (scope.mapData.pro[i][j].support[k].eDissentShow + 1 ) % 2
                        }else if(position == 2){
                            scope.mapData.con[i][j].support[k].eDissentShow = (scope.mapData.con[i][j].support[k].eDissentShow + 1) % 2
                        }else{
                            alert("dvrg")
                        }
                        reDraw()

                    })

                    //evidence存在,那么直接画一条横线从evidence到claim

                    if(position == 1){
                        painLine(svg,MAINLINEXPRO,EVIDENCEXPRO,LASTYPRO + EVIDENCEHEIGHT/2,LASTYPRO + EVIDENCEHEIGHT/2,"#e2e2e2")
                    }else{
                        painLine(svg,MAINLINEXCON,EVIDENCEXCON,LASTYCON + EVIDENCEHEIGHT/2,LASTYCON + EVIDENCEHEIGHT/2,"#e2e2e2")
                    }

                    return {x:x+10,y:y}
                }

                function appendRect(platform,x,y,type,text,position,_text){
                    if(!text)  return
                    var svg = platform
                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("class","mapData")
                    foreignObject.attr("width",EVIDENCEWIDTH)
                    foreignObject.attr("height",EVIDENCEHEIGHT)

                    foreignObject.attr("x",x)
                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')

                    var button = div.append("button")
                    button.attr("class","btn btn-danger")
                    button.text(text)

                    var _id = type + Math.round(Math.random()*10000)
                    button.attr("id",_id)

                    document.getElementById(_id).onmouseover = function(){
                        popUp(_text,x,y,position)
                    }
                }

                function addDissentIfExists(obj,position,coordinateE,coordinateW){
                    if(!obj.wDissent && !obj.eDissent){
                        //如果针对warrant和evidence的质疑都没有的话
                        return;
                    }

                        //现在正在画左边还是正在画右边
                    if(position == 1){
                        LASTYPRO = LASTYPRO + SUPPORTELEMENTANDDISSENTEXPLAINELEMENTYINTERVAL
                    }else{
                        LASTYCON = LASTYCON + SUPPORTELEMENTANDDISSENTEXPLAINELEMENTYINTERVAL
                    }



                    //先warrant
                    if(obj.wDissent){
                        //如果处于开启状态的话

                        if(obj.wDissentShow == 1){
                            tmp(obj.wDissent,"warrant",position,obj.wrandom)
                        }

                    }


                    //再evidence
                    if(obj.eDissent){
                        if(obj.eDissentShow == 1){
                            tmp(obj.eDissent,"evidence",position,obj.erandom)
                        }

                    }


                    function tmp(obj,type,position,random){
                        var platform = svg.append("g")
                        platform.attr("id",random)

                        for(var i=0;i<obj.length;i++){
                            var y = position == 1?LASTYPRO:LASTYCON
                            if(type == "warrant"){
                                var x = position == 1?WARRANTXPRO:WARRANTXCON
                                tmp2(x,y,obj,position,i,platform,coordinateW)
                            }else if(type == "evidence"){
                                var x = position == 1?EVIDENCEXPRO:EVIDENCEXCON
                                tmp2(x,y,obj,position,i,platform,coordinateE)
                            }else{
                                return;
                            }
                        }
                    }


                    function tmp2(x,y,obj,position,i,platform,startCoordinate){
                        var startMainLineX = startCoordinate.x
                        var startMainLineY = startCoordinate.y + EVIDENCEHEIGHT*0.9
                        var endMainLineX = startMainLineX
                        var endMainLineY

                        appendRect(platform,x+30,y,"claim","主張",position,obj[i].claim)
                        if(position == 1){
                            LASTYPRO = LASTYPRO + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                        }else{
                            LASTYCON = LASTYCON + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                        }

                        //主体线和claim模块的连线
                        painLine(platform,startMainLineX,x+30,y+EVIDENCEHEIGHT/2,y+EVIDENCEHEIGHT/2,"#e2e2e2")



                        for(var j=0;j<obj[i].support.length;j++){
                            var _obj = obj[i].support[j]
                            var y = y + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                            if(_obj.evidence){
                                var _x = x+4*EVIDENCEWIDTH

                                appendRect(platform,_x,y,"evidence","根拠",position,obj[i].support[j].evidence)

                                //主体线和evidence模块的连线
                                painLine(platform,startMainLineX,_x,y+EVIDENCEHEIGHT/2,y+EVIDENCEHEIGHT/2,"#e2e2e2")

                            }

                            if(_obj.warrant){
                                var _x = x+2*EVIDENCEWIDTH
                                appendRect(platform,_x,y,"warrant","論拠",position,obj[i].support[j].warrant)
                            }

                            if(_obj.warrant || _obj.evidence){

                                endMainLineY = y + EVIDENCEHEIGHT/2
                                    if(position == 1){
                                        LASTYPRO = LASTYPRO + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                                    }else{
                                        LASTYCON = LASTYCON + EVIDENCEHEIGHT + SUPPORTANDSUPPORTYINTERVAL
                                    }



                                //addDissentIfExists(_obj,position,{x:_x,y:y},{x:_x,y:y})
                            }
                        }


                        //小模块内的主体线
                        painLine(platform,startMainLineX,endMainLineX,startMainLineY,endMainLineY,"#e2e2e2")


                    }


                }





            },
            templateUrl:"/angularJSTemplate/public/_analysisMapResult.html"
        }
    })




    myApp.directive("analysisMapResult3",function() {
        return {
            scope: false,
            link: function (scope, element) {



                var _width = document.getElementById("testAnalysisMapSVG").offsetWidth //实际svg的宽度
                var svg = d3.select("#analysisMapSVG").append("svg")
                svg.attr("width","1200px")
                svg.attr("height","2000px")
                svg.style("background","#bdf")

                var LEFT = _width*0.05
                var TOP = 35

                var CLAIMWIDTH = (_width-2*LEFT)*0.4  //占据除去两个边距后5分之4的位置
                var CLAIMHEIGHT = 100;
                var CLAIMXINTERVAL = (_width-2*LEFT)*0.2 //间距占据除去两个编剧后5分之1的位置
                var CLAIMYINTERVAL = 100  //轮次内的主张之间的垂直间隙

                var CLAIMTURNYINTERVAL = 150  //不同轮次内的主张和主张之间的垂直间隙
                var SUPPORTYINTERVAL = 20
                var CLAIMANDSUPPORTYINTERVAL = 20  //主张和support的纵距离
                var SUPPORTANDSUPPORTYINTERVAL = 20  //support和support之间的纵距离
                var SUPPORTELEMENTANDDISSENTEXPLAINELEMENTYINTERVAL = 30  //被质疑的evidence或者warrant距离下面的解释说明的主张的距离

                var ELEMENTWIDTH = CLAIMWIDTH/5  //占据5分之1的的位置
                var ELEMENTHEIGHT = ELEMENTWIDTH*0.7


                var CLAIMXPRO = LEFT
                var CLAIMXCON = LEFT + CLAIMWIDTH + CLAIMXINTERVAL


                var LASTY = ["",TOP,TOP] //一个数组的第二项和第三项分别存储正方和反方的升降机标尺数据

                var ELEMENTXINTERVAL = CLAIMWIDTH/5

                var MAINLINEXPRO = CLAIMXPRO + ELEMENTWIDTH/3  //左侧主线条的起点横坐标
                var MAINLINEXCON = CLAIMXCON + ELEMENTWIDTH/3  //右侧主线条的起点横坐标

                var MAINLINESTARTYPRO,MAINLINELASTYPRO //左侧主线条的起点和终点纵坐标
                var MAINLINESTARTYCON,MAINLINELASTYCON //右侧主线条的起点和终点纵坐标


                scope.mapData = {pro:[],con:[]}
                scope.mapDissentData = []
                dealWithData()
                function dealWithData() {
                    //先把主张的分析结果合一块儿
                    for (var i = 0; i < scope.analysisMapInformation.res.data.length; i++) {
                        var analysisResult = scope.analysisMapInformation.res.data[i].analysisData.analysisResult
                        var analysisDissentExplainData = scope.analysisMapInformation.res.data[i].analysisDissentExplainData

                        if (analysisDissentExplainData.length > 0) scope.mapDissentData.push(analysisDissentExplainData)
                        var position = scope.analysisMapInformation.res.data[i].position

                        if (position == 1) {
                            scope.mapData.pro.push(analysisResult)
                        } else {
                            scope.mapData.con.push(analysisResult)
                        }
                    }


                    digui()
                    //最难的递归啦

                    function digui() {
                        //递归处理质疑的质疑

                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                var indexToAnalysis = scope.mapDissentData[i][j].indexToAnalysis

                                var _slightestOrNot = slightestOrNot(scope.mapDissentData[i][j].analysisResult)

                                if (_slightestOrNot) {
                                    var _findRandomByIndexToAnalysis = findRandomByIndexToAnalysis(indexToAnalysis)

                                    if (_findRandomByIndexToAnalysis) {
                                        //删掉队列中的scope.mapDissentData[i][j] 放入相应的子元素下面
                                        var _copy = scope.mapDissentData[i][j].analysisResult
                                        scope.mapDissentData[i].splice(j, 1)
                                        var _type = _findRandomByIndexToAnalysis.type
                                        var _i = _findRandomByIndexToAnalysis.i
                                        var _j = _findRandomByIndexToAnalysis.j
                                        var _k = _findRandomByIndexToAnalysis.k
                                        var _m = _findRandomByIndexToAnalysis.m

                                        if (_type == "warrant") {
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].wDissent = _copy
                                        }

                                        if (_type == "evidence") {
                                            scope.mapDissentData[_i][_j].analysisResult[_k].support[_m].eDissent = _copy
                                        }


                                        digui()
                                    }
                                }

                                //alert(findRandomByIndexToAnalysis(indexToAnalysis,i,j))


                            }
                        }

                        return false;

                    }


                    function slightestOrNot(arr) {
                        for (var i = 0; i < arr.length; i++) {
                            for (var j = 0; j < arr[i].support.length; j++) {

                                if (findIndexToAnalysisByRandom(arr[i].support[j].wrandom)) {
                                    return false
                                }

                                if (findIndexToAnalysisByRandom(arr[i].support[j].erandom)) {
                                    return false
                                }


                            }
                        }

                        return true
                    }


                    function findIndexToAnalysisByRandom(random) {

                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                for (var k = 0; k < scope.mapDissentData[i][j].analysisResult.length; k++) {
                                    var indexToAnalysis = scope.mapDissentData[i][j].indexToAnalysis
                                    if (indexToAnalysis == random) {
                                        return true
                                    }
                                }


                            }
                        }

                        return false;
                    }


                    function findRandomByIndexToAnalysis(indexToAnalysis) {


                        for (var i = 0; i < scope.mapDissentData.length; i++) {
                            for (var j = 0; j < scope.mapDissentData[i].length; j++) {

                                for (var k = 0; k < scope.mapDissentData[i][j].analysisResult.length; k++) {

                                    for (var m = 0; m < scope.mapDissentData[i][j].analysisResult[k].support.length; m++) {
                                        var wrandom = scope.mapDissentData[i][j].analysisResult[k].support[m].wrandom
                                        var erandom = scope.mapDissentData[i][j].analysisResult[k].support[m].erandom

                                        if (indexToAnalysis == wrandom) {
                                            return {type: "warrant", i: i, j: j, k: k, m: m}
                                        }

                                        if (indexToAnalysis == erandom) {
                                            return {type: "evidence", i: i, j: j, k: k, m: m}
                                        }

                                    }
                                }


                            }
                        }

                        return false;
                    }


                    //再处理刚刚合一块儿的主张结果,对其中每个元素做检查,看是否有对他的质疑解释


                    for (var i = 0; i < scope.mapData.pro.length; i++) {
                        for (var j = 0; j < scope.mapData.pro[i].length; j++) {
                            var res = findDissentAnalysisResult(scope.mapData.pro[i][j].random)
                            if (res) {
                                scope.mapData.pro[i][j].cDissent = res
                            }

                            for (var k = 0; k < scope.mapData.pro[i][j].support.length; k++) {
                                var res1 = findDissentAnalysisResult(scope.mapData.pro[i][j].support[k].wrandom)
                                if (res1) {
                                    scope.mapData.pro[i][j].support[k].wDissent = res1
                                    //初始情况不显示
                                    scope.mapData.pro[i][j].support[k].wDissentShow = 0
                                }
                                var res2 = findDissentAnalysisResult(scope.mapData.pro[i][j].support[k].erandom)
                                if (res2) {
                                    scope.mapData.pro[i][j].support[k].eDissent = res2
                                    //初始情况不显示
                                    scope.mapData.pro[i][j].support[k].eDissentShow = 0
                                }
                            }
                        }
                    }



                    function findDissentAnalysisResult(random){
                        for(var i=0;i<scope.mapDissentData.length;i++){
                            for(var j=0;j<scope.mapDissentData[i].length;j++){
                                if(random == scope.mapDissentData[i][j].indexToAnalysis){
                                    return scope.mapDissentData[i][j].analysisResult
                                }
                            }
                        }
                        return false
                    }


                    console.log(scope.mapData)
                    console.log(66666666666666666)
                    console.log(scope.mapDissentData)

                    //主体思想是嵌套循环数据,分为左右两个区域
                    starDraw(scope.mapData.pro,1)
                    starDraw(scope.mapData.con,2)


                    function starDraw(data,position){

                        for(var i=0;i<data.length;i++){

                            //第i轮的主张

                            for(var j=0;j<data[i].length;j++){

                                if(!data[i][j].claim) return;

                                appendElement(CLAIMXPRO,LASTY[position],"主張")

                                //如果该轮次内还有下一个主张,把升降机下降到下一个主张的高度
                                if(data[i+1]){
                                    LASTY[position] = LASTY[position] + ELEMENTHEIGHT + CLAIMYINTERVAL
                                }else{
                                    //如果次主张下的第一个support有数据的话,那么把升降机下降至support数据的高度
                                    if(!data[i][j].support[0].evidence){
                                       LASTY[position] = LASTY[position] + ELEMENTHEIGHT + CLAIMANDSUPPORTYINTERVAL
                                    }

                                }
                            }

                        }

                    }


                    function appendElement(x,y,text){
                        if(!text)  return
                        var foreignObject = svg.append("foreignObject")
                        foreignObject.attr("class","mapData")
                        foreignObject.attr("width",ELEMENTWIDTH)
                        foreignObject.attr("height",ELEMENTHEIGHT)

                        foreignObject.attr("x",x)
                        foreignObject.attr("y",y)
                        var div = foreignObject.append('xhtml:div')

                        var button = div.append("button")
                        button.attr("class","btn btn-danger")
                        button.text(text)

                    }

                }

            },
            templateUrl:"/angularJSTemplate/public/__analysisMapResult.html"
        }
    })


    myApp.directive("statementMapResult",function(){
        return {
            scope:false,
            link:function(scope,element){


                var RECTWIDTH = 450  //模块的长度
                var RECTHEIGHT = 140  //模块的宽度
                var LEFT = 50  //最开始模块距离左边的边距
                var TOP = 50  //最开始模块距离顶端的边距
                var SPACEX = 150 //左边模块和右边模块的横向间距
                var SPACEY = 50 //模块和模块的上下垂直距离
                var LASTX,LASTY
                var svg = d3.select("#statementMapSVG").append("svg")
                svg.attr("width","1400px")
                svg.attr("height","2000px")
                draw(scope.statementMapInformation.res.data)



                function draw(data){

                    dealWithData(data)

                    LASTX = LEFT
                    LASTY = TOP
                    for(var i=0;i<data.length;i++){
                        for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                            appendRect(LASTX,LASTY,data[i].everyStatement.dissentExplain[j].reply,data[i].everyStatement.position,"dissentExplain",data[i].everyStatement.dissentExplain[j].dissent)
                            LASTY += (RECTHEIGHT + SPACEY)
                        }
                            appendRect(LASTX,LASTY,data[i].everyStatement.statementData,data[i].everyStatement.position,"construct",data[i].everyStatement.dissent)
                            LASTY += (RECTHEIGHT + SPACEY)
                    }
                }

                function dealWithData(data){
                    for(var s=0;s<data.length;s++){

                        var res = indexAndRandom(data[s].everyStatement.statementDataRandom)
                        if(res.res > 0){
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 1
                        }else{
                            scope.statementMapInformation.res.data[s].everyStatement.dissent = 0
                        }

                        for(var k=0;k<data[s].everyStatement.dissentExplain.length;k++){
                            var res = indexAndRandom(data[s].everyStatement.dissentExplain[k].random)
                            if(res.res > 0){
                                scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 1
                            }else{
                                scope.statementMapInformation.res.data[s].everyStatement.dissentExplain[k].dissent = 0
                            }
                        }

                    }
                }

                function indexAndRandom(random){
                    var data = scope.statementMapInformation.res.data
                    for(var i=0;i<data.length;i++){
                        for(var j=0;j<data[i].everyStatement.dissentExplain.length;j++){
                            if(data[i].everyStatement.dissentExplain[j].indexToStatement == random){
                                return {res:1,i:i,j:j}
                            }
                        }
                    }
                    return {res:0}
                }

                function appendRect(x,y,txt,position,type,dissent){
                    if(!txt) return;

                    var foreignObject = svg.append("foreignObject")
                    foreignObject.attr("width",RECTWIDTH)
                    foreignObject.attr("height",RECTHEIGHT)

                    if(parseInt(position) == 1){
                        foreignObject.attr("x",x)
                    }else{
                        foreignObject.attr("x",(x + RECTWIDTH + SPACEX))
                    }

                    foreignObject.attr("y",y)
                    var div = foreignObject.append('xhtml:div')

                    var _div = div.append("div")

                    if(parseInt(position) == 1){
                        _div.attr("class","alert alert-info")
                    }else{
                        _div.attr("class","alert alert-success")
                    }
                    _div.style("height",RECTHEIGHT*0.7+"px")
                    _div.style("width",RECTWIDTH+"px")
                    _div.style("overflow","auto")
                    _div.style("margin-bottom","1px")
                    _div.append("p").text(txt)




                    if(type == "construct"){
                        var _div = div.append("div")
                        _div.html('<button type="button" class="btn btn-default pull-left">立論</button>')
                    }else if(type == "dissentExplain"){
                        var _div = div.append("div")
                        _div.html('<button type="button" class="btn btn-default pull-left">異議説明</button>')
                    }else{

                    }

                    if(dissent>0) _div.html(_div.html() + '<button type="button" class="btn btn-danger pull-right">異議あり</button>')
                }
            },
            templateUrl:"/angularJSTemplate/public/statementMapResult.html"
        }
    })

    myApp.directive("infoTable",function(myPost) {
        return {
            scope: false,
            link: function ($scope) {
                $scope.rate = 7;
                $scope.overStar = 7
                $scope.max = 10;
                $scope.isReadonly = false;
                $scope.percent = 100 * ($scope.rate / $scope.max);
                $scope.rateable = false


                if($scope.debateInfo.position == 1){
                    //自分の自己評価
                    if($scope.debateInfo.proRate){
                        $scope.rateable = false
                        $scope.rate = $scope.debateInfo.proRate
                    }else{
                        $scope.rateable = true
                    }

                    //相手の自己評価
                    if($scope.debateInfo.conRate){
                        $scope.oppositeRate = $scope.debateInfo.conRate
                    }else{
                        $scope.oppositeRate = false
                    }

                    //勝負の判断

                    $scope.gameResult = gameResult($scope.debateInfo.proRate,$scope.debateInfo.conRate)


                }else if($scope.debateInfo.position == 2){
                    //自分の自己評価
                    if($scope.debateInfo.conRate){
                        $scope.rateable = false
                        $scope.rate = $scope.debateInfo.conRate
                    }else{
                        $scope.rateable = true
                    }


                    //相手の自己評価
                    if($scope.debateInfo.proRate){
                        $scope.oppositeRate = $scope.debateInfo.proRate
                    }else{
                        $scope.oppositeRate = false
                    }

                    $scope.gameResult = gameResult($scope.debateInfo.proRate,$scope.debateInfo.conRate)
                }else if($scope.debateInfo.position == 0){

                }else{

                }


                function gameResult(proRate,conRate){

                    if(!proRate || !conRate){
                        return {res:"wait"}
                    }


                    if(proRate > 5 && conRate < 5){
                        return {res:"win",target:"pro",order:0}
                    }

                    if(proRate < 5 && conRate > 5){
                        return {res:"win",target:"con",order:1}
                    }

                    if(proRate == 5 && conRate == 5){
                        return {res:"draw",target:"",order:2}
                    }

                    if(proRate > 5 && conRate >= 5){
                        return {res:"still",target:"",order:3}
                    }

                    if(proRate < 5 && conRate <= 5){
                        return {res:"still",target:"",order:4}
                    }


                    if(proRate = 5 && conRate != 5){
                        return {res:"still",target:"",order:5}
                    }


                }


                $scope.hoveringOver = function(value) {
                    $scope.overStar = value;
                    $scope.percent = 100 * ($scope.overStar / $scope.max);
                };

                $scope.determine = function(){
                    myPost.postData("/release/rate",{rate:$scope.overStar}).then(function(_res){
                        if(_res.data.err == 0){
                            $scope.isReadonly = true;
                            $scope.rateable = false
                        }
                    })
                }

                $scope.ratingStates = [
                    {stateOn: 'glyphicon-ok-sign', stateOff: 'glyphicon-ok-circle'},
                    {stateOn: 'glyphicon-star', stateOff: 'glyphicon-star-empty'},
                    {stateOn: 'glyphicon-heart', stateOff: 'glyphicon-ban-circle'},
                    {stateOn: 'glyphicon-heart'},
                    {stateOff: 'glyphicon-off'}
                ];
            },


            templateUrl:"/angularJSTemplate/public/infoTable.html"
        }
    })

    function initData($scope){
        $scope.debateInfo = {
            pro:"",
            con:"",
            finishi:"",
            setting:"",
            group:"",
            config:{},
            proPrepare:0,
            conPrepare:0
        }



        $scope.statusController = {
            startDebate:false,
            waitDebate:false,
            analysisDebate:false
        }


        $scope.inputStatus = {name:"claim",i:0,j:0}
        //$scope.inputStatus = {name:"evidence",i:0,j:0}
        //$scope.inputStatus = {name:"warrant",i:0,j:0}

        /*

         $scope.dissentData = [{type:"construct",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:0},
         {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
         {type:"dissentExplain",txt:"Tシャツの相場は、500円から高くても4000円。対して、100,000円のTシャツなんて誰も買うわけがない。同じお金があれば、コート、カバン、時計、アクセサリーを買うに違いない。",reply:"",i:0,j:2},
         ]
        */

        $scope.dissentData = []

        $scope.statementData = ""
        $scope.statementStatus = {name:"claim",i:0}


        $scope.conceptStatus = "analysis"
        $scope.conceptStatus = "statement"

        $scope.dissentTxt = "aaa"  //在对质疑进行解释性说明的时候在左侧显示对那一段话有质疑

        $scope.totalNum = 1


    }


</script>
</html>